<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="测试游记">
<meta property="og:url" content="http://example.com/page/5/index.html">
<meta property="og:site_name" content="测试游记">
<meta property="og:locale">
<meta property="article:author" content="测试游记">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://example.com/page/5/"/>





  <title>测试游记</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?41fc030db57d5570dd22f78997dc4a7e";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




<meta name="generator" content="Hexo 5.4.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">测试游记</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E4%B8%89%E5%8D%81%E4%B8%89)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="测试游记">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E4%B8%89%E5%8D%81%E4%B8%89)/" itemprop="url">测试开发进阶(三十三)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-03-03T20:10:32+08:00">
                2021-03-03
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E4%B8%89%E5%8D%81%E4%B8%89)/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2021/03/03/测试开发进阶(三十三)/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="测试开发进阶-三十三"><a href="#测试开发进阶-三十三" class="headerlink" title="测试开发进阶(三十三)"></a>测试开发进阶(三十三)</h1><h2 id="局部变量"><a href="#局部变量" class="headerlink" title="局部变量"></a>局部变量</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">登录接口</span></span><br><span class="line"><span class="attr">variables:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">$&#123;ENV(USERNAME)&#125;</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">$&#123;ENV(PASSWORD)&#125;</span></span><br><span class="line"><span class="attr">request:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">http://127.0.0.1:8000/user/login/</span></span><br><span class="line">    <span class="attr">method:</span> <span class="string">POST</span></span><br><span class="line">    <span class="attr">headers:</span></span><br><span class="line">        <span class="attr">Content-Type:</span> <span class="string">&quot;application/json&quot;</span></span><br><span class="line">    <span class="attr">json:</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">$username</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">$password</span></span><br><span class="line"><span class="attr">validate:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">eq:</span> [<span class="string">&quot;status_code&quot;</span>, <span class="number">200</span>]</span><br><span class="line"><span class="attr">extract:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">uname:</span> <span class="string">content.username</span></span><br></pre></td></tr></table></figure>

<p>可以修改<code>variables</code>定义变量，导入环境变量作为值</p>
<p><code>request</code>中可以使用<code>$变量名</code>来获取<code>variables</code>区域下的变量</p>
<h2 id="调用函数"><a href="#调用函数" class="headerlink" title="调用函数"></a>调用函数</h2><p>可以调用<code>debugtalk.py</code>中的函数</p>
<p>例如在该文件中添加</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_user_agent</span>():</span></span><br><span class="line">    user_agents = [<span class="string">&#x27;Mozilla/5.0 AAA&#x27;</span>, <span class="string">&#x27;Mozilla/5.0 BBB&#x27;</span>, <span class="string">&#x27;Mozilla/5.0 CCC&#x27;</span>]</span><br><span class="line">    <span class="keyword">return</span> random.choice(user_agents)</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">登录接口</span></span><br><span class="line"><span class="attr">variables:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">$&#123;ENV(USERNAME)&#125;</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">$&#123;ENV(PASSWORD)&#125;</span></span><br><span class="line"><span class="attr">request:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">http://127.0.0.1:8000/user/login/</span></span><br><span class="line">    <span class="attr">method:</span> <span class="string">POST</span></span><br><span class="line">    <span class="attr">headers:</span></span><br><span class="line">        <span class="attr">Content-Type:</span> <span class="string">&quot;application/json&quot;</span></span><br><span class="line">        <span class="attr">User-Agent:</span> <span class="string">$&#123;get_user_agent()&#125;</span></span><br><span class="line">    <span class="attr">json:</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">$username</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">$password</span></span><br><span class="line"><span class="attr">validate:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">eq:</span> [<span class="string">&quot;status_code&quot;</span>, <span class="number">200</span>]</span><br></pre></td></tr></table></figure>

<p>使用<code>$&#123;get_user_agent()&#125;</code></p>
<p>这样就可以动态的使用<code>User-Agent</code></p>
<h2 id="校验"><a href="#校验" class="headerlink" title="校验"></a>校验</h2><p>可以用的响应属性：</p>
<ul>
<li>available</li>
<li>response</li>
<li>status_code</li>
<li>cookies</li>
<li> elapsed</li>
<li>headers </li>
<li>content</li>
<li>text </li>
<li>json</li>
<li>encoding</li>
<li>ok</li>
<li>reason</li>
<li>url</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">eq:</span> [<span class="string">&quot;headers.Content-Type&quot;</span>, <span class="string">&quot;application/json&quot;</span>]</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> &#123;<span class="attr">check:</span> <span class="string">&quot;headers.Content-Type&quot;</span>,<span class="attr">comparator:</span> <span class="string">&quot;eq&quot;</span>,<span class="attr">expect:</span> <span class="string">&quot;application/json&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<p>上面两种写法效果一致</p>
<blockquote>
<ul>
<li>check：指定断言哪一个字段（实际值）</li>
</ul>
</blockquote>
<p><code>python3.7/site-packages/httprunner/built_in.py</code></p>
<blockquote>
<ul>
<li>comparator：指定断言的规则<ul>
<li>eq 等于</li>
<li>lt小于</li>
<li>lte</li>
<li>gt大于</li>
<li>gte</li>
<li>str_eq</li>
<li>len_eq长度等于</li>
<li>len_gt</li>
<li>contains 包含</li>
</ul>
</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">built-in comparators</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">equals</span>(<span class="params">check_value, expect_value</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> check_value == expect_value</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">less_than</span>(<span class="params">check_value, expect_value</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> check_value &lt; expect_value</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">less_than_or_equals</span>(<span class="params">check_value, expect_value</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> check_value &lt;= expect_value</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">greater_than</span>(<span class="params">check_value, expect_value</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> check_value &gt; expect_value</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">greater_than_or_equals</span>(<span class="params">check_value, expect_value</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> check_value &gt;= expect_value</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">not_equals</span>(<span class="params">check_value, expect_value</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> check_value != expect_value</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">string_equals</span>(<span class="params">check_value, expect_value</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> builtin_str(check_value) == builtin_str(expect_value)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">length_equals</span>(<span class="params">check_value, expect_value</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">isinstance</span>(expect_value, integer_types)</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(check_value) == expect_value</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">length_greater_than</span>(<span class="params">check_value, expect_value</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">isinstance</span>(expect_value, integer_types)</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(check_value) &gt; expect_value</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">length_greater_than_or_equals</span>(<span class="params">check_value, expect_value</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">isinstance</span>(expect_value, integer_types)</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(check_value) &gt;= expect_value</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">length_less_than</span>(<span class="params">check_value, expect_value</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">isinstance</span>(expect_value, integer_types)</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(check_value) &lt; expect_value</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">length_less_than_or_equals</span>(<span class="params">check_value, expect_value</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">isinstance</span>(expect_value, integer_types)</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(check_value) &lt;= expect_value</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">contains</span>(<span class="params">check_value, expect_value</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">isinstance</span>(check_value, (<span class="built_in">list</span>, <span class="built_in">tuple</span>, <span class="built_in">dict</span>, basestring))</span><br><span class="line">    <span class="keyword">assert</span> expect_value <span class="keyword">in</span> check_value</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">contained_by</span>(<span class="params">check_value, expect_value</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">isinstance</span>(expect_value, (<span class="built_in">list</span>, <span class="built_in">tuple</span>, <span class="built_in">dict</span>, basestring))</span><br><span class="line">    <span class="keyword">assert</span> check_value <span class="keyword">in</span> expect_value</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">type_match</span>(<span class="params">check_value, expect_value</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_type</span>(<span class="params">name</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(name, <span class="built_in">type</span>):</span><br><span class="line">            <span class="keyword">return</span> name</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">isinstance</span>(name, basestring):</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">return</span> __builtins__[name]</span><br><span class="line">            <span class="keyword">except</span> KeyError:</span><br><span class="line">                <span class="keyword">raise</span> ValueError(name)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(name)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">isinstance</span>(check_value, get_type(expect_value))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">regex_match</span>(<span class="params">check_value, expect_value</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">isinstance</span>(expect_value, basestring)</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">isinstance</span>(check_value, basestring)</span><br><span class="line">    <span class="keyword">assert</span> re.match(expect_value, check_value)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">startswith</span>(<span class="params">check_value, expect_value</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> builtin_str(check_value).startswith(builtin_str(expect_value))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">endswith</span>(<span class="params">check_value, expect_value</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> builtin_str(check_value).endswith(builtin_str(expect_value))</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>expect预期结果</li>
</ul>
</blockquote>
<h2 id="数据驱动"><a href="#数据驱动" class="headerlink" title="数据驱动"></a>数据驱动</h2><p><code>testcases/login.yml</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">config:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;登录接口测试&quot;</span></span><br><span class="line">    <span class="attr">variables:</span></span><br><span class="line">        <span class="attr">device_sn:</span> <span class="string">&quot;ABC&quot;</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">$&#123;ENV(USERNAME)&#125;</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">$&#123;ENV(PASSWORD)&#125;</span></span><br><span class="line">    <span class="attr">base_url:</span> <span class="string">&quot;http://127.0.0.1:8000&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">teststeps:</span></span><br><span class="line"><span class="bullet">-</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">登录</span></span><br><span class="line">    <span class="attr">api:</span> <span class="string">api/login.yml</span></span><br><span class="line">    <span class="attr">validate:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">eq:</span> [<span class="string">&quot;status_code&quot;</span>, <span class="number">200</span>]</span><br></pre></td></tr></table></figure>

<p>继承<code>api/login.yml</code>会与本区域定义的<code>validate</code>合并覆盖</p>
<p>一般api路径下的断言只进行基础类型的断言例如<code>status_code</code></p>
<p>testcases会进行其他的断言</p>
<h3 id="方式一：使用yaml"><a href="#方式一：使用yaml" class="headerlink" title="方式一：使用yaml"></a>方式一：使用yaml</h3><p><code>testsuites/api_testsuite.yml</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">config:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">接口测试套件</span></span><br><span class="line">    <span class="attr">base_url:</span> <span class="string">&quot;http://127.0.0.1:8000&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">testcases:</span></span><br><span class="line"><span class="bullet">-</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">登录接口</span></span><br><span class="line">    <span class="attr">testcase:</span> <span class="string">testcases/login.yml</span></span><br><span class="line">    <span class="attr">parameters:</span></span><br><span class="line">        <span class="comment"># 方式一</span></span><br><span class="line">        <span class="comment"># 多个具有关联性的参数，需要将其定义在一起，并且采用短横线进行连接</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">title-username-password-status_code-contain_msg:</span></span><br><span class="line">              <span class="bullet">-</span> [<span class="string">&quot;正常登录&quot;</span>, <span class="string">&quot;zhongxin&quot;</span>, <span class="string">&quot;123456&quot;</span>, <span class="number">200</span>, <span class="string">&quot;token&quot;</span>]</span><br><span class="line">              <span class="bullet">-</span> [<span class="string">&quot;密码错误&quot;</span>, <span class="string">&quot;zhongxin&quot;</span>, <span class="string">&quot;1234567&quot;</span>, <span class="number">400</span>, <span class="string">&quot;non_field_errors&quot;</span>]</span><br><span class="line">              <span class="bullet">-</span> [<span class="string">&quot;账号错误&quot;</span>, <span class="string">&quot;zhongxin11&quot;</span>, <span class="string">&quot;123456&quot;</span>, <span class="number">400</span>, <span class="string">&quot;non_field_errors&quot;</span>]</span><br><span class="line">              <span class="bullet">-</span> [<span class="string">&quot;用户名为空&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;123456&quot;</span>, <span class="number">400</span>, <span class="string">&quot;username&quot;</span>]</span><br><span class="line">              <span class="bullet">-</span> [<span class="string">&quot;密码为空&quot;</span>, <span class="string">&quot;zhongxin&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="number">400</span>, <span class="string">&quot;password&quot;</span>]</span><br></pre></td></tr></table></figure>
<p>运行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> hrun testsuites/api_testsuite.yml</span></span><br></pre></td></tr></table></figure>

<p>查看报告</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8jf2fbbn1j31b30u0aum.jpg" alt="报告"></p>
<h3 id="方式二：读取文件"><a href="#方式二：读取文件" class="headerlink" title="方式二：读取文件"></a>方式二：读取文件</h3><p>新建一个csv文件</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">title,username,password,status_code,contain_msg</span></span><br><span class="line"><span class="string">正常登录,</span> <span class="string">zhongxin,</span> <span class="number">123456</span><span class="string">,</span> <span class="number">200</span><span class="string">,</span> <span class="string">token</span></span><br><span class="line"><span class="string">密码错误,</span> <span class="string">zhongxin,</span> <span class="number">1234567</span><span class="string">,</span> <span class="number">400</span><span class="string">,</span> <span class="string">non_field_errors</span></span><br><span class="line"><span class="string">账号错误,</span> <span class="string">zhongxin11,</span> <span class="number">123456</span><span class="string">,</span> <span class="number">400</span><span class="string">,</span> <span class="string">non_field_errors</span></span><br><span class="line"><span class="string">用户名为空,</span> <span class="string">,</span> <span class="number">123456</span><span class="string">,</span> <span class="number">400</span><span class="string">,</span> <span class="string">username</span></span><br><span class="line"><span class="string">密码为空,</span> <span class="string">zhongxin,</span> <span class="string">,</span> <span class="number">400</span><span class="string">,</span> <span class="string">password</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">title-username-password-status_code-contain_msg:</span> <span class="string">$&#123;P(datas/accounts.csv)&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="方式三：使用函数"><a href="#方式三：使用函数" class="headerlink" title="方式三：使用函数"></a>方式三：使用函数</h3><p>在<code>debugtalk.py</code>添加</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_accounts</span>():</span></span><br><span class="line">    accounts = [</span><br><span class="line">        &#123;<span class="string">&quot;title&quot;</span>: <span class="string">&quot;正常登录&quot;</span>, <span class="string">&quot;username&quot;</span>: <span class="string">&quot;zhongxin&quot;</span>, <span class="string">&quot;password&quot;</span>: <span class="string">&quot;123456&quot;</span>, <span class="string">&quot;status_code&quot;</span>: <span class="number">200</span>, <span class="string">&quot;contain_msg&quot;</span>: <span class="string">&quot;token&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;title&quot;</span>: <span class="string">&quot;密码错误&quot;</span>, <span class="string">&quot;username&quot;</span>: <span class="string">&quot;zhongxin&quot;</span>, <span class="string">&quot;password&quot;</span>: <span class="string">&quot;1234567&quot;</span>, <span class="string">&quot;status_code&quot;</span>: <span class="number">400</span>, <span class="string">&quot;contain_msg&quot;</span>: <span class="string">&quot;non_field_errors&quot;</span>&#125;,</span><br><span class="line">    ]</span><br><span class="line">    <span class="keyword">return</span> accounts</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">title-username-password-status_code-contain_msg:</span> <span class="string">$&#123;get_accounts()&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="使用py文件调用httprunner"><a href="#使用py文件调用httprunner" class="headerlink" title="使用py文件调用httprunner"></a>使用py文件调用httprunner</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> httprunner.api <span class="keyword">import</span> HttpRunner</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建HttpRunner对象</span></span><br><span class="line"><span class="comment"># failfast:False 用例执行失败后不终止</span></span><br><span class="line">runner = HttpRunner(failfast=<span class="literal">False</span>)</span><br><span class="line"><span class="comment"># 运行用例</span></span><br><span class="line"><span class="comment"># run方法支持如下参数</span></span><br><span class="line"><span class="comment"># yaml用例文件的路径</span></span><br><span class="line"><span class="comment"># 字典(用例的信息)</span></span><br><span class="line">runner.run(<span class="string">&#x27;/Users/zhongxin/Desktop/httprunner_learn/testcases/login.yml&#x27;</span>)</span><br><span class="line">print(runner.summary)</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E4%B8%89%E5%8D%81%E4%B9%9D)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="测试游记">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E4%B8%89%E5%8D%81%E4%B9%9D)/" itemprop="url">测试开发进阶(三十九)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-03-03T20:10:32+08:00">
                2021-03-03
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E4%B8%89%E5%8D%81%E4%B9%9D)/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2021/03/03/测试开发进阶(三十九)/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="测试开发进阶-三十九"><a href="#测试开发进阶-三十九" class="headerlink" title="测试开发进阶(三十九)"></a>测试开发进阶(三十九)</h1><h2 id="首页"><a href="#首页" class="headerlink" title="首页"></a>首页</h2><p>使用一个简单的get函数返回需要的内容</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">statistics = &#123;</span><br><span class="line">    <span class="string">&#x27;projects_count&#x27;</span>: projects_count,</span><br><span class="line">    <span class="string">&#x27;interfaces_count&#x27;</span>: interfaces_count,</span><br><span class="line">    <span class="string">&#x27;testcases_count&#x27;</span>: testcases_count,</span><br><span class="line">    <span class="string">&#x27;testsuits_count&#x27;</span>: testsuits_count,</span><br><span class="line">    <span class="string">&#x27;configures_count&#x27;</span>: configures_count,</span><br><span class="line">    <span class="string">&#x27;envs_count&#x27;</span>: envs_count,</span><br><span class="line">    <span class="string">&#x27;debug_talks_count&#x27;</span>: debug_talks_count,</span><br><span class="line">    <span class="string">&#x27;reports_count&#x27;</span>: reports_count,</span><br><span class="line">    <span class="string">&#x27;success_rate&#x27;</span>: success_rate,</span><br><span class="line">    <span class="string">&#x27;fail_rate&#x27;</span>: fail_rate,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>他们都是从数据库中计算并统计出来的</p>
<p>需要有权限才能访问</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">permission_classes = [permissions.IsAuthenticated]</span><br></pre></td></tr></table></figure>

<p>代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> permissions</span><br><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Sum</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> projects.models <span class="keyword">import</span> Projects</span><br><span class="line"><span class="keyword">from</span> interfaces.models <span class="keyword">import</span> Interfaces</span><br><span class="line"><span class="keyword">from</span> testcases.models <span class="keyword">import</span> Testcases</span><br><span class="line"><span class="keyword">from</span> testsuits.models <span class="keyword">import</span> Testsuits</span><br><span class="line"><span class="keyword">from</span> configures.models <span class="keyword">import</span> Configures</span><br><span class="line"><span class="keyword">from</span> envs.models <span class="keyword">import</span> Envs</span><br><span class="line"><span class="keyword">from</span> debugtalks.models <span class="keyword">import</span> DebugTalks</span><br><span class="line"><span class="keyword">from</span> reports.models <span class="keyword">import</span> Reports</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SummaryAPIView</span>(<span class="params">APIView</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    返回统计信息</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    permission_classes = [permissions.IsAuthenticated]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        获取统计信息</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        user = request.user</span><br><span class="line">        user_info = &#123;</span><br><span class="line">            <span class="string">&#x27;username&#x27;</span>: user.username,</span><br><span class="line">            <span class="string">&#x27;role&#x27;</span>: <span class="string">&#x27;管理员&#x27;</span> <span class="keyword">if</span> user.is_superuser <span class="keyword">else</span> <span class="string">&#x27;普通用户&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;date_joined&#x27;</span>: user.date_joined.strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>) <span class="keyword">if</span> user.date_joined <span class="keyword">else</span> <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;last_login&#x27;</span>: user.last_login.strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>) <span class="keyword">if</span> user.last_login <span class="keyword">else</span> <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        projects_count = Projects.objects.<span class="built_in">filter</span>(is_delete=<span class="literal">False</span>).count()</span><br><span class="line">        interfaces_count = Interfaces.objects.<span class="built_in">filter</span>(is_delete=<span class="literal">False</span>).count()</span><br><span class="line">        testcases_count = Testcases.objects.<span class="built_in">filter</span>(is_delete=<span class="literal">False</span>).count()</span><br><span class="line">        testsuits_count = Testsuits.objects.<span class="built_in">filter</span>(is_delete=<span class="literal">False</span>).count()</span><br><span class="line">        configures_count = Configures.objects.<span class="built_in">filter</span>(is_delete=<span class="literal">False</span>).count()</span><br><span class="line">        envs_count = Envs.objects.<span class="built_in">filter</span>(is_delete=<span class="literal">False</span>).count()</span><br><span class="line">        debug_talks_count = DebugTalks.objects.<span class="built_in">filter</span>(is_delete=<span class="literal">False</span>).count()</span><br><span class="line">        reports_count = Reports.objects.<span class="built_in">filter</span>(is_delete=<span class="literal">False</span>).count()</span><br><span class="line"></span><br><span class="line">        run_testcases_success_count = Reports.objects.<span class="built_in">filter</span>(is_delete=<span class="literal">False</span>).aggregate(Sum(<span class="string">&#x27;success&#x27;</span>))[</span><br><span class="line">                                          <span class="string">&#x27;success__sum&#x27;</span>] <span class="keyword">or</span> <span class="number">0</span></span><br><span class="line">        run_testcases_total_count = Reports.objects.<span class="built_in">filter</span>(is_delete=<span class="literal">False</span>).aggregate(Sum(<span class="string">&#x27;count&#x27;</span>))[<span class="string">&#x27;count__sum&#x27;</span>] <span class="keyword">or</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> run_testcases_total_count:</span><br><span class="line">            success_rate = <span class="built_in">int</span>((run_testcases_success_count / run_testcases_total_count) * <span class="number">100</span>)</span><br><span class="line">            fail_rate = <span class="number">100</span> - success_rate</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            success_rate = <span class="number">0</span></span><br><span class="line">            fail_rate = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        statistics = &#123;</span><br><span class="line">            <span class="string">&#x27;projects_count&#x27;</span>: projects_count,</span><br><span class="line">            <span class="string">&#x27;interfaces_count&#x27;</span>: interfaces_count,</span><br><span class="line">            <span class="string">&#x27;testcases_count&#x27;</span>: testcases_count,</span><br><span class="line">            <span class="string">&#x27;testsuits_count&#x27;</span>: testsuits_count,</span><br><span class="line">            <span class="string">&#x27;configures_count&#x27;</span>: configures_count,</span><br><span class="line">            <span class="string">&#x27;envs_count&#x27;</span>: envs_count,</span><br><span class="line">            <span class="string">&#x27;debug_talks_count&#x27;</span>: debug_talks_count,</span><br><span class="line">            <span class="string">&#x27;reports_count&#x27;</span>: reports_count,</span><br><span class="line">            <span class="string">&#x27;success_rate&#x27;</span>: success_rate,</span><br><span class="line">            <span class="string">&#x27;fail_rate&#x27;</span>: fail_rate,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Response(data=&#123;</span><br><span class="line">            <span class="string">&#x27;user&#x27;</span>: user_info,</span><br><span class="line">            <span class="string">&#x27;statistics&#x27;</span>: statistics</span><br><span class="line">        &#125;)</span><br></pre></td></tr></table></figure>

<h2 id="如何使用"><a href="#如何使用" class="headerlink" title="如何使用"></a>如何使用</h2><ol>
<li>项目管理-<strong>项目新增</strong></li>
<li>维护<strong>内置函数</strong>debugtalk.py</li>
<li>环境管理-<strong>环境新增</strong></li>
<li>接口管理-<strong>接口新增</strong></li>
<li>配置管理-<strong>配置新增</strong></li>
<li>用例管理-<strong>用例新增</strong></li>
</ol>
<h2 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h2><h3 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h3><ol>
<li>安装操作系统</li>
<li>安装python</li>
<li>mysql</li>
<li>搭建Django环境–各种模块的安装</li>
<li>nginx</li>
<li>gunicorn</li>
<li>docker</li>
<li>docker-compose</li>
<li>docker-swarm</li>
</ol>
<p>由于还没有学习<code>docker</code>暂时不继续，先行学习<code>docker</code></p>
<h2 id="Shell"><a href="#Shell" class="headerlink" title="Shell"></a>Shell</h2><blockquote>
<ol>
<li>命令解释器</li>
<li>shell就是在操作系统和应用程序之间的一个命令翻译工具</li>
</ol>
</blockquote>
<h3 id="shell的分类"><a href="#shell的分类" class="headerlink" title="shell的分类"></a>shell的分类</h3><ul>
<li>Winodws中</li>
</ul>
<blockquote>
<p>cmd.exe命令提示字符</p>
</blockquote>
<ul>
<li>linux中</li>
</ul>
<blockquote>
<ul>
<li><p>sh</p>
</li>
<li><p>bash</p>
</li>
<li><p>zsh</p>
</li>
</ul>
</blockquote>
<h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><ul>
<li><p>head：默认获取文件前十行</p>
</li>
<li><p>tail：默认获取文件后十行</p>
</li>
</ul>
<p>获取一个区间，第10～13行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> head -n13 xxx | tail -n4</span></span><br></pre></td></tr></table></figure>

<ul>
<li>cut：取出文本指定列</li>
</ul>
<blockquote>
<p>-d:指定分割符</p>
<p>-f:指定列</p>
</blockquote>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Name Age Score</span><br><span class="line">a 25 90</span><br><span class="line">b 26 91</span><br><span class="line">c 27 92</span><br><span class="line">d 28 93</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> cut -d<span class="string">&quot; &quot;</span> -f1 learn_cut.txt</span> </span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g9950u4m13j30n60e0aaz.jpg" alt="1"></p>
<ul>
<li>uniq:去除重复项</li>
</ul>
<blockquote>
<p>-d:仅打印有重复的元素</p>
<p>-c:打印元素重复的个数</p>
</blockquote>
<ul>
<li>sort:对文本的内容进行排序</li>
</ul>
<blockquote>
<p>默认以字符串的ASCII码数值从小到大排序</p>
<p>-n:以数值大小排序</p>
<p>-r:倒序</p>
<p>-t:指定分割符，默认为空格</p>
<p>-knum:指定以某个字段来排序</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 以:分割的第三列的数值大小排列</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sort -t<span class="string">&quot;:&quot;</span> -k3 -n /etc/passwd</span></span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g995cfyp7dj30xq0s4wky.jpg" alt="2"></p>
<ul>
<li>wc「word count」计算文本数量</li>
</ul>
<blockquote>
<p>-l:打印行数</p>
<p>-w:打印单词数</p>
<p>-c:打印字节数</p>
<p>-L:打印最长行的字节数</p>
</blockquote>
<h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><ul>
<li>本地变量</li>
<li>全局变量</li>
<li>内置变量</li>
</ul>
<h4 id="定义变量"><a href="#定义变量" class="headerlink" title="定义变量"></a>定义变量</h4><blockquote>
<p>等号前后不能有空格</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> username=<span class="string">&quot;89&quot;</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> username=a b <span class="comment"># 错误</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> username=<span class="string">&quot;a b&quot;</span> <span class="comment">#正确</span></span> </span><br></pre></td></tr></table></figure>

<ul>
<li>单引号:所见即所得</li>
</ul>
<p>不能插值</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> p=python</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> u=<span class="string">&#x27;I love $p&#x27;</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> <span class="variable">$u</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> i=<span class="string">&quot;I love <span class="variable">$p</span>&quot;</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> <span class="variable">$i</span></span></span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g995jh928hj30ha080my6.jpg" alt="3"></p>
<p><strong>将命令的结果返回给变量</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> o=$(ls)</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> p=`ls`</span></span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g995lbu2hnj30fi032q37.jpg" alt="4"></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g995mbl9ubj30f003ajrn.jpg" alt="5"></p>
<h4 id="（局部）全局变量"><a href="#（局部）全局变量" class="headerlink" title="（局部）全局变量"></a>（局部）全局变量</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> env</span></span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g995ocjvm5j30u00watff.jpg" alt="6"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> <span class="variable">$USER</span></span></span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g995ouza78j30gk02kt8t.jpg" alt="7"></p>
<h5 id="定义全局变量"><a href="#定义全局变量" class="headerlink" title="定义全局变量"></a>定义全局变量</h5><ol>
<li>export 变量</li>
<li>export 变量=值</li>
</ol>
<p>在<code>～/.bashrc</code>中创建才是真正的全局变量</p>
<h4 id="内置变量"><a href="#内置变量" class="headerlink" title="内置变量"></a>内置变量</h4><ul>
<li><code>$0</code>:获取当前执行的shell脚本文件名，包括脚本路径</li>
<li><code>$n</code>:当前shell脚本的第n个参数(n&gt;9需要使用<code>$&#123;10&#125;</code>)</li>
<li><code>$#</code>:获取当前shell命令行中参数的总个数</li>
<li><code>$?</code>:获取执行的上一个命令的返回值(0为成功，非0为失败)</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">echo &quot;参数的总个数:$#&quot;</span><br><span class="line">echo &quot;脚本名为:$0&quot;</span><br><span class="line">echo &quot;第二个参数:$2&quot;</span><br><span class="line">echo &quot;第十个参数:$&#123;10&#125;&quot;</span><br><span class="line">echo &quot;获取所有参数:$*&quot;</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g995ztf71aj30so0ao0uf.jpg" alt="8"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E4%B8%89%E5%8D%81%E4%BA%94)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="测试游记">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E4%B8%89%E5%8D%81%E4%BA%94)/" itemprop="url">测试开发进阶(三十五)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-03-03T20:10:32+08:00">
                2021-03-03
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E4%B8%89%E5%8D%81%E4%BA%94)/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2021/03/03/测试开发进阶(三十五)/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="测试开发进阶-三十五"><a href="#测试开发进阶-三十五" class="headerlink" title="测试开发进阶(三十五)"></a>测试开发进阶(三十五)</h1><h2 id="导入测试数据"><a href="#导入测试数据" class="headerlink" title="导入测试数据"></a>导入测试数据</h2><h3 id="在Pycharm中连接数据库"><a href="#在Pycharm中连接数据库" class="headerlink" title="在Pycharm中连接数据库"></a>在Pycharm中连接数据库</h3><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8ptunalkij30h00u8n08.jpg" alt="Pycharm连接数据库"></p>
<h3 id="执行sql"><a href="#执行sql" class="headerlink" title="执行sql"></a>执行sql</h3><p>测试数据在：<code>https://github.com/zx490336534/ApiTest/tree/master/test</code>按照顺序执行</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8ptt4ftkcj30k60wwgr2.jpg" alt="执行sql"></p>
<h3 id="选择执行的目标"><a href="#选择执行的目标" class="headerlink" title="选择执行的目标"></a>选择执行的目标</h3><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8ptt9dnxvj30u00z310d.jpg" alt="选择执行的目标"></p>
<h2 id="处理时间格式"><a href="#处理时间格式" class="headerlink" title="处理时间格式"></a>处理时间格式</h2><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8pv1waszdj31b30u0hd0.jpg" alt="时间"></p>
<p>从数据库中可以看出，使用<code>models.DateTimeField</code>生成的时间数据格式为<code>2019-11-06 06:21:19.355242</code></p>
<p>我们需要返回一个``2019-11-06 06:21:19`的内容</p>
<p>所以我们需要重写<code>list</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">list</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">    queryset = self.filter_queryset(self.get_queryset())</span><br><span class="line"></span><br><span class="line">    page = self.paginate_queryset(queryset)</span><br><span class="line">    <span class="keyword">if</span> page <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        serializer = self.get_serializer(page, many=<span class="literal">True</span>)</span><br><span class="line">        datas = serializer.data</span><br><span class="line">        datas = get_count_by_project(datas)</span><br><span class="line">        <span class="keyword">return</span> self.get_paginated_response(datas)</span><br><span class="line"></span><br><span class="line">    serializer = self.get_serializer(queryset, many=<span class="literal">True</span>)</span><br><span class="line">    datas = serializer.data</span><br><span class="line">    datas = get_count_by_project(datas)</span><br><span class="line">    <span class="keyword">return</span> Response(datas)</span><br></pre></td></tr></table></figure>

<p>将对数据的处理写在<code>get_count_by_project</code>函数中</p>
<p>通过调试可以看到获取到的datas对象为一个包含字典的列表</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8pv5fmw27j31su0q4ti2.jpg" alt="datas"></p>
<p>很容易的想到使用<code>正则</code>来进行提取，并修改字典内容</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mtch = re.search(<span class="string">r&#x27;(.*)T(.*)\..*?&#x27;</span>, item[<span class="string">&#x27;create_time&#x27;</span>])</span><br><span class="line">item[<span class="string">&#x27;create_time&#x27;</span>] = mtch.group(<span class="number">1</span>) + <span class="string">&#x27; &#x27;</span> + mtch.group(<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<h2 id="获取项目数据"><a href="#获取项目数据" class="headerlink" title="获取项目数据"></a>获取项目数据</h2><h3 id="获取接口总数"><a href="#获取接口总数" class="headerlink" title="获取接口总数"></a>获取接口总数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">project_id = item[<span class="string">&#x27;id&#x27;</span>]</span><br><span class="line">interfaces_testcases_objs = Interfaces.objects.values(<span class="string">&#x27;id&#x27;</span>).annotate(testcases=Count(<span class="string">&#x27;testcases&#x27;</span>)). \</span><br><span class="line">    <span class="built_in">filter</span>(project_id=project_id, is_delete=<span class="literal">False</span>)</span><br><span class="line">interfaces_count = interfaces_testcases_objs.count()</span><br></pre></td></tr></table></figure>

<p><code>interfaces_testcases_objs</code>相当于调用了以下SQL语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> `tb_interfaces`.`id`, <span class="built_in">COUNT</span>(`tb_testcases`.`id`) <span class="keyword">AS</span> `testcases` <span class="keyword">FROM</span> `tb_interfaces` <span class="keyword">LEFT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> `tb_testcases` <span class="keyword">ON</span> (`tb_interfaces`.`id` <span class="operator">=</span> `tb_testcases`.`interface_id`) <span class="keyword">WHERE</span> (`tb_interfaces`.`is_delete` <span class="operator">=</span> <span class="literal">False</span> <span class="keyword">AND</span> `tb_interfaces`.`project_id` <span class="operator">=</span> <span class="number">1</span>) <span class="keyword">GROUP</span> <span class="keyword">BY</span> `tb_interfaces`.`id` <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">NULL</span></span><br></pre></td></tr></table></figure>

<h3 id="获取用例总数"><a href="#获取用例总数" class="headerlink" title="获取用例总数"></a>获取用例总数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">testcases_count = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> one_dict <span class="keyword">in</span> interfaces_testcases_objs:</span><br><span class="line">    testcases_count += one_dict[<span class="string">&#x27;testcases&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h3 id="获取配置数量"><a href="#获取配置数量" class="headerlink" title="获取配置数量"></a>获取配置数量</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">interfaces_configures_objs = Interfaces.objects.values(<span class="string">&#x27;id&#x27;</span>).annotate(configures=Count(<span class="string">&#x27;configures&#x27;</span>)). \</span><br><span class="line">    <span class="built_in">filter</span>(project_id=project_id, is_delete=<span class="literal">False</span>)</span><br><span class="line">configures_count = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> one_dict <span class="keyword">in</span> interfaces_configures_objs:</span><br><span class="line">    configures_count += one_dict[<span class="string">&#x27;configures&#x27;</span>]</span><br></pre></td></tr></table></figure>
<p>相当于执行了以下SQL</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> `tb_interfaces`.`id`, <span class="built_in">COUNT</span>(`tb_configures`.`id`) <span class="keyword">AS</span> `configures` <span class="keyword">FROM</span> `tb_interfaces` <span class="keyword">LEFT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> `tb_configures` <span class="keyword">ON</span> (`tb_interfaces`.`id` <span class="operator">=</span> `tb_configures`.`interface_id`) <span class="keyword">WHERE</span> (`tb_interfaces`.`is_delete` <span class="operator">=</span> <span class="literal">False</span> <span class="keyword">AND</span> `tb_interfaces`.`project_id` <span class="operator">=</span> <span class="number">1</span>) <span class="keyword">GROUP</span> <span class="keyword">BY</span> `tb_interfaces`.`id` <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">NULL</span></span><br></pre></td></tr></table></figure>

<h3 id="获取测试套件总数"><a href="#获取测试套件总数" class="headerlink" title="获取测试套件总数"></a>获取测试套件总数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">testsuits_count = Testsuits.objects.<span class="built_in">filter</span>(project_id=project_id, is_delete=<span class="literal">False</span>).count()</span><br></pre></td></tr></table></figure>

<h3 id="整个函数"><a href="#整个函数" class="headerlink" title="整个函数"></a>整个函数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Count</span><br><span class="line"><span class="keyword">from</span> interfaces.models <span class="keyword">import</span> Interfaces</span><br><span class="line"><span class="keyword">from</span> testsuits.models <span class="keyword">import</span> Testsuits</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_count_by_project</span>(<span class="params">datas</span>):</span></span><br><span class="line">    datas_list = []</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> datas:</span><br><span class="line">        mtch = re.search(<span class="string">r&#x27;(.*)T(.*)\..*?&#x27;</span>, item[<span class="string">&#x27;create_time&#x27;</span>])</span><br><span class="line">        item[<span class="string">&#x27;create_time&#x27;</span>] = mtch.group(<span class="number">1</span>) + <span class="string">&#x27; &#x27;</span> + mtch.group(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">        project_id = item[<span class="string">&#x27;id&#x27;</span>]</span><br><span class="line">        interfaces_testcases_objs = Interfaces.objects.values(<span class="string">&#x27;id&#x27;</span>).annotate(testcases=Count(<span class="string">&#x27;testcases&#x27;</span>)). \</span><br><span class="line">            <span class="built_in">filter</span>(project_id=project_id, is_delete=<span class="literal">False</span>)</span><br><span class="line">        interfaces_count = interfaces_testcases_objs.count()</span><br><span class="line">        testcases_count = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> one_dict <span class="keyword">in</span> interfaces_testcases_objs:</span><br><span class="line">            testcases_count += one_dict[<span class="string">&#x27;testcases&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        interfaces_configures_objs = Interfaces.objects.values(<span class="string">&#x27;id&#x27;</span>).annotate(configures=Count(<span class="string">&#x27;configures&#x27;</span>)). \</span><br><span class="line">            <span class="built_in">filter</span>(project_id=project_id, is_delete=<span class="literal">False</span>)</span><br><span class="line">        configures_count = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> one_dict <span class="keyword">in</span> interfaces_configures_objs:</span><br><span class="line">            configures_count += one_dict[<span class="string">&#x27;configures&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        testsuits_count = Testsuits.objects.<span class="built_in">filter</span>(project_id=project_id, is_delete=<span class="literal">False</span>).count()</span><br><span class="line"></span><br><span class="line">        item[<span class="string">&#x27;interfaces&#x27;</span>] = interfaces_count</span><br><span class="line">        item[<span class="string">&#x27;testsuits&#x27;</span>] = testsuits_count</span><br><span class="line">        item[<span class="string">&#x27;testcases&#x27;</span>] = testcases_count</span><br><span class="line">        item[<span class="string">&#x27;configures&#x27;</span>] = configures_count</span><br><span class="line"></span><br><span class="line">        datas_list.append(item)</span><br><span class="line">    <span class="keyword">return</span> datas_list</span><br></pre></td></tr></table></figure>

<h3 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h3><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8pvd3f1izj31b30u04nw.jpg" alt="结果"></p>
<h2 id="返回分页内容"><a href="#返回分页内容" class="headerlink" title="返回分页内容"></a>返回分页内容</h2><p>配置<code>setting.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    <span class="string">&#x27;PAGE_SIZE&#x27;</span>: <span class="number">10</span>,</span><br><span class="line">    <span class="string">&#x27;DEFAULT_PAGINATION_CLASS&#x27;</span>: <span class="string">&#x27;utils.pagination.PageNumberPaginationManual&#x27;</span>,</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>编写自定义分页操作</p>
<p><code>utils.pagination.PageNumberPaginationManual</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.conf <span class="keyword">import</span> settings</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> pagination</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PageNumberPaginationManual</span>(<span class="params">pagination.PageNumberPagination</span>):</span></span><br><span class="line">    max_page_size = <span class="number">50</span></span><br><span class="line">    page_size_query_param = <span class="string">&#x27;size&#x27;</span></span><br><span class="line">    page_query_description = <span class="string">&#x27;第几页&#x27;</span></span><br><span class="line">    page_size_query_description = <span class="string">&#x27;每页几条&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_paginated_response</span>(<span class="params">self, data</span>):</span></span><br><span class="line">        response = <span class="built_in">super</span>(PageNumberPaginationManual, self).get_paginated_response(data)</span><br><span class="line">        response.data[<span class="string">&#x27;total_pages&#x27;</span>] = self.page.paginator.num_pages</span><br><span class="line">        response.data[<span class="string">&#x27;current_page_num&#x27;</span>] = self.page.number</span><br><span class="line">        <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8pvpe9dq9j31iu0m8gpf.jpg" alt="结果"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E4%B8%89%E5%8D%81%E4%BA%8C)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="测试游记">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E4%B8%89%E5%8D%81%E4%BA%8C)/" itemprop="url">测试开发进阶(三十二)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-03-03T20:10:32+08:00">
                2021-03-03
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E4%B8%89%E5%8D%81%E4%BA%8C)/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2021/03/03/测试开发进阶(三十二)/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="测试开发进阶-三十二"><a href="#测试开发进阶-三十二" class="headerlink" title="测试开发进阶(三十二)"></a>测试开发进阶(三十二)</h1><h2 id="开启跨域"><a href="#开启跨域" class="headerlink" title="开启跨域"></a>开启跨域</h2><p>安装<code>django-cors-headers</code></p>
<ol>
<li>添加应用</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">&#x27;django.contrib.admin&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.auth&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.contenttypes&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.sessions&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.messages&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.staticfiles&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;rest_framework&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;corsheaders&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;user.apps.UserConfig&#x27;</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>2.添加中间件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">MIDDLEWARE = [</span><br><span class="line">    <span class="string">&#x27;django.middleware.security.SecurityMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.sessions.middleware.SessionMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;corsheaders.middleware.CorsMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.middleware.common.CommonMiddleware&#x27;</span>,</span><br><span class="line">    <span class="comment"># &#x27;django.middleware.csrf.CsrfViewMiddleware&#x27;,</span></span><br><span class="line">    <span class="string">&#x27;django.contrib.auth.middleware.AuthenticationMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.messages.middleware.MessageMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.middleware.clickjacking.XFrameOptionsMiddleware&#x27;</span>,</span><br><span class="line"></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>添加白名单</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CORS_ORIGIN_ALLOW_ALL = <span class="literal">True</span>  <span class="comment"># 所有域名都允许，默认False</span></span><br><span class="line"><span class="comment"># CORS_ORIGIN_WHITELIST = [</span></span><br><span class="line"><span class="comment">#     # 指定可以访问后端的域名</span></span><br><span class="line"><span class="comment">#     &quot;http://127.0.0.1:8080&quot;,</span></span><br><span class="line"><span class="comment">#     &quot;http://localhost:8080&quot;,</span></span><br><span class="line"><span class="comment"># ]</span></span><br><span class="line">CORS_ALLOW_CREDENTIALS = <span class="literal">True</span>  <span class="comment"># 语序跨域时携带Cookie，默认False</span></span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8hqcrkp9ej31b30u01hq.jpg" alt="登录完成"></p>
<h2 id="HttpRunner"><a href="#HttpRunner" class="headerlink" title="HttpRunner"></a>HttpRunner</h2><p>接口测试有哪些方法</p>
<ul>
<li>工具：Postman</li>
<li>使用代码创建接口测试框架</li>
</ul>
<p>用例数据存放在哪？excel</p>
<p>unittest + ddt 数据驱动，测数据与测试代码分离</p>
<p>日志器</p>
<p>配置文件</p>
<p>数据库校验：pymysql</p>
<p>发起请求：request</p>
<p>参数化：正则匹配</p>
<p>接口依赖：动态创建类属性的方式来处理</p>
<p>Jenkins实现持续集成</p>
<p>HttpRunner 将上述框架进行封装，几乎可以零代码，高效率的进行测试</p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> pip install httprunner</span></span><br></pre></td></tr></table></figure>

<h3 id="创建工程"><a href="#创建工程" class="headerlink" title="创建工程"></a>创建工程</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> hrun --startproject httprunner_learn</span></span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8hrbjligej30ki0fkta5.jpg" alt="创建项目"></p>
<h3 id="最小单元"><a href="#最小单元" class="headerlink" title="最小单元"></a>最小单元</h3><p>新建<code>api/login.yml</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">登录接口</span></span><br><span class="line"><span class="attr">variables:</span></span><br><span class="line">    <span class="attr">var1:</span> <span class="string">value1</span></span><br><span class="line">    <span class="attr">var2:</span> <span class="string">value2</span></span><br><span class="line"><span class="attr">request:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">http://127.0.0.1:8000/user/login/</span></span><br><span class="line">    <span class="attr">method:</span> <span class="string">POST</span></span><br><span class="line">    <span class="attr">headers:</span></span><br><span class="line">        <span class="attr">Content-Type:</span> <span class="string">&quot;application/json&quot;</span></span><br><span class="line">    <span class="attr">json:</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">zhongxin</span></span><br><span class="line">        <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line"><span class="attr">validate:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">eq:</span> [<span class="string">&quot;status_code&quot;</span>, <span class="number">200</span>]</span><br></pre></td></tr></table></figure>

<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zhongxindeMacBook-Pro:httprunner_learn zhongxin$ hrun api/login.ym</span><br></pre></td></tr></table></figure>

<h3 id="查看报告"><a href="#查看报告" class="headerlink" title="查看报告"></a>查看报告</h3><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8hrgd3ueej31b30u0qlz.jpg" alt="报告"></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8hrhph7lrj31b30u01dd.jpg" alt="测试2"></p>
<h3 id="使用环境变量"><a href="#使用环境变量" class="headerlink" title="使用环境变量"></a>使用环境变量</h3><p><code>.env</code>文件:<code>$&#123;ENV(USERNAME)&#125;</code></p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">USERNAME=zhongxin</span><br><span class="line">PASSWORD=123456</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">登录接口</span></span><br><span class="line"><span class="attr">variables:</span></span><br><span class="line">    <span class="attr">var1:</span> <span class="string">value1</span></span><br><span class="line">    <span class="attr">var2:</span> <span class="string">value2</span></span><br><span class="line"><span class="attr">request:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">http://127.0.0.1:8000/user/login/</span></span><br><span class="line">    <span class="attr">method:</span> <span class="string">POST</span></span><br><span class="line">    <span class="attr">headers:</span></span><br><span class="line">        <span class="attr">Content-Type:</span> <span class="string">&quot;application/json&quot;</span></span><br><span class="line">    <span class="attr">json:</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">$&#123;ENV(USERNAME)&#125;</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">$&#123;ENV(PASSWORD)&#125;</span></span><br><span class="line"><span class="attr">validate:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">eq:</span> [<span class="string">&quot;status_code&quot;</span>, <span class="number">200</span>]</span><br></pre></td></tr></table></figure>

<p>查看完整日志：<code> hrun api/login.yml --log-level debug</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">zhongxindeMacBook-Pro:~ zhongxin$ hrun /Users/zhongxin/Desktop/httprunner_learn/api/login.yml --log-level debug</span><br><span class="line">INFO     Loading environment variables from /Users/zhongxin/Desktop/httprunner_learn/.env</span><br><span class="line">DEBUG    Set OS environment variable: USERNAME</span><br><span class="line">DEBUG    Set OS environment variable: PASSWORD</span><br><span class="line">INFO     Start to run testcase: </span><br><span class="line">登录接口</span><br><span class="line">INFO     POST http://127.0.0.1:8000/user/login/</span><br><span class="line">DEBUG    request kwargs(raw): &#123;&#x27;headers&#x27;: &#123;&#x27;Content-Type&#x27;: &#x27;application/json&#x27;&#125;, &#x27;json&#x27;: &#123;&#x27;username&#x27;: &#x27;zhongxin&#x27;, &#x27;password&#x27;: &#x27;123456&#x27;&#125;, &#x27;verify&#x27;: True&#125;</span><br><span class="line">DEBUG    processed request:</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> POST http://127.0.0.1:8000/user/login/</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> kwargs: &#123;<span class="string">&#x27;headers&#x27;</span>: &#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>&#125;, <span class="string">&#x27;json&#x27;</span>: &#123;<span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;zhongxin&#x27;</span>, <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;123456&#x27;</span>&#125;, <span class="string">&#x27;verify&#x27;</span>: True, <span class="string">&#x27;timeout&#x27;</span>: 120&#125;</span></span><br><span class="line">DEBUG    </span><br><span class="line">================== request details ==================</span><br><span class="line">url              : &#x27;http://127.0.0.1:8000/user/login/&#x27;</span><br><span class="line">method           : &#x27;POST&#x27;</span><br><span class="line">headers          : &#123;&#x27;User-Agent&#x27;: &#x27;python-requests/2.22.0&#x27;, &#x27;Accept-Encoding&#x27;: &#x27;gzip, deflate&#x27;, &#x27;Accept&#x27;: &#x27;*/*&#x27;, &#x27;Connection&#x27;: &#x27;keep-alive&#x27;, &#x27;Content-Type&#x27;: &#x27;application/json&#x27;, &#x27;Content-Length&#x27;: &#x27;46&#x27;&#125;</span><br><span class="line">body             : b&#x27;&#123;&quot;username&quot;: &quot;zhongxin&quot;, &quot;password&quot;: &quot;123456&quot;&#125;&#x27;</span><br><span class="line"></span><br><span class="line">DEBUG    </span><br><span class="line">================== response details ==================</span><br><span class="line">ok               : True</span><br><span class="line">url              : &#x27;http://127.0.0.1:8000/user/login/&#x27;</span><br><span class="line">status_code      : 200</span><br><span class="line">reason           : &#x27;OK&#x27;</span><br><span class="line">cookies          : &#123;&#125;</span><br><span class="line">encoding         : None</span><br><span class="line">headers          : &#123;&#x27;Date&#x27;: &#x27;Thu, 31 Oct 2019 14:45:53 GMT&#x27;, &#x27;Server&#x27;: &#x27;WSGIServer/0.2 CPython/3.7.1&#x27;, &#x27;Content-Type&#x27;: &#x27;application/json&#x27;, &#x27;Vary&#x27;: &#x27;Accept, Origin&#x27;, &#x27;Allow&#x27;: &#x27;POST, OPTIONS&#x27;, &#x27;X-Frame-Options&#x27;: &#x27;SAMEORIGIN&#x27;, &#x27;Content-Length&#x27;: &#x27;199&#x27;&#125;</span><br><span class="line">content_type     : &#x27;application/json&#x27;</span><br><span class="line">json             : &#123;&#x27;token&#x27;: &#x27;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoxLCJ1c2VybmFtZSI6Inpob25neGluIiwiZXhwIjoxNTcyNjE5NTUzLCJlbWFpbCI6IjQ5MDMzNjUzNEBxcS5jb20ifQ.yzGNYIZhpeoDqHzZKg_VOY9kuBpmhHAxqqfEyn91BHA&#x27;&#125;</span><br><span class="line"></span><br><span class="line">INFO     status_code: 200, response_time(ms): 205.25 ms, response_length: 199 bytes</span><br><span class="line"></span><br><span class="line">DEBUG    start to validate.</span><br><span class="line">DEBUG    extract: status_code	=&gt; 200</span><br><span class="line">DEBUG    validate: status_code equals 200(int)	==&gt; pass</span><br><span class="line">.</span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran 1 test in 0.215s</span><br><span class="line"></span><br><span class="line">OK</span><br><span class="line">DEBUG    No html report template specified, use default.</span><br><span class="line">INFO     Start to render Html report ...</span><br><span class="line">INFO     Generated Html report: /Users/zhongxin/reports/1572533153.html</span><br><span class="line">zhongxindeMacBook-Pro:~ zhongxin$ </span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E4%B8%89%E5%8D%81%E5%85%AD)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="测试游记">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E4%B8%89%E5%8D%81%E5%85%AD)/" itemprop="url">测试开发进阶(三十六)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-03-03T20:10:32+08:00">
                2021-03-03
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E4%B8%89%E5%8D%81%E5%85%AD)/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2021/03/03/测试开发进阶(三十六)/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="测试开发进阶-三十六"><a href="#测试开发进阶-三十六" class="headerlink" title="测试开发进阶(三十六)"></a>测试开发进阶(三十六)</h1><h2 id="项目模块"><a href="#项目模块" class="headerlink" title="项目模块"></a>项目模块</h2><h3 id="list优化"><a href="#list优化" class="headerlink" title="list优化"></a>list优化</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">list</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">    queryset = self.filter_queryset(self.get_queryset())</span><br><span class="line"></span><br><span class="line">    page = self.paginate_queryset(queryset)</span><br><span class="line">    <span class="keyword">if</span> page <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        serializer = self.get_serializer(page, many=<span class="literal">True</span>)</span><br><span class="line">        datas = serializer.data</span><br><span class="line">        datas = get_count_by_project(datas)</span><br><span class="line">        <span class="keyword">return</span> self.get_paginated_response(datas)</span><br><span class="line"></span><br><span class="line">    serializer = self.get_serializer(queryset, many=<span class="literal">True</span>)</span><br><span class="line">    datas = serializer.data</span><br><span class="line">    datas = get_count_by_project(datas)</span><br><span class="line">    <span class="keyword">return</span> Response(datas)</span><br></pre></td></tr></table></figure>

<p>这个<code>list</code>其实就是拷贝了父类中的<code>list</code>方法</p>
<p>使用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">super</span>().<span class="built_in">list</span>(request, *args, **kwargs)</span><br></pre></td></tr></table></figure>

<p>调用父类的<code>list</code>方法</p>
<p>查看返回的<code>Response</code>对象</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8qw8j1ptxj31fn0u0apb.jpg" alt="返回的Response对象"></p>
<p>所以优化为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">list</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">    response = <span class="built_in">super</span>().<span class="built_in">list</span>(request, *args, **kwargs)</span><br><span class="line">    response.data[<span class="string">&#x27;results&#x27;</span>] = get_count_by_project(response.data[<span class="string">&#x27;results&#x27;</span>])</span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>

<h3 id="重写get-serializer-class"><a href="#重写get-serializer-class" class="headerlink" title="重写get_serializer_class"></a>重写get_serializer_class</h3><p><code>names</code>中的<code>serializer</code>使用<code>serializers.ProjectNameSerializer</code></p>
<p>为了让它可以直接使用<code>self.get_serializer</code>方法，重写<code>get_serializer_class</code></p>
<h4 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_serializer_class</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Return the class to use for the serializer.</span></span><br><span class="line"><span class="string">    Defaults to using `self.serializer_class`.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    You may want to override this if you need to provide different</span></span><br><span class="line"><span class="string">    serializations depending on the incoming request.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    (Eg. admins get full serialization, others get basic serialization)</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">assert</span> self.serializer_class <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>, (</span><br><span class="line">        <span class="string">&quot;&#x27;%s&#x27; should either include a `serializer_class` attribute, &quot;</span></span><br><span class="line">        <span class="string">&quot;or override the `get_serializer_class()` method.&quot;</span></span><br><span class="line">        % self.__class__.__name__</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> self.serializer_class</span><br></pre></td></tr></table></figure>
<h4 id="重写"><a href="#重写" class="headerlink" title="重写"></a>重写</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_serializer_class</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="keyword">if</span> self.action == <span class="string">&#x27;names&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> serializers.ProjectNameSerializer</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> self.serializer_class</span><br></pre></td></tr></table></figure>

<h2 id="报告模块"><a href="#报告模块" class="headerlink" title="报告模块"></a>报告模块</h2><h3 id="序列化器"><a href="#序列化器" class="headerlink" title="序列化器"></a>序列化器</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Reports</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ReportsSerializer</span>(<span class="params">serializers.ModelSerializer</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    报告序列化器</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = Reports</span><br><span class="line">        exclude = (<span class="string">&#x27;update_time&#x27;</span>, <span class="string">&#x27;is_delete&#x27;</span>)</span><br><span class="line">        extra_kwargs = &#123;</span><br><span class="line">            <span class="string">&#x27;html&#x27;</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;write_only&#x27;</span>: <span class="literal">True</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&#x27;create_time&#x27;</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;read_only&#x27;</span>: <span class="literal">True</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create</span>(<span class="params">self, validated_data</span>):</span></span><br><span class="line">        report_name = validated_data[<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">        validated_data[<span class="string">&#x27;name&#x27;</span>] = <span class="string">f&quot;<span class="subst">&#123;report_name&#125;</span>_<span class="subst">&#123;datetime.strftime(datetime.now(), <span class="string">&#x27;%Y%m%d%H%M%S&#x27;</span>)&#125;</span>&quot;</span></span><br><span class="line">        report = Reports.objects.create(**validated_data)</span><br><span class="line">        <span class="keyword">return</span> report</span><br></pre></td></tr></table></figure>

<p>从数据库中可以看出其中<code>html</code>是一串字符串，它需要转换成html格式才可以正常展示，所以在接口返回的内容中不应该包含它，设置它为只写模式<code>write_only</code></p>
<p>对<code>create</code>函数进行重定义</p>
<p>下面是数据库中显示的内容</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8uxblkawnj31vq0hmtfn.jpg" alt="数据库"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name = models.CharField(<span class="string">&#x27;报告名称&#x27;</span>, max_length=<span class="number">200</span>, unique=<span class="literal">True</span>, help_text=<span class="string">&#x27;报告名称&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>查看<code>models</code>文件可以看到<code>name</code>字段是唯一的「<code>unique=True</code>」所以我们在添加的时候需要携带上当前的时间信息</p>
<h3 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h3><p>定义一个类<code>ReportsViewSet</code>还是继承<code>ModelViewSet</code></p>
<p>其他和之前的类似</p>
<p>其中要注意的是一个<code>download</code>接口</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.conf <span class="keyword">import</span> settings</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> StreamingHttpResponse</span><br><span class="line"><span class="keyword">from</span> rest_framework.viewsets <span class="keyword">import</span> ModelViewSet</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> permissions</span><br><span class="line"><span class="keyword">from</span> rest_framework.decorators <span class="keyword">import</span> action</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> reports.utils <span class="keyword">import</span> format_output, get_file_contents</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Reports</span><br><span class="line"><span class="keyword">from</span> .serializers <span class="keyword">import</span> ReportsSerializer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ReportsViewSet</span>(<span class="params">ModelViewSet</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    list:</span></span><br><span class="line"><span class="string">    返回测试报告（多个）列表数据</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    create:</span></span><br><span class="line"><span class="string">    创建测试报告</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    retrieve:</span></span><br><span class="line"><span class="string">    返回测试报告（单个）详情数据</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    update:</span></span><br><span class="line"><span class="string">    更新（全）测试报告</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    partial_update:</span></span><br><span class="line"><span class="string">    更新（部分）测试报告</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    destroy:</span></span><br><span class="line"><span class="string">    删除测试报告</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    queryset = Reports.objects.<span class="built_in">filter</span>(is_delete=<span class="literal">False</span>)</span><br><span class="line">    serializer_class = ReportsSerializer</span><br><span class="line">    permission_classes = (permissions.IsAuthenticated,)</span><br><span class="line">    ordering_fields = (<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;name&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">perform_destroy</span>(<span class="params">self, instance</span>):</span></span><br><span class="line">        instance.is_delete = <span class="literal">True</span></span><br><span class="line">        instance.save()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">list</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        response = <span class="built_in">super</span>().<span class="built_in">list</span>(request, *args, **kwargs)</span><br><span class="line">        response.data[<span class="string">&#x27;results&#x27;</span>] = format_output(response.data[<span class="string">&#x27;results&#x27;</span>])</span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"><span class="meta">    @action(<span class="params">detail=<span class="literal">True</span></span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">download</span>(<span class="params">self, request, pk=<span class="literal">None</span></span>):</span></span><br><span class="line">        instance = self.get_object()</span><br><span class="line">        html = instance.html</span><br><span class="line">        name = instance.name</span><br><span class="line">        mtch = re.match(<span class="string">r&#x27;(.*_)\d+&#x27;</span>, name)</span><br><span class="line">        <span class="keyword">if</span> mtch:</span><br><span class="line">            mtch = mtch.group(<span class="number">1</span>) + datetime.strftime(datetime.now(), <span class="string">&#x27;%Y%m%d%H%M%S&#x27;</span>) + <span class="string">&#x27;.html&#x27;</span></span><br><span class="line">        report_dir = os.path.join(settings.BASE_DIR, <span class="string">&#x27;reports&#x27;</span>)</span><br><span class="line">        report_path = os.path.join(report_dir, mtch)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(report_path, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(html)</span><br><span class="line">        response = StreamingHttpResponse(get_file_contents(report_path))</span><br><span class="line">        response[<span class="string">&#x27;Content-Type&#x27;</span>] = <span class="string">&quot;application/octet-stream&quot;</span></span><br><span class="line">        response[<span class="string">&#x27;Content-Disposition&#x27;</span>] = <span class="string">&quot;attachment; filename*=UTF-8&#x27;&#x27;&#123;&#125;&quot;</span>.<span class="built_in">format</span>(name)</span><br><span class="line">        <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>

<p>每次下载之后我们都会在本地存放一次，然后我们需要以数据流的方式返回html报告</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response = StreamingHttpResponse(get_file_contents(report_path))</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_file_contents</span>(<span class="params">filename, chunk_size=<span class="number">512</span></span>):</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename,encoding=<span class="string">&#x27;utf8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            c = f.read(chunk_size)</span><br><span class="line">            <span class="keyword">if</span> c:</span><br><span class="line">                <span class="keyword">yield</span> c</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>这里用到了分段的方式，每512字节返回一次，直到全部返回完毕</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E4%B8%89%E5%8D%81%E5%85%AB)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="测试游记">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E4%B8%89%E5%8D%81%E5%85%AB)/" itemprop="url">测试开发进阶(三十八)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-03-03T20:10:32+08:00">
                2021-03-03
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E4%B8%89%E5%8D%81%E5%85%AB)/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2021/03/03/测试开发进阶(三十八)/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="测试开发进阶-三十八"><a href="#测试开发进阶-三十八" class="headerlink" title="测试开发进阶(三十八)"></a>测试开发进阶(三十八)</h1><h2 id="用例模块"><a href="#用例模块" class="headerlink" title="用例模块"></a>用例模块</h2><p>需要使用httprunner来进行用例的执行与报告的生成</p>
<p>所以我们需要生成一个yaml用例文件，再执行它</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@action(<span class="params">methods=[<span class="string">&#x27;post&#x27;</span>], detail=<span class="literal">True</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">    instance = self.get_object()</span><br><span class="line">    serializer = self.get_serializer(instance, data=request.data)</span><br><span class="line">    serializer.is_valid(raise_exception=<span class="literal">True</span>)</span><br><span class="line">    datas = serializer.validated_data</span><br><span class="line">    env_id = datas.get(<span class="string">&#x27;env_id&#x27;</span>)</span><br><span class="line">    testcase_dir_path = os.path.join(settings.SUITES_DIR, datetime.strftime(datetime.now(), <span class="string">&#x27;%Y%m%d%H%M%S%f&#x27;</span>))</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(testcase_dir_path):</span><br><span class="line">        os.mkdir(testcase_dir_path)</span><br><span class="line">    env = Envs.objects.<span class="built_in">filter</span>(<span class="built_in">id</span>=env_id, is_delete=<span class="literal">False</span>).first()</span><br><span class="line">    <span class="comment"># 生成yaml用例文件</span></span><br><span class="line">    common.generate_testcase_files(instance, env, testcase_dir_path)</span><br><span class="line">    <span class="comment"># 运行用例</span></span><br><span class="line">    <span class="keyword">return</span> common.run_testcase(instance, testcase_dir_path)</span><br></pre></td></tr></table></figure>

<h3 id="生成yaml用例"><a href="#生成yaml用例" class="headerlink" title="生成yaml用例"></a>生成yaml用例</h3><p>官方文档有一个例子：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">config:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">testcase</span> <span class="string">description</span></span><br><span class="line">    <span class="attr">variables:</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">test:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">/api/get-token</span></span><br><span class="line">    <span class="attr">request:</span></span><br><span class="line">        <span class="attr">headers:</span></span><br><span class="line">            <span class="attr">Content-Type:</span> <span class="string">application/json</span></span><br><span class="line">            <span class="attr">User-Agent:</span> <span class="string">python-requests/2.18.4</span></span><br><span class="line">            <span class="attr">app_version:</span> <span class="number">2.8</span><span class="number">.6</span></span><br><span class="line">            <span class="attr">device_sn:</span> <span class="string">FwgRiO7CNA50DSU</span></span><br><span class="line">            <span class="attr">os_platform:</span> <span class="string">ios</span></span><br><span class="line">        <span class="attr">json:</span></span><br><span class="line">            <span class="attr">sign:</span> <span class="string">9c0c7e51c91ae963c833a4ccbab8d683c4a90c98</span></span><br><span class="line">        <span class="attr">method:</span> <span class="string">POST</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">http://127.0.0.1:5000/api/get-token</span></span><br><span class="line">    <span class="attr">extract:</span></span><br><span class="line">        <span class="attr">token:</span> <span class="string">content.token</span></span><br><span class="line">    <span class="attr">validate:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">eq:</span> [<span class="string">status_code</span>, <span class="number">200</span>]</span><br><span class="line">        <span class="bullet">-</span> <span class="attr">eq:</span> [<span class="string">headers.Content-Type</span>, <span class="string">application/json</span>]</span><br><span class="line">        <span class="bullet">-</span> <span class="attr">eq:</span> [<span class="string">content.success</span>, <span class="literal">true</span>]</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">test:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">/api/users/1000</span></span><br><span class="line">    <span class="attr">request:</span></span><br><span class="line">        <span class="attr">headers:</span></span><br><span class="line">            <span class="attr">Content-Type:</span> <span class="string">application/json</span></span><br><span class="line">            <span class="attr">User-Agent:</span> <span class="string">python-requests/2.18.4</span></span><br><span class="line">            <span class="attr">device_sn:</span> <span class="string">FwgRiO7CNA50DSU</span></span><br><span class="line">            <span class="attr">token:</span> <span class="string">$token</span></span><br><span class="line">        <span class="attr">json:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">user1</span></span><br><span class="line">            <span class="attr">password:</span> <span class="string">&#x27;123456&#x27;</span></span><br><span class="line">        <span class="attr">method:</span> <span class="string">POST</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">http://127.0.0.1:5000/api/users/1000</span></span><br><span class="line">    <span class="attr">validate:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">eq:</span> [<span class="string">status_code</span>, <span class="number">201</span>]</span><br><span class="line">        <span class="bullet">-</span> <span class="attr">eq:</span> [<span class="string">headers.Content-Type</span>, <span class="string">application/json</span>]</span><br><span class="line">        <span class="bullet">-</span> <span class="attr">eq:</span> [<span class="string">content.success</span>, <span class="literal">true</span>]</span><br><span class="line">        <span class="bullet">-</span> <span class="attr">eq:</span> [<span class="string">content.msg</span>, <span class="string">user</span> <span class="string">created</span> <span class="string">successfully.</span>]</span><br></pre></td></tr></table></figure>

<p>上述一个yaml对应的json格式为：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;config&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;testcase description&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;request&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;base_url&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;headers&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;User-Agent&quot;</span>: <span class="string">&quot;python-requests/2.18.4&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;variables&quot;</span>: [],</span><br><span class="line">      <span class="attr">&quot;output&quot;</span>: [<span class="string">&quot;token&quot;</span>],</span><br><span class="line">      <span class="attr">&quot;path&quot;</span>: <span class="string">&quot;/abs-path/to/demo-quickstart-2.yml&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;refs&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;env&quot;</span>: &#123;&#125;,</span><br><span class="line">        <span class="attr">&quot;debugtalk&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;variables&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;SECRET_KEY&quot;</span>: <span class="string">&quot;DebugTalk&quot;</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">&quot;functions&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;gen_random_string&quot;</span>: &lt;function gen_random_string at <span class="number">0x108596268</span>&gt;,</span><br><span class="line">            <span class="attr">&quot;get_sign&quot;</span>: &lt;function get_sign at <span class="number">0x1085962f0</span>&gt;,</span><br><span class="line">            <span class="attr">&quot;get_user_id&quot;</span>: &lt;function get_user_id at <span class="number">0x108596378</span>&gt;,</span><br><span class="line">            <span class="attr">&quot;get_account&quot;</span>: &lt;function get_account at <span class="number">0x108596400</span>&gt;,</span><br><span class="line">            <span class="attr">&quot;get_os_platform&quot;</span>: &lt;function get_os_platform at <span class="number">0x108596488</span>&gt;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;def-api&quot;</span>: &#123;&#125;,</span><br><span class="line">        <span class="attr">&quot;def-testcase&quot;</span>: &#123;&#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;teststeps&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;/api/get-token&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;request&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;url&quot;</span>: <span class="string">&quot;http://127.0.0.1:5000/api/get-token&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;method&quot;</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;headers&quot;</span>: &#123;<span class="attr">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span>, <span class="attr">&quot;app_version&quot;</span>: <span class="string">&quot;2.8.6&quot;</span>, <span class="attr">&quot;device_sn&quot;</span>: <span class="string">&quot;FwgRiO7CNA50DSU&quot;</span>, <span class="attr">&quot;os_platform&quot;</span>: <span class="string">&quot;ios&quot;</span>, <span class="attr">&quot;user_agent&quot;</span>: <span class="string">&quot;iOS/10.3&quot;</span>&#125;,</span><br><span class="line">          <span class="attr">&quot;json&quot;</span>: &#123;<span class="attr">&quot;sign&quot;</span>: <span class="string">&quot;9c0c7e51c91ae963c833a4ccbab8d683c4a90c98&quot;</span>&#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;extract&quot;</span>: [</span><br><span class="line">          &#123;<span class="attr">&quot;token&quot;</span>: <span class="string">&quot;content.token&quot;</span>&#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">&quot;validate&quot;</span>: [</span><br><span class="line">          &#123;<span class="attr">&quot;eq&quot;</span>: [<span class="string">&quot;status_code&quot;</span>, <span class="number">200</span>]&#125;,</span><br><span class="line">          &#123;<span class="attr">&quot;eq&quot;</span>: [<span class="string">&quot;headers.Content-Type&quot;</span>, <span class="string">&quot;application/json&quot;</span>]&#125;,</span><br><span class="line">          &#123;<span class="attr">&quot;eq&quot;</span>: [<span class="string">&quot;content.success&quot;</span>, <span class="literal">true</span>]&#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;/api/users/1000&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;request&quot;</span>: &#123;<span class="attr">&quot;url&quot;</span>: <span class="string">&quot;http://127.0.0.1:5000/api/users/1000&quot;</span>, <span class="attr">&quot;method&quot;</span>: <span class="string">&quot;POST&quot;</span>, <span class="attr">&quot;headers&quot;</span>: &#123;<span class="attr">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span>, <span class="attr">&quot;device_sn&quot;</span>: <span class="string">&quot;FwgRiO7CNA50DSU&quot;</span>, <span class="attr">&quot;token&quot;</span>: <span class="string">&quot;$token&quot;</span>&#125;,</span><br><span class="line">        <span class="attr">&quot;json&quot;</span>: &#123;<span class="attr">&quot;name&quot;</span>: <span class="string">&quot;user1&quot;</span>, <span class="attr">&quot;password&quot;</span>: <span class="string">&quot;123456&quot;</span>&#125;&#125;,</span><br><span class="line">        <span class="attr">&quot;validate&quot;</span>: [</span><br><span class="line">          &#123;<span class="attr">&quot;eq&quot;</span>: [<span class="string">&quot;status_code&quot;</span>, <span class="number">201</span>]&#125;,</span><br><span class="line">          &#123;<span class="attr">&quot;eq&quot;</span>: [<span class="string">&quot;headers.Content-Type&quot;</span>, <span class="string">&quot;application/json&quot;</span>]&#125;,</span><br><span class="line">          &#123;<span class="attr">&quot;eq&quot;</span>: [<span class="string">&quot;content.success&quot;</span>, <span class="literal">true</span>]&#125;,</span><br><span class="line">          &#123;<span class="attr">&quot;eq&quot;</span>: [<span class="string">&quot;content.msg&quot;</span>, <span class="string">&quot;user created successfully.&quot;</span>]&#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;...&#125; # another testcase</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>所以我们需要通过一个函数将已有的接口，环境，配置写入一份yaml中</p>
<p>将对应的<code>debugtalk.py</code>存放在yaml文件附近</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_testcase_files</span>(<span class="params">instance, env, testcase_dir_path</span>):</span></span><br><span class="line">    testcase_list = []</span><br><span class="line">    config = &#123;</span><br><span class="line">        <span class="string">&#x27;config&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;name&#x27;</span>: instance.name,</span><br><span class="line">            <span class="string">&#x27;request&#x27;</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;base_url&#x27;</span>: env.base_url <span class="keyword">if</span> env <span class="keyword">else</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    testcase_list.append(config)</span><br><span class="line"></span><br><span class="line">    include = json.loads(instance.include, encoding=<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">    request = json.loads(instance.request, encoding=<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">    interface_name = instance.interface.name</span><br><span class="line">    project_name = instance.interface.project.name</span><br><span class="line">    testcase_dir_path = os.path.join(testcase_dir_path, project_name)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(testcase_dir_path):</span><br><span class="line">        os.mkdir(testcase_dir_path)</span><br><span class="line">        debugtalk_obj = DebugTalks.objects.<span class="built_in">filter</span>(is_delete=<span class="literal">False</span>, project__name=project_name).first()</span><br><span class="line">        <span class="keyword">if</span> debugtalk_obj:</span><br><span class="line">            debugtalk = debugtalk_obj.debugtalk</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            debugtalk = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(os.path.join(testcase_dir_path, <span class="string">&#x27;debugtalk.py&#x27;</span>),</span><br><span class="line">                  mode=<span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf8&#x27;</span>) <span class="keyword">as</span> one_file:</span><br><span class="line">            one_file.write(debugtalk)</span><br><span class="line">        testcase_dir_path = os.path.join(testcase_dir_path, interface_name)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(testcase_dir_path):</span><br><span class="line">            os.mkdir(testcase_dir_path)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;config&#x27;</span> <span class="keyword">in</span> include:</span><br><span class="line">            config_id = include.get(<span class="string">&#x27;config&#x27;</span>)</span><br><span class="line">            config_obj = Configures.objects.<span class="built_in">filter</span>(is_delete=<span class="literal">False</span>, <span class="built_in">id</span>=config_id).first()</span><br><span class="line">            <span class="keyword">if</span> config_obj:</span><br><span class="line">                config_request = json.loads(config_obj.request, encoding=<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">                config_request.get(<span class="string">&#x27;config&#x27;</span>).get(<span class="string">&#x27;request&#x27;</span>).setdefault(<span class="string">&#x27;base_url&#x27;</span>, env.base_url)</span><br><span class="line">                config_request[<span class="string">&#x27;config&#x27;</span>][<span class="string">&#x27;name&#x27;</span>] = instance.name</span><br><span class="line">                testcase_list[<span class="number">0</span>] = config_request</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;testcases&#x27;</span> <span class="keyword">in</span> include:</span><br><span class="line">                <span class="keyword">for</span> t_id <span class="keyword">in</span> include.get(<span class="string">&#x27;testcases&#x27;</span>):</span><br><span class="line">                    testcase_obj = Testcases.objects.<span class="built_in">filter</span>(is_delete=<span class="literal">False</span>, <span class="built_in">id</span>=t_id).first()</span><br><span class="line">                    <span class="keyword">if</span> testcase_obj:</span><br><span class="line">                        <span class="keyword">try</span>:</span><br><span class="line">                            testcase_request = json.loads(testcase_obj.request, encoding=<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">                        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                            testcase_request = <span class="string">&#x27;&#x27;</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        testcase_list.append(testcase_request)</span><br><span class="line">    testcase_list.append(request)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(os.path.join(testcase_dir_path, instance.name + <span class="string">&#x27;.yml&#x27;</span>), <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf8&#x27;</span>) <span class="keyword">as</span> one_file:</span><br><span class="line">        yaml.dump(testcase_list, one_file, allow_unicode=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<h3 id="执行yaml文件"><a href="#执行yaml文件" class="headerlink" title="执行yaml文件"></a>执行yaml文件</h3><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8z26iap8lj30wk0u044w.jpg" alt="https://cn.httprunner.org/development/dev-api/"></p>
<p>从<a target="_blank" rel="noopener" href="https://cn.httprunner.org/development/dev-api/%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%87%BA%EF%BC%8C%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%E4%BC%A0%E5%85%A5yaml%E8%B7%AF%E5%BE%84%E6%9D%A5%E6%89%A7%E8%A1%8C%E6%B5%8B%E8%AF%95">https://cn.httprunner.org/development/dev-api/可以看出，我们可以通过传入yaml路径来执行测试</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run_testcase</span>(<span class="params">instance, testcase_dir_path</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    运行用例</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    :param instance: 实例</span></span><br><span class="line"><span class="string">    :param testcase_dir_path: 用例根目录路径</span></span><br><span class="line"><span class="string">    :return dict</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    runner = HttpRunner()</span><br><span class="line">    <span class="comment"># runner.run(testcase_dir_path)</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        runner.run(testcase_dir_path)</span><br><span class="line">    <span class="keyword">except</span> ParamsError:</span><br><span class="line">        logger.error(<span class="string">&quot;用例参数有误&quot;</span>)</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;用例参数有误&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Response(data, status=<span class="number">400</span>)</span><br><span class="line"></span><br><span class="line">    runner.summary = timestamp_to_datetime(runner.summary, <span class="built_in">type</span>=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        report_name = instance.name</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        report_name = <span class="string">&#x27;被遗弃的报告&#x27;</span> + <span class="string">&#x27;-&#x27;</span> + datetime.strftime(datetime.now(), <span class="string">&#x27;%Y%m%d%H%M%S&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    report_id = create_report(runner, report_name=report_name)</span><br><span class="line">    data_dict = &#123;</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: report_id</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Response(data_dict, status=status.HTTP_201_CREATED)</span><br></pre></td></tr></table></figure>

<p>报告中的时间格式需要进行调整</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_report</span>(<span class="params">runner, report_name=<span class="literal">None</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    创建测试报告</span></span><br><span class="line"><span class="string">    :param runner:</span></span><br><span class="line"><span class="string">    :param report_name:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    time_stamp = <span class="built_in">int</span>(runner.summary[<span class="string">&quot;time&quot;</span>][<span class="string">&quot;start_at&quot;</span>])</span><br><span class="line">    start_datetime = datetime.fromtimestamp(time_stamp).strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)</span><br><span class="line">    runner.summary[<span class="string">&#x27;time&#x27;</span>][<span class="string">&#x27;start_datetime&#x27;</span>] = start_datetime</span><br><span class="line">    <span class="comment"># duration保留3位小数</span></span><br><span class="line">    runner.summary[<span class="string">&#x27;time&#x27;</span>][<span class="string">&#x27;duration&#x27;</span>] = <span class="built_in">round</span>(runner.summary[<span class="string">&#x27;time&#x27;</span>][<span class="string">&#x27;duration&#x27;</span>], <span class="number">3</span>)</span><br><span class="line">    report_name = report_name <span class="keyword">if</span> report_name <span class="keyword">else</span> start_datetime</span><br><span class="line">    runner.summary[<span class="string">&#x27;html_report_name&#x27;</span>] = report_name</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> runner.summary[<span class="string">&#x27;details&#x27;</span>]:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">for</span> record <span class="keyword">in</span> item[<span class="string">&#x27;records&#x27;</span>]:</span><br><span class="line">                record[<span class="string">&#x27;meta_data&#x27;</span>][<span class="string">&#x27;response&#x27;</span>][<span class="string">&#x27;content&#x27;</span>] = record[<span class="string">&#x27;meta_data&#x27;</span>][<span class="string">&#x27;response&#x27;</span>][<span class="string">&#x27;content&#x27;</span>]. \</span><br><span class="line">                    decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">                record[<span class="string">&#x27;meta_data&#x27;</span>][<span class="string">&#x27;response&#x27;</span>][<span class="string">&#x27;cookies&#x27;</span>] = <span class="built_in">dict</span>(record[<span class="string">&#x27;meta_data&#x27;</span>][<span class="string">&#x27;response&#x27;</span>][<span class="string">&#x27;cookies&#x27;</span>])</span><br><span class="line"></span><br><span class="line">                request_body = record[<span class="string">&#x27;meta_data&#x27;</span>][<span class="string">&#x27;request&#x27;</span>][<span class="string">&#x27;body&#x27;</span>]</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">isinstance</span>(request_body, <span class="built_in">bytes</span>):</span><br><span class="line">                    record[<span class="string">&#x27;meta_data&#x27;</span>][<span class="string">&#x27;request&#x27;</span>][<span class="string">&#x27;body&#x27;</span>] = request_body.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">    summary = json.dumps(runner.summary, ensure_ascii=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    report_name = report_name + <span class="string">&#x27;_&#x27;</span> + datetime.strftime(datetime.now(), <span class="string">&#x27;%Y%m%d%H%M%S&#x27;</span>)</span><br><span class="line">    report_path = runner.gen_html_report(html_report_name=report_name)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(report_path, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> stream:</span><br><span class="line">        reports = stream.read()</span><br><span class="line"></span><br><span class="line">    test_report = &#123;</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span>: report_name,</span><br><span class="line">        <span class="string">&#x27;result&#x27;</span>: runner.summary.get(<span class="string">&#x27;success&#x27;</span>),</span><br><span class="line">        <span class="string">&#x27;success&#x27;</span>: runner.summary.get(<span class="string">&#x27;stat&#x27;</span>).get(<span class="string">&#x27;successes&#x27;</span>),</span><br><span class="line">        <span class="string">&#x27;count&#x27;</span>: runner.summary.get(<span class="string">&#x27;stat&#x27;</span>).get(<span class="string">&#x27;testsRun&#x27;</span>),</span><br><span class="line">        <span class="string">&#x27;html&#x27;</span>: reports,</span><br><span class="line">        <span class="string">&#x27;summary&#x27;</span>: summary</span><br><span class="line">    &#125;</span><br><span class="line">    report_obj = Reports.objects.create(**test_report)</span><br><span class="line">    <span class="keyword">return</span> report_obj.<span class="built_in">id</span></span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8z28dxvesj31b30u04ln.jpg" alt="结果"></p>
<p>其他模块的执行与报告展示也调用了这两个函数</p>
<p><a target="_blank" rel="noopener" href="https://github.com/zx490336534/ApiTest">https://github.com/zx490336534/ApiTest</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E4%B8%89%E5%8D%81%E5%9B%9B)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="测试游记">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E4%B8%89%E5%8D%81%E5%9B%9B)/" itemprop="url">测试开发进阶(三十四)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-03-03T20:10:32+08:00">
                2021-03-03
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E4%B8%89%E5%8D%81%E5%9B%9B)/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2021/03/03/测试开发进阶(三十四)/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="测试开发进阶-三十四"><a href="#测试开发进阶-三十四" class="headerlink" title="测试开发进阶(三十四)"></a>测试开发进阶(三十四)</h1><h2 id="数据库模型图"><a href="#数据库模型图" class="headerlink" title="数据库模型图"></a>数据库模型图</h2><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8nkdchqsbj30ya0u07cd.jpg" alt="数据库模型图"></p>
<h2 id="创建app"><a href="#创建app" class="headerlink" title="创建app"></a>创建app</h2><p>根据上面的数据库设计，创建9个app</p>
<ul>
<li>configures</li>
<li>debugtalks</li>
<li>envs</li>
<li>interfaces</li>
<li>projects</li>
<li>reports</li>
<li>testsuits</li>
<li>testcases</li>
<li>user</li>
</ul>
<p>完成注册</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">sys.path.insert(<span class="number">0</span>, os.path.join(BASE_DIR, <span class="string">&#x27;apps&#x27;</span>))</span><br><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">&#x27;django.contrib.admin&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.auth&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.contenttypes&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.sessions&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.messages&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.staticfiles&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;rest_framework&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;corsheaders&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;configures.apps.ConfiguresConfig&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;debugtalks.apps.DebugtalksConfig&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;envs.apps.EnvsConfig&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;interfaces.apps.InterfacesConfig&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;projects.apps.ProjectsConfig&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;reports.apps.ReportsConfig&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;testsuits.apps.TestsuitsConfig&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;testcases.apps.TestcasesConfig&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;user.apps.UserConfig&#x27;</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8nkvg37fnj317q0skwme.jpg" alt="项目结构"></p>
<h2 id="抽象数据库基类"><a href="#抽象数据库基类" class="headerlink" title="抽象数据库基类"></a>抽象数据库基类</h2><p>从数据库模型图可以看出，有很多部分都重复了</p>
<ul>
<li>create_time</li>
<li>update_time</li>
<li>is_delete</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseModel</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    数据库表公共字段</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    create_time = models.DateTimeField(auto_now_add=<span class="literal">True</span>, verbose_name=<span class="string">&quot;创建时间&quot;</span>, help_text=<span class="string">&quot;创建时间&quot;</span>)</span><br><span class="line">    update_time = models.DateTimeField(auto_now=<span class="literal">True</span>, verbose_name=<span class="string">&quot;更新时间&quot;</span>, help_text=<span class="string">&quot;更新时间&quot;</span>)</span><br><span class="line">    is_delete = models.BooleanField(default=<span class="literal">False</span>, verbose_name=<span class="string">&quot;逻辑删除&quot;</span>, help_text=<span class="string">&quot;逻辑删除&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        <span class="comment"># 为抽象模型类, 用于其他模型来继承，数据库迁移时不会创建BaseModel表</span></span><br><span class="line">        abstract = <span class="literal">True</span></span><br><span class="line">        verbose_name = <span class="string">&quot;公共字段表&quot;</span></span><br><span class="line">        db_table = <span class="string">&#x27;BaseModel&#x27;</span></span><br></pre></td></tr></table></figure>

<p><code>default=False</code>默认情况下不删除</p>
<h2 id="各模块的模型"><a href="#各模块的模型" class="headerlink" title="各模块的模型"></a>各模块的模型</h2><p><code>configures</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># configures.models.Configures</span></span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"><span class="keyword">from</span> utils.base_models <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Configures</span>(<span class="params">BaseModel</span>):</span></span><br><span class="line">    <span class="built_in">id</span> = models.AutoField(verbose_name=<span class="string">&#x27;id主键&#x27;</span>, primary_key=<span class="literal">True</span>, help_text=<span class="string">&#x27;id主键&#x27;</span>)</span><br><span class="line">    name = models.CharField(<span class="string">&#x27;配置名称&#x27;</span>, max_length=<span class="number">50</span>, help_text=<span class="string">&#x27;配置名称&#x27;</span>)</span><br><span class="line">    interface = models.ForeignKey(<span class="string">&#x27;interfaces.Interfaces&#x27;</span>,</span><br><span class="line">                                  on_delete=models.CASCADE,</span><br><span class="line">                                  related_name=<span class="string">&#x27;configures&#x27;</span>,</span><br><span class="line">                                  help_text=<span class="string">&#x27;所属接口&#x27;</span>)</span><br><span class="line">    author = models.CharField(<span class="string">&#x27;编写人员&#x27;</span>, max_length=<span class="number">50</span>, help_text=<span class="string">&#x27;编写人员&#x27;</span>)</span><br><span class="line">    request = models.TextField(<span class="string">&#x27;请求信息&#x27;</span>, help_text=<span class="string">&#x27;请求信息&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">&#x27;tb_configures&#x27;</span></span><br><span class="line">        verbose_name = <span class="string">&#x27;配置信息&#x27;</span></span><br><span class="line">        verbose_name_plural = verbose_name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br></pre></td></tr></table></figure>
<p><code>debugtalks</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># debugtalks.models.DebugTalks</span></span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"><span class="keyword">from</span> utils.base_models <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DebugTalks</span>(<span class="params">BaseModel</span>):</span></span><br><span class="line">    <span class="built_in">id</span> = models.AutoField(verbose_name=<span class="string">&#x27;id主键&#x27;</span>, primary_key=<span class="literal">True</span>, help_text=<span class="string">&#x27;id主键&#x27;</span>)</span><br><span class="line">    name = models.CharField(<span class="string">&#x27;debugtalk文件名称&#x27;</span>, max_length=<span class="number">200</span>, default=<span class="string">&#x27;debugtalk.py&#x27;</span>, help_text=<span class="string">&#x27;debugtalk文件名称&#x27;</span>)</span><br><span class="line">    debugtalk = models.TextField(null=<span class="literal">True</span>, default=<span class="string">&#x27;#debugtalk.py&#x27;</span>, help_text=<span class="string">&#x27;debugtalk.py文件&#x27;</span>)</span><br><span class="line">    project = models.OneToOneField(<span class="string">&#x27;projects.Projects&#x27;</span>, on_delete=models.CASCADE,</span><br><span class="line">                                   related_name=<span class="string">&#x27;debugtalks&#x27;</span>, help_text=<span class="string">&#x27;所属项目&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">&#x27;tb_debugtalks&#x27;</span></span><br><span class="line">        verbose_name = <span class="string">&#x27;debugtalk.py文件&#x27;</span></span><br><span class="line">        verbose_name_plural = verbose_name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br></pre></td></tr></table></figure>
<p><code>interfaces</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># interfaces.models.Interfaces</span></span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"><span class="keyword">from</span> utils.base_models <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Interfaces</span>(<span class="params">BaseModel</span>):</span></span><br><span class="line">    <span class="built_in">id</span> = models.AutoField(verbose_name=<span class="string">&#x27;id主键&#x27;</span>, primary_key=<span class="literal">True</span>, help_text=<span class="string">&#x27;id主键&#x27;</span>)</span><br><span class="line">    name = models.CharField(<span class="string">&#x27;接口名称&#x27;</span>, max_length=<span class="number">200</span>, unique=<span class="literal">True</span>, help_text=<span class="string">&#x27;接口名称&#x27;</span>)</span><br><span class="line">    project = models.ForeignKey(<span class="string">&#x27;projects.Projects&#x27;</span>, on_delete=models.CASCADE,</span><br><span class="line">                                related_name=<span class="string">&#x27;interfaces&#x27;</span>, help_text=<span class="string">&#x27;所属项目&#x27;</span>)</span><br><span class="line">    tester = models.CharField(<span class="string">&#x27;测试人员&#x27;</span>, max_length=<span class="number">50</span>, help_text=<span class="string">&#x27;测试人员&#x27;</span>)</span><br><span class="line">    desc = models.CharField(<span class="string">&#x27;简要描述&#x27;</span>, max_length=<span class="number">200</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>, help_text=<span class="string">&#x27;简要描述&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">&#x27;tb_interfaces&#x27;</span></span><br><span class="line">        verbose_name = <span class="string">&#x27;接口信息&#x27;</span></span><br><span class="line">        verbose_name_plural = verbose_name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br></pre></td></tr></table></figure>
<p><code>projects</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># projects.models.Projects</span></span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"><span class="keyword">from</span> utils.base_models <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Projects</span>(<span class="params">BaseModel</span>):</span></span><br><span class="line">    <span class="built_in">id</span> = models.AutoField(verbose_name=<span class="string">&#x27;id主键&#x27;</span>, primary_key=<span class="literal">True</span>, help_text=<span class="string">&#x27;id主键&#x27;</span>)</span><br><span class="line">    name = models.CharField(<span class="string">&#x27;项目名称&#x27;</span>, max_length=<span class="number">200</span>, unique=<span class="literal">True</span>, help_text=<span class="string">&#x27;项目名称&#x27;</span>)</span><br><span class="line">    leader = models.CharField(<span class="string">&#x27;负责人&#x27;</span>, max_length=<span class="number">50</span>, help_text=<span class="string">&#x27;项目负责人&#x27;</span>)</span><br><span class="line">    tester = models.CharField(<span class="string">&#x27;测试人员&#x27;</span>, max_length=<span class="number">50</span>, help_text=<span class="string">&#x27;项目测试人员&#x27;</span>)</span><br><span class="line">    programmer = models.CharField(<span class="string">&#x27;开发人员&#x27;</span>, max_length=<span class="number">50</span>, help_text=<span class="string">&#x27;开发人员&#x27;</span>)</span><br><span class="line">    publish_app = models.CharField(<span class="string">&#x27;发布应用&#x27;</span>, max_length=<span class="number">100</span>, help_text=<span class="string">&#x27;发布应用&#x27;</span>)</span><br><span class="line">    desc = models.CharField(<span class="string">&#x27;简要描述&#x27;</span>, max_length=<span class="number">200</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>, default=<span class="string">&#x27;&#x27;</span>, help_text=<span class="string">&#x27;简要描述&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">&#x27;tb_projects&#x27;</span></span><br><span class="line">        verbose_name = <span class="string">&#x27;项目信息&#x27;</span></span><br><span class="line">        verbose_name_plural = verbose_name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br></pre></td></tr></table></figure>
<p><code>reports</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># reports.models.Reports</span></span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"><span class="keyword">from</span> utils.base_models <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Reports</span>(<span class="params">BaseModel</span>):</span></span><br><span class="line">    <span class="built_in">id</span> = models.AutoField(verbose_name=<span class="string">&#x27;id主键&#x27;</span>, primary_key=<span class="literal">True</span>, help_text=<span class="string">&#x27;id主键&#x27;</span>)</span><br><span class="line">    name = models.CharField(<span class="string">&#x27;报告名称&#x27;</span>, max_length=<span class="number">200</span>, unique=<span class="literal">True</span>, help_text=<span class="string">&#x27;报告名称&#x27;</span>)</span><br><span class="line">    result = models.BooleanField(<span class="string">&#x27;执行结果&#x27;</span>, default=<span class="number">1</span>, help_text=<span class="string">&#x27;执行结果&#x27;</span>)   <span class="comment"># 1为成功, 0为失败</span></span><br><span class="line">    count = models.IntegerField(<span class="string">&#x27;用例总数&#x27;</span>, help_text=<span class="string">&#x27;总用例数&#x27;</span>)</span><br><span class="line">    success = models.IntegerField(<span class="string">&#x27;成功总数&#x27;</span>, help_text=<span class="string">&#x27;成功总数&#x27;</span>)</span><br><span class="line">    html = models.TextField(<span class="string">&#x27;报告HTML源码&#x27;</span>, help_text=<span class="string">&#x27;报告HTML源码&#x27;</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>, default=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    summary = models.TextField(<span class="string">&#x27;报告详情&#x27;</span>, help_text=<span class="string">&#x27;报告详情&#x27;</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>, default=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">&#x27;tb_reports&#x27;</span></span><br><span class="line">        verbose_name = <span class="string">&#x27;测试报告&#x27;</span></span><br><span class="line">        verbose_name_plural = verbose_name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br></pre></td></tr></table></figure>
<p><code>testcases</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># testcases.models.Testcases</span></span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"><span class="keyword">from</span> utils.base_models <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Testcases</span>(<span class="params">BaseModel</span>):</span></span><br><span class="line">    <span class="built_in">id</span> = models.AutoField(verbose_name=<span class="string">&#x27;id主键&#x27;</span>, primary_key=<span class="literal">True</span>, help_text=<span class="string">&#x27;id主键&#x27;</span>)</span><br><span class="line">    name = models.CharField(<span class="string">&#x27;用例名称&#x27;</span>, max_length=<span class="number">50</span>, unique=<span class="literal">True</span>, help_text=<span class="string">&#x27;用例名称&#x27;</span>)</span><br><span class="line">    interface = models.ForeignKey(<span class="string">&#x27;interfaces.Interfaces&#x27;</span>, on_delete=models.CASCADE,</span><br><span class="line">                                  help_text=<span class="string">&#x27;所属接口&#x27;</span>)</span><br><span class="line">    <span class="comment"># include = models.ForeignKey(&#x27;&#x27;, on_delete=models.SET_NULL, null=True, related_name=&#x27;testcases&#x27;)</span></span><br><span class="line">    include = models.TextField(<span class="string">&#x27;前置&#x27;</span>, null=<span class="literal">True</span>, help_text=<span class="string">&#x27;用例执行前置顺序&#x27;</span>)</span><br><span class="line">    author = models.CharField(<span class="string">&#x27;编写人员&#x27;</span>, max_length=<span class="number">50</span>, help_text=<span class="string">&#x27;编写人员&#x27;</span>)</span><br><span class="line">    request = models.TextField(<span class="string">&#x27;请求信息&#x27;</span>, help_text=<span class="string">&#x27;请求信息&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">&#x27;tb_testcases&#x27;</span></span><br><span class="line">        verbose_name = <span class="string">&#x27;用例信息&#x27;</span></span><br><span class="line">        verbose_name_plural = verbose_name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br></pre></td></tr></table></figure>
<p><code>testsuits</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># testsuits.models.Testsuits</span></span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"><span class="keyword">from</span> utils.base_models <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Testsuits</span>(<span class="params">BaseModel</span>):</span></span><br><span class="line">    <span class="built_in">id</span> = models.AutoField(verbose_name=<span class="string">&#x27;id主键&#x27;</span>, primary_key=<span class="literal">True</span>, help_text=<span class="string">&#x27;id主键&#x27;</span>)</span><br><span class="line">    name = models.CharField(<span class="string">&#x27;套件名称&#x27;</span>, max_length=<span class="number">200</span>, unique=<span class="literal">True</span>, help_text=<span class="string">&#x27;套件名称&#x27;</span>)</span><br><span class="line">    project = models.ForeignKey(<span class="string">&#x27;projects.Projects&#x27;</span>, on_delete=models.CASCADE,</span><br><span class="line">                                related_name=<span class="string">&#x27;testsuits&#x27;</span>, help_text=<span class="string">&#x27;所属项目&#x27;</span>)</span><br><span class="line">    <span class="comment"># include = models.TextField(null=False)</span></span><br><span class="line">    include = models.TextField(<span class="string">&#x27;包含的接口&#x27;</span>, null=<span class="literal">False</span>, help_text=<span class="string">&#x27;包含的接口&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">&#x27;tb_testsuits&#x27;</span></span><br><span class="line">        verbose_name = <span class="string">&#x27;套件信息&#x27;</span></span><br><span class="line">        verbose_name_plural = verbose_name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br></pre></td></tr></table></figure>

<h2 id="projects需求"><a href="#projects需求" class="headerlink" title="projects需求"></a><code>projects</code>需求</h2><ul>
<li>删除项目时，只进行逻辑删除</li>
<li>获取项目列表信息时，要求能获取此项目下的「接口总数」，「用例总数」，「配置总数」，「套件总数」，同时输出创建时间，格式为2019-11-05 11:43:00</li>
<li>要求提供获取此项目下的所有项目名的接口</li>
<li>要求提供获取此项目下的所有接口信息的接口</li>
</ul>
<h3 id="序列化器"><a href="#序列化器" class="headerlink" title="序列化器"></a>序列化器</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Projects</span><br><span class="line"><span class="keyword">from</span> debugtalks.models <span class="keyword">import</span> DebugTalks</span><br><span class="line"><span class="keyword">from</span> interfaces.models <span class="keyword">import</span> Interfaces</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProjectModelSerializer</span>(<span class="params">serializers.ModelSerializer</span>):</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = Projects</span><br><span class="line">        exclude = (<span class="string">&#x27;update_time&#x27;</span>, <span class="string">&#x27;is_delete&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        extra_kwargs = &#123;</span><br><span class="line">            <span class="string">&#x27;create_time&#x27;</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;read_only&#x27;</span>: <span class="literal">True</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create</span>(<span class="params">self, validated_data</span>):</span></span><br><span class="line">        project_obj = <span class="built_in">super</span>().create(validated_data)</span><br><span class="line">        DebugTalks.objects.create(project=project_obj)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> project_obj</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProjectNameSerializer</span>(<span class="params">serializers.ModelSerializer</span>):</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = Projects</span><br><span class="line">        fields = (<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;name&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InterfaceNameSerializer</span>(<span class="params">serializers.ModelSerializer</span>):</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = Interfaces</span><br><span class="line">        fields = (<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;tester&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InterfacesByProjectIdSerializer</span>(<span class="params">serializers.ModelSerializer</span>):</span></span><br><span class="line">    interfaces_set = InterfaceNameSerializer(read_only=<span class="literal">True</span>, many=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = Projects</span><br><span class="line">        fields = (<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;interfaces_set&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h3><p>继承<code>ModelViewSet</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.viewsets <span class="keyword">import</span> ModelViewSet</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> permissions</span><br><span class="line"><span class="keyword">from</span> rest_framework.decorators <span class="keyword">import</span> action</span><br><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"><span class="keyword">from</span> rest_framework.exceptions <span class="keyword">import</span> NotFound</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> serializer</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Projects</span><br><span class="line"><span class="keyword">from</span> .utils <span class="keyword">import</span> get_count_by_project</span><br><span class="line"><span class="keyword">from</span> interfaces.models <span class="keyword">import</span> Interfaces</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProjectsViewSet</span>(<span class="params">ModelViewSet</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    list:</span></span><br><span class="line"><span class="string">    返回项目（多个）列表数据</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    create:</span></span><br><span class="line"><span class="string">    创建项目</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    retrieve:</span></span><br><span class="line"><span class="string">    返回项目（单个）详情数据</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    update:</span></span><br><span class="line"><span class="string">    更新（全）项目</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    partial_update:</span></span><br><span class="line"><span class="string">    更新（部分）项目</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    destroy:</span></span><br><span class="line"><span class="string">    删除项目</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    names:</span></span><br><span class="line"><span class="string">    返回所有项目ID和名称</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    interfaces:</span></span><br><span class="line"><span class="string">    返回某个项目的所有接口信息（ID和名称）</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    queryset = Projects.objects.<span class="built_in">filter</span>(is_delete=<span class="literal">False</span>)</span><br><span class="line">    serializer_class = serializer.ProjectModelSerializer</span><br><span class="line">    permission_classes = (permissions.IsAuthenticated,)</span><br><span class="line">    ordering_fields = (<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;name&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">perform_destroy</span>(<span class="params">self, instance</span>):</span></span><br><span class="line">        instance.is_delete = <span class="literal">True</span></span><br><span class="line">        instance.save()  <span class="comment"># 逻辑删除</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @action(<span class="params">methods=[<span class="string">&#x27;get&#x27;</span>], detail=<span class="literal">False</span></span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">names</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        queryset = self.get_queryset()</span><br><span class="line">        serializer = serializer.ProjectNameSerializer(instance=queryset, many=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> Response(serializer.data)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @action(<span class="params">methods=[<span class="string">&#x27;get&#x27;</span>], detail=<span class="literal">True</span></span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">interfaces</span>(<span class="params">self, request, pk=<span class="literal">None</span></span>):</span></span><br><span class="line">        interface_objs = Interfaces.objects.<span class="built_in">filter</span>(project_id=pk, is_delete=<span class="literal">False</span>)</span><br><span class="line">        one_list = []</span><br><span class="line">        <span class="keyword">for</span> obj <span class="keyword">in</span> interface_objs:</span><br><span class="line">            one_list.append(&#123;</span><br><span class="line">                <span class="string">&#x27;id&#x27;</span>: obj.<span class="built_in">id</span>,</span><br><span class="line">                <span class="string">&#x27;name&#x27;</span>: obj.name</span><br><span class="line">            &#125;)</span><br><span class="line">        <span class="keyword">return</span> Response(data=one_list)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">list</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        queryset = self.filter_queryset(self.get_queryset())</span><br><span class="line"></span><br><span class="line">        page = self.paginate_queryset(queryset)</span><br><span class="line">        <span class="keyword">if</span> page <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            serializer = self.get_serializer(page, many=<span class="literal">True</span>)</span><br><span class="line">            datas = serializer.data</span><br><span class="line">            datas = get_count_by_project(datas)</span><br><span class="line">            <span class="keyword">return</span> self.get_paginated_response(datas)</span><br><span class="line"></span><br><span class="line">        serializer = self.get_serializer(queryset, many=<span class="literal">True</span>)</span><br><span class="line">        datas = serializer.data</span><br><span class="line">        datas = get_count_by_project(datas)</span><br><span class="line">        <span class="keyword">return</span> Response(datas)</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E4%B8%80)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="测试游记">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E4%B8%80)/" itemprop="url">测试开发进阶(一)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-03-03T20:10:31+08:00">
                2021-03-03
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E4%B8%80)/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2021/03/03/测试开发进阶(一)/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="测试开发进阶-一"><a href="#测试开发进阶-一" class="headerlink" title="测试开发进阶(一)"></a>测试开发进阶(一)</h1><h2 id="虚拟环境"><a href="#虚拟环境" class="headerlink" title="虚拟环境"></a>虚拟环境</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> pip install virtualenv</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> pip install virtualenvwrapper-win <span class="comment"># windows下的管理工具</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> pip install virtualenvwrapper</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> pip install pipenv</span></span><br></pre></td></tr></table></figure>

<h3 id="查看已安装的虚拟环境"><a href="#查看已安装的虚拟环境" class="headerlink" title="查看已安装的虚拟环境"></a>查看已安装的虚拟环境</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> workon</span> </span><br></pre></td></tr></table></figure>

<h3 id="Windows修改安装的位置"><a href="#Windows修改安装的位置" class="headerlink" title="Windows修改安装的位置"></a>Windows修改安装的位置</h3><p>新增环境变量</p>
<ul>
<li>变量名：<code>WORKON_HOME</code></li>
<li>变量值：虚拟环境存放路径</li>
</ul>
<h3 id="Linux修改安装的位置"><a href="#Linux修改安装的位置" class="headerlink" title="Linux修改安装的位置"></a>Linux修改安装的位置</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> pip后建立软连接</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ln -s /usr/<span class="built_in">local</span>/python3/bin/virtualenv /usr/bin/virtualenv</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Linux配置虚拟环境路径</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> vim ~/.bashrc</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> mac配置</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> vim ~/.bash_profile</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 新增</span></span><br><span class="line">export VIRTUALENVWRAPPER_PYTHON=/usr/bin/python</span><br><span class="line">export WORKON_HOME=$HOME/.virtualenvs</span><br><span class="line"></span><br><span class="line">source /usr/local/python3/bin/virtualenvwrapper.sh</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 执行命令，让配置生效</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Linux</span></span><br><span class="line">source ~/.bashrc</span><br><span class="line"><span class="meta">#</span><span class="bash"> mac</span></span><br><span class="line">source ~/.bash_profile</span><br></pre></td></tr></table></figure>

<h3 id="创建虚拟环境"><a href="#创建虚拟环境" class="headerlink" title="创建虚拟环境"></a>创建虚拟环境</h3><p><code>-p</code>指定解释器</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> mkvirtualenv -p python3 test_py3</span></span><br></pre></td></tr></table></figure>

<h3 id="进入虚拟环境"><a href="#进入虚拟环境" class="headerlink" title="进入虚拟环境"></a>进入虚拟环境</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> workon test_py3</span></span><br></pre></td></tr></table></figure>

<h3 id="退出虚拟环境"><a href="#退出虚拟环境" class="headerlink" title="退出虚拟环境"></a>退出虚拟环境</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> deactivate</span></span><br></pre></td></tr></table></figure>

<h3 id="删除虚拟环境"><a href="#删除虚拟环境" class="headerlink" title="删除虚拟环境"></a>删除虚拟环境</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> rmvirtualenv test_py3</span></span><br></pre></td></tr></table></figure>

<h3 id="导出虚拟环境中所有的模块和包"><a href="#导出虚拟环境中所有的模块和包" class="headerlink" title="导出虚拟环境中所有的模块和包"></a>导出虚拟环境中所有的模块和包</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> pip frezz &gt;requirements.txt</span></span><br></pre></td></tr></table></figure>

<h3 id="安装requirements-txt中的包"><a href="#安装requirements-txt中的包" class="headerlink" title="安装requirements.txt中的包"></a>安装requirements.txt中的包</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> pip install -r requirements.txt</span></span><br></pre></td></tr></table></figure>

<h3 id="virtualenv存在的问题"><a href="#virtualenv存在的问题" class="headerlink" title="virtualenv存在的问题"></a>virtualenv存在的问题</h3><p>virtualenv卸载一个包之后，相关依赖不会被同步卸载</p>
<h2 id="pipenv"><a href="#pipenv" class="headerlink" title="pipenv"></a>pipenv</h2><p><strong>与项目绑定</strong></p>
<h3 id="创建虚拟环境-1"><a href="#创建虚拟环境-1" class="headerlink" title="创建虚拟环境"></a>创建虚拟环境</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> pipenv install</span></span><br></pre></td></tr></table></figure>

<h3 id="进入虚拟环境-1"><a href="#进入虚拟环境-1" class="headerlink" title="进入虚拟环境"></a>进入虚拟环境</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> pipenv shell</span></span><br></pre></td></tr></table></figure>

<h3 id="退出虚拟环境-1"><a href="#退出虚拟环境-1" class="headerlink" title="退出虚拟环境"></a>退出虚拟环境</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exit</span><br></pre></td></tr></table></figure>

<h3 id="安装包"><a href="#安装包" class="headerlink" title="安装包"></a>安装包</h3><p>在哪个路径下操作，就安装到哪个环境</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> pipenv install requests</span></span><br></pre></td></tr></table></figure>

<h3 id="查看依赖"><a href="#查看依赖" class="headerlink" title="查看依赖"></a>查看依赖</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> pipenv graph</span></span><br></pre></td></tr></table></figure>

<h3 id="卸载包"><a href="#卸载包" class="headerlink" title="卸载包"></a>卸载包</h3><p>当前环境的依赖不会被卸载</p>
<p>移植<code>Pipfile</code>和<code>Pipfile.lock</code>后重新生成不会携带</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> pipenv uninstall requests</span></span><br></pre></td></tr></table></figure>

<h3 id="开发环境安装"><a href="#开发环境安装" class="headerlink" title="开发环境安装"></a>开发环境安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> pipenv install --dev requests</span></span><br></pre></td></tr></table></figure>

<h3 id="导出包"><a href="#导出包" class="headerlink" title="导出包"></a>导出包</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> pipenv lock -r &gt;requirements.txt</span></span><br></pre></td></tr></table></figure>

<h3 id="删除虚拟环境-1"><a href="#删除虚拟环境-1" class="headerlink" title="删除虚拟环境"></a>删除虚拟环境</h3><p><code>Pipfile</code>和<code>Pipfile.lock</code>不会被删除</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> pipenv --rm</span></span><br></pre></td></tr></table></figure>

<h2 id="编码规范"><a href="#编码规范" class="headerlink" title="编码规范"></a>编码规范</h2><blockquote>
<p>python之禅</p>
</blockquote>
<blockquote>
<p>import this</p>
<p>The Zen of Python, by Tim Peters</p>
<p>Beautiful is better than ugly.</p>
<p>Explicit is better than implicit.</p>
<p>Simple is better than complex.</p>
<p>Complex is better than complicated.</p>
<p>Flat is better than nested.</p>
<p>Sparse is better than dense.</p>
<p>Readability counts.</p>
<p>Special cases aren’t special enough to break the rules.</p>
<p>Although practicality beats purity.</p>
<p>Errors should never pass silently.</p>
<p>Unless explicitly silenced.</p>
<p>In the face of ambiguity, refuse the temptation to guess.</p>
<p>There should be one– and preferably only one –obvious way to do it.</p>
<p>Although that way may not be obvious at first unless you’re Dutch.</p>
<p>Now is better than never.</p>
<p>Although never is often better than <em>right</em> now.</p>
<p>If the implementation is hard to explain, it’s a bad idea.</p>
<p>If the implementation is easy to explain, it may be a good idea.</p>
<p>Namespaces are one honking great idea – let’s do more of those!</p>
</blockquote>
<h3 id="缩进"><a href="#缩进" class="headerlink" title="缩进"></a>缩进</h3><ul>
<li>每一级缩进使用4个空格</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 左对齐</span></span><br><span class="line">foo = long_function_name(var_one, var_two,</span><br><span class="line">                         var_three, var_four)</span><br><span class="line"><span class="comment"># 换行缩进</span></span><br><span class="line">foo = long_function_name(</span><br><span class="line">   var_one, var_two,</span><br><span class="line">   var_three, var_four)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 用更多的缩进来与其他行区分</span></span><br><span class="line">foo = long_function_name(</span><br><span class="line">   var_one, var_two, var_three,</span><br><span class="line">   var_four)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="行的最大长度"><a href="#行的最大长度" class="headerlink" title="行的最大长度"></a>行的最大长度</h3><ul>
<li>最大79</li>
<li>注释最大72</li>
</ul>
<h3 id="空行"><a href="#空行" class="headerlink" title="空行"></a>空行</h3><ul>
<li>函数之间2个空行</li>
<li>类的方法之间1个空行</li>
</ul>
<h3 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h3><ul>
<li><p>块注释 </p>
<blockquote>
<p>与代码在同一行</p>
</blockquote>
</li>
<li><p>行内注释</p>
</li>
<li><p>文档注释</p>
<blockquote>
<p>第一行：对函数/类整体功能说明</p>
<p>参数说明</p>
<p>:param var_one: 参数1 是干嘛的</p>
<p>:type var_one:int</p>
<p>返回值说明</p>
<p>:return:</p>
</blockquote>
</li>
</ul>
<p>PEP257:<a target="_blank" rel="noopener" href="https://github.com/qiuxiang/pep/blob/master/peps/257.md">https://github.com/qiuxiang/pep/blob/master/peps/257.md</a></p>
<h3 id="模块包导入"><a href="#模块包导入" class="headerlink" title="模块包导入"></a>模块包导入</h3><ul>
<li>先导入python内置模块和包</li>
<li>导入第三方的模块和包</li>
<li>导入自定义的模块和包</li>
</ul>
<blockquote>
<p><code>__all__=[]</code> 使用<code>*</code>导入时候只会导入all的[]中的的内容</p>
</blockquote>
<h2 id="结构化工程"><a href="#结构化工程" class="headerlink" title="结构化工程"></a>结构化工程</h2><p><a target="_blank" rel="noopener" href="https://pythonguidecn.readthedocs.io/zh/latest/writing/structure.html">https://pythonguidecn.readthedocs.io/zh/latest/writing/structure.html</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/03/test/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="测试游记">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/03/03/test/" itemprop="url">test</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-03-03T18:40:46+08:00">
                2021-03-03
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2021/03/03/test/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2021/03/03/test/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h1>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/03/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="测试游记">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/03/03/hello-world/" itemprop="url">Hello World</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-03-03T18:38:33+08:00">
                2021-03-03
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2021/03/03/hello-world/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2021/03/03/hello-world/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/">&lt;i class&#x3D;&quot;fa fa-angle-left&quot;&gt;&lt;&#x2F;i&gt;</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/6/">&lt;i class&#x3D;&quot;fa fa-angle-right&quot;&gt;&lt;&#x2F;i&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpeg"
                alt="" />
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives%7C%7C%20archive">
              
                  <span class="site-state-item-count">51</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/zx490336534" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">测试游记</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  

    
      <script id="dsq-count-scr" src="https://.disqus.com/count.js" async></script>
    

    

  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
