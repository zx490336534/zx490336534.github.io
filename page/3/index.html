<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="测试游记">
<meta property="og:url" content="http://example.com/page/3/index.html">
<meta property="og:site_name" content="测试游记">
<meta property="og:locale">
<meta property="article:author" content="测试游记">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://example.com/page/3/"/>





  <title>测试游记</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?41fc030db57d5570dd22f78997dc4a7e";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




<meta name="generator" content="Hexo 5.4.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">测试游记</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E4%BA%8C%E5%8D%81%E4%BA%8C)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="测试游记">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E4%BA%8C%E5%8D%81%E4%BA%8C)/" itemprop="url">测试开发进阶(二十二)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-03-03T20:10:33+08:00">
                2021-03-03
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E4%BA%8C%E5%8D%81%E4%BA%8C)/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2021/03/03/测试开发进阶(二十二)/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="测试开发进阶-二十二"><a href="#测试开发进阶-二十二" class="headerlink" title="测试开发进阶(二十二)"></a>测试开发进阶(二十二)</h1><p><strong>欢迎关注我的公众号「测试游记」</strong></p>
<p>在<code>projects/models.py</code>中编写</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    创建Person类</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    first_name = models.CharField(max_length=<span class="number">30</span>)</span><br><span class="line">    last_name = models.CharField(max_length=<span class="number">30</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<ol>
<li>每个应用下的数据库模型类，需要在当前应用下的models.py文件中定义</li>
<li>一个数据库模型类相当于一个数据表(Table)</li>
<li>一个数据库模型类需要基础Model或者其子类</li>
<li>定义的一个类属性，就相当于数据库表中的一个字段(<code>first_name</code>,<code>last_name</code>)</li>
<li>默认会创建一个自动递增的id主键</li>
<li>默认创建的数据库名为：应用名小写_数据库模型类小写</li>
</ol>
</blockquote>
<h2 id="修改数据库远程连接权限"><a href="#修改数据库远程连接权限" class="headerlink" title="修改数据库远程连接权限"></a>修改数据库远程连接权限</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> PRIVILEGES <span class="keyword">ON</span> <span class="operator">*</span> . <span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;你的用户名&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;你的密码&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>我这边使用</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> PRIVILEGES <span class="keyword">ON</span> <span class="operator">*</span> . <span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;my_django&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;123456&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>刷新数据库</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flush privileges;</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7ecjj16lbj31eu0rue0t.jpg" alt="连接数据库"></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7ecnrqkg0j30ww0rgjx3.jpg" alt="修改权限"></p>
<h2 id="迁移"><a href="#迁移" class="headerlink" title="迁移"></a>迁移</h2><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7ecq8w762j30g20le14o.jpg" alt="打开manage"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> makemigrations projects</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> migrate projects</span></span><br></pre></td></tr></table></figure>



<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7ecpfywwcj31b30u0h8e.jpg" alt="数据库迁移"></p>
<p>迁移结果查看</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7ecv9pexmj31b30u0k7y.jpg" alt="结果查看"></p>
<h2 id="字段"><a href="#字段" class="headerlink" title="字段"></a>字段</h2><ul>
<li><code>max_length</code> 最大长度</li>
<li><code>unique</code> 设置当前参数唯一</li>
<li><code>verbose_name</code> 设置人性化的字段名</li>
<li><code>help_text</code> 用于API文档中的中文名</li>
<li><code>null</code> 允许为空</li>
<li><code>black</code> 设置前端可以不传递</li>
<li><code>default</code> 设置默认值</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Projects</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    创建Projects模型类</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    name = models.CharField(verbose_name=<span class="string">&#x27;项目名称&#x27;</span>, max_length=<span class="number">200</span>, unique=<span class="literal">True</span>, help_text=<span class="string">&#x27;项目名称&#x27;</span>)</span><br><span class="line">    leader = models.CharField(verbose_name=<span class="string">&#x27;负责人&#x27;</span>, max_length=<span class="number">50</span>, help_text=<span class="string">&#x27;负责人&#x27;</span>)</span><br><span class="line">    tester = models.CharField(verbose_name=<span class="string">&#x27;测试人员&#x27;</span>, max_length=<span class="number">50</span>, help_text=<span class="string">&#x27;测试人员&#x27;</span>)</span><br><span class="line">    programer = models.CharField(verbose_name=<span class="string">&#x27;开发人员&#x27;</span>, max_length=<span class="number">50</span>, help_text=<span class="string">&#x27;开发人员&#x27;</span>)</span><br><span class="line">    publish_app = models.CharField(verbose_name=<span class="string">&#x27;发布应用&#x27;</span>, max_length=<span class="number">50</span>, help_text=<span class="string">&#x27;发布应用&#x27;</span>)</span><br><span class="line">    desc = models.TextField(verbose_name=<span class="string">&#x27;简要描述&#x27;</span>, help_text=<span class="string">&#x27;简要描述&#x27;</span>, blank=<span class="literal">True</span>, default=<span class="string">&#x27;&#x27;</span>, null=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<h3 id="查看新表"><a href="#查看新表" class="headerlink" title="查看新表"></a>查看新表</h3><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7eczu57mwj31b30u0wwm.jpg" alt="新表"></p>
<h3 id="查看表设计"><a href="#查看表设计" class="headerlink" title="查看表设计"></a>查看表设计</h3><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7ed166b0qj31cu0eydia.jpg" alt="查看表设计"></p>
<h2 id="修改数据表名称"><a href="#修改数据表名称" class="headerlink" title="修改数据表名称"></a>修改数据表名称</h2><p>在<code>Projects</code>类中添加</p>
<ul>
<li><code>db_table</code>表名</li>
<li><code>verbose_name</code>:在admin站点中人性化展示</li>
<li><code>verbose_name_plural</code>:复数显示(对照英文在单词后面+s)</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">    db_table = <span class="string">&#x27;tb_projects&#x27;</span></span><br><span class="line">    verbose_name = <span class="string">&#x27;项目&#x27;</span></span><br><span class="line">    verbose_name_plural = <span class="string">&#x27;项目&#x27;</span></span><br></pre></td></tr></table></figure>

<p>再次迁移</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> makemigrations projects</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> migrate projects</span></span><br></pre></td></tr></table></figure>

<h3 id="迁移前："><a href="#迁移前：" class="headerlink" title="迁移前："></a>迁移前：</h3><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7ed3bwhfcj30h80m6acl.jpg" alt="迁移前" style="zoom:50%;" />

<h3 id="迁移后-点击刷新-："><a href="#迁移后-点击刷新-：" class="headerlink" title="迁移后(点击刷新)："></a>迁移后(<strong>点击刷新</strong>)：</h3><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7ed41c6ddj30he0qcq5k.jpg" alt="迁移后" style="zoom:50%;" />

<h3 id="后台站点"><a href="#后台站点" class="headerlink" title="后台站点"></a>后台站点</h3><p>注册站点</p>
<p><code>projects/admin.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Projects, Person</span><br><span class="line"></span><br><span class="line">admin.site.register(Projects)</span><br><span class="line">admin.site.register(Person)</span><br></pre></td></tr></table></figure>

<p>全部迁移</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> makemigrations</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> migrate</span></span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7ee73f419j319z0u049m.jpg" alt="全部迁移"></p>
<img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7ee7f7h4tj30hc0pg0v7.jpg" alt="迁移后" style="zoom:50%;" />

<h4 id="访问admin"><a href="#访问admin" class="headerlink" title="访问admin"></a>访问admin</h4><p><code>http://127.0.0.1:8000/admin</code></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7ee8k5dz4j31b30u0tmo.jpg" alt="访问admin"></p>
<h4 id="创建管理员账户"><a href="#创建管理员账户" class="headerlink" title="创建管理员账户"></a>创建管理员账户</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> createsuperuser</span></span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7ee9kkfc3j31sg0nc0z1.jpg" alt="image-20190927212624337"></p>
<img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7ee9zdl4aj30o20i2mxp.jpg" alt="登录" style="zoom:50%;" />

<img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7eeaqldy5j31160s8dk2.jpg" alt="后台内容" style="zoom:50%;" />

<p>让图中的<code>Persons</code>变为中文：修改<code>projects.models.Person</code>保存后刷新页面</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    创建Person类</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    first_name = models.CharField(max_length=<span class="number">30</span>)</span><br><span class="line">    last_name = models.CharField(max_length=<span class="number">30</span>)</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        verbose_name = <span class="string">&#x27;人&#x27;</span></span><br><span class="line">        verbose_name_plural = <span class="string">&#x27;人们&#x27;</span></span><br></pre></td></tr></table></figure>

<img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7eed1hfx9j31360tqtd8.jpg" alt="修改名称" style="zoom:50%;" />

<p>添加一个项目：</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7eefc9xn9j31b30u0qjn.jpg" alt="添加项目"></p>
<p>查看数据表</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7eefw7rg0j31b30u04kj.jpg" alt="数据表"></p>
<img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7eeih60n6j30ly0m0dgu.jpg" alt="显示" style="zoom:50%;" />

<p>为了让他显示的更人性化在<code>projects.models.Projects</code>中添加：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="keyword">return</span> self.name</span><br></pre></td></tr></table></figure>

<img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7eeji8i93j30pq0rsn0p.jpg" alt="显示" style="zoom:50%;" />

<h4 id="修改展示的部分"><a href="#修改展示的部分" class="headerlink" title="修改展示的部分"></a>修改展示的部分</h4><ul>
<li><code>fields</code> 指定在修改「新增」中需要显示的字段</li>
<li><code>list_display</code> 指定要列出的字段</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Projects, Person</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProjectsAdmin</span>(<span class="params">admin.ModelAdmin</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    定制后台管理站点类</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    fields = (<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;leader&#x27;</span>, <span class="string">&#x27;tester&#x27;</span>, <span class="string">&#x27;programer&#x27;</span>, <span class="string">&#x27;publish_app&#x27;</span>, <span class="string">&#x27;desc&#x27;</span>)</span><br><span class="line">    list_display = [<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;leader&#x27;</span>, <span class="string">&#x27;tester&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">admin.site.register(Projects, ProjectsAdmin)</span><br><span class="line">admin.site.register(Person)</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7eetaa7sxj327y0qmn6f.jpg" alt="修改后展示"></p>
<h2 id="表关联"><a href="#表关联" class="headerlink" title="表关联"></a>表关联</h2><h3 id="创建一个应用"><a href="#创建一个应用" class="headerlink" title="创建一个应用"></a>创建一个应用</h3><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7ed9zijdgj31u20hc429.jpg" alt="image-20190927205211913"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> startapp interfaces</span></span><br></pre></td></tr></table></figure>
<h3 id="注册子应用"><a href="#注册子应用" class="headerlink" title="注册子应用"></a>注册子应用</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">&#x27;django.contrib.admin&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.auth&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.contenttypes&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.sessions&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.messages&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.staticfiles&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;projects.apps.ProjectsConfig&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;interfaces.apps.InterfacesConfig&#x27;</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>在<code>interfaces/models.py</code>中编写</p>
<p>**一个项目中有多个接口 那么需要在「多」的一侧创建外键 **</p>
<p><strong>项目表为父表「一」，接口表为「多」子表</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Interfaces</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    name = models.CharField(verbose_name=<span class="string">&#x27;项目名称&#x27;</span>, max_length=<span class="number">200</span>, unique=<span class="literal">True</span>, help_text=<span class="string">&#x27;项目名称&#x27;</span>)</span><br><span class="line">    tester = models.CharField(verbose_name=<span class="string">&#x27;测试人员&#x27;</span>, max_length=<span class="number">50</span>, help_text=<span class="string">&#x27;测试人员&#x27;</span>)</span><br><span class="line">    desc = models.TextField(verbose_name=<span class="string">&#x27;简要描述&#x27;</span>, help_text=<span class="string">&#x27;简要描述&#x27;</span>, blank=<span class="literal">True</span>, default=<span class="string">&#x27;&#x27;</span>, null=<span class="literal">True</span>)</span><br><span class="line">    project = models.ForeignKey(<span class="string">&#x27;projects.Projects&#x27;</span>, on_delete=models.CASCADE, verbose_name=<span class="string">&#x27;所属项目&#x27;</span>, help_text=<span class="string">&#x27;所属项目&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>():</span></span><br><span class="line">        verbose_name = <span class="string">&#x27;a&#x27;</span></span><br></pre></td></tr></table></figure>

<p>对于：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">project = models.ForeignKey(<span class="string">&#x27;projects.Projects&#x27;</span>, on_delete=models.CASCADE, verbose_name=<span class="string">&#x27;所属项目&#x27;</span>, help_text=<span class="string">&#x27;所属项目&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="第一个参数"><a href="#第一个参数" class="headerlink" title="第一个参数"></a>第一个参数</h3><ol>
<li><code>字符串</code>：关联的模型路径或者模型类「应用名.模型类」 -&gt; ‘projects.Projects’</li>
<li><code>对象</code>：import导入from projects.models import Projects -&gt; Projects</li>
</ol>
<h3 id="第二个参数"><a href="#第二个参数" class="headerlink" title="第二个参数"></a>第二个参数</h3><p>设置的是：当父表删除之后，该字段的处理方式</p>
<ul>
<li><code>models.CASCADE</code>:子表也会被删除</li>
<li><code>models.SET_NULL</code>:当前外键会被设置为None</li>
<li><code>models.PROTECT</code>:会报错</li>
<li><code>models.SET_DEFAULT</code>:设置默认值,同时需要指定默认值,null=True</li>
</ul>
<h2 id="数据库操作"><a href="#数据库操作" class="headerlink" title="数据库操作"></a>数据库操作</h2><p>使用Pycharm自带的<code>Python Console</code>就可以进入Django的shell模式</p>
<p>使用<code>python manage.py shell</code>也可以进入</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7eewgt4obj326s0sgwmd.jpg" alt="shell"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> projects.models <span class="keyword">import</span> Projects</span><br><span class="line">Projects.objects.<span class="built_in">all</span>()</span><br><span class="line">Out[<span class="number">3</span>]: &lt;QuerySet [&lt;Projects: 测试游记&gt;, &lt;Projects: 测试游记<span class="number">1</span>&gt;]&gt;</span><br><span class="line">Projects.objects.get(<span class="built_in">id</span>=<span class="number">1</span>)</span><br><span class="line">Out[<span class="number">4</span>]: &lt;Projects: 测试游记&gt;</span><br><span class="line">Projects.objects.get(<span class="built_in">id</span>=<span class="number">1</span>).name</span><br><span class="line">Out[<span class="number">5</span>]: <span class="string">&#x27;测试游记&#x27;</span></span><br><span class="line">Projects.objects.get(<span class="built_in">id</span>=<span class="number">1</span>).tester</span><br><span class="line">Out[<span class="number">6</span>]: <span class="string">&#x27;zx&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="查看数据库操作记录"><a href="#查看数据库操作记录" class="headerlink" title="查看数据库操作记录"></a>查看数据库操作记录</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> connection</span><br><span class="line">print(connection.queries)</span><br></pre></td></tr></table></figure>

<h3 id="增"><a href="#增" class="headerlink" title="增"></a>增</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">one_obj = Projects(name=<span class="string">&#x27;「测试游记」-创建&#x27;</span>, leader=<span class="string">&#x27;zx_94&#x27;</span>, tester=<span class="string">&#x27;zx&#x27;</span>, programer=<span class="string">&#x27;zx&#x27;</span>, publish_app=<span class="string">&#x27;公众号&#x27;</span>, desc=<span class="string">&#x27;666&#x27;</span>)</span><br><span class="line"></span><br><span class="line">one_obj.save()</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7ef9ejx8uj31pa0aumzx.jpg" alt="查看结果"></p>
<p>数据库操作记录</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">print(connection.queries[-<span class="number">1</span>])</span><br><span class="line">&#123;<span class="string">&#x27;sql&#x27;</span>: <span class="string">&quot;INSERT INTO `tb_projects` (`name`, `leader`, `tester`, `programer`, `publish_app`, `desc`) VALUES (&#x27;「测试游记」-创建&#x27;, &#x27;zx_94&#x27;, &#x27;zx&#x27;, &#x27;zx&#x27;, &#x27;公众号&#x27;, &#x27;666&#x27;)&quot;</span>, <span class="string">&#x27;time&#x27;</span>: <span class="string">&#x27;0.003&#x27;</span>&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>




          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E4%BA%8C%E5%8D%81%E4%BA%94)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="测试游记">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E4%BA%8C%E5%8D%81%E4%BA%94)/" itemprop="url">测试开发进阶(二十五)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-03-03T20:10:33+08:00">
                2021-03-03
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E4%BA%8C%E5%8D%81%E4%BA%94)/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2021/03/03/测试开发进阶(二十五)/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="测试开发进阶-二十五"><a href="#测试开发进阶-二十五" class="headerlink" title="测试开发进阶(二十五)"></a>测试开发进阶(二十五)</h1><p>欢迎关注我的公众号「测试游记」</p>
<h2 id="痛点"><a href="#痛点" class="headerlink" title="痛点"></a>痛点</h2><ul>
<li>代码冗余极其严重，不符合优秀测开风格</li>
<li>数据校验非常麻烦，且可复用性差</li>
<li> 编码没有统一的规范，杂乱无章的感觉</li>
<li>写的代码非常多，不够简洁</li>
<li>仅支持json格式的传参，不支持form表单传参</li>
<li>仅能返回json格式的数据，其他类型不支持</li>
<li>列表页视图没有分页，过滤，排序功能</li>
</ul>
<h2 id="Django-REST-framework"><a href="#Django-REST-framework" class="headerlink" title="Django REST framework"></a>Django REST framework</h2><blockquote>
<ol>
<li>在Django框架基础上，进行二次开发</li>
<li>用于构建Restful API</li>
<li>简称为DRF框架或REST freamwork框架</li>
</ol>
</blockquote>
<h3 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h3><ul>
<li>提供了强大的Serializer序列化器，可以高效地进行序列化与反序列化操作</li>
<li>提供了丰富的类视图，Mixin扩展类，ViewSet视图集</li>
<li>提供了直观的Web API界面</li>
<li>多种身份认证和权限认证</li>
<li>强大的排序，过滤，分页，搜索，限流等功能</li>
<li>可扩展性，插件丰富</li>
</ul>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> pip install djangorestframework</span></span><br></pre></td></tr></table></figure>

<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p><code>LearnDjango/settings.py</code>中添加<code>&#39;rest_framework&#39;</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">&#x27;django.contrib.admin&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.auth&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.contenttypes&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.sessions&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.messages&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.staticfiles&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;rest_framework&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;projects.apps.ProjectsConfig&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;interfaces.apps.InterfacesConfig&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;corsheaders&#x27;</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h3 id="快速创建实例"><a href="#快速创建实例" class="headerlink" title="快速创建实例"></a>快速创建实例</h3><p>新建<code>projects/serializer.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.serializers <span class="keyword">import</span> ModelSerializer</span><br><span class="line"><span class="keyword">from</span> projects.models <span class="keyword">import</span> Projects</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProjectModelSerializer</span>(<span class="params">ModelSerializer</span>):</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = Projects</span><br><span class="line">        fields = <span class="string">&#x27;__all__&#x27;</span></span><br></pre></td></tr></table></figure>

<p><code>projects/views.py</code>中增加</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> projects.serializer <span class="keyword">import</span> ProjectModelSerializer</span><br><span class="line"><span class="keyword">from</span> rest_framework.viewsets <span class="keyword">import</span> ModelViewSet</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProjectViewSet</span>(<span class="params">ModelViewSet</span>):</span></span><br><span class="line">    queryset = Projects.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = ProjectModelSerializer</span><br></pre></td></tr></table></figure>

<p>修改两个路由</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># projects/urls.py</span></span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> projects <span class="keyword">import</span> views</span><br><span class="line"><span class="keyword">from</span> rest_framework.routers <span class="keyword">import</span> DefaultRouter</span><br><span class="line"></span><br><span class="line">router = DefaultRouter()</span><br><span class="line">router.register(<span class="string">&#x27;projects&#x27;</span>, views.ProjectViewSet)</span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;project/&#x27;</span>, views.ProjectsList.as_view()),</span><br><span class="line">    path(<span class="string">&#x27;project/&lt;int:pk&gt;/&#x27;</span>, views.ProjectDetail.as_view()),</span><br><span class="line">]</span><br><span class="line">urlpatterns += router.urls</span><br><span class="line"></span><br><span class="line"><span class="comment"># LearnDjango/urls.py</span></span><br><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path, include, re_path</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;admin/&#x27;</span>, admin.site.urls),</span><br><span class="line">    path(<span class="string">&#x27;interfaces/&#x27;</span>, include(<span class="string">&#x27;interfaces.urls&#x27;</span>)),</span><br><span class="line">    path(<span class="string">&#x27;&#x27;</span>, include(<span class="string">&#x27;projects.urls&#x27;</span>)),</span><br><span class="line">    path(<span class="string">&#x27;api/&#x27;</span>, include(<span class="string">&#x27;rest_framework.urls&#x27;</span>)),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>查看结果</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7y5j4ols4j31b30u0wuk.jpg" alt="首页"></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7y5mdyh7gj30u00wkgw2.jpg" alt="接口页"></p>
<h2 id="逐步优化之前的代码"><a href="#逐步优化之前的代码" class="headerlink" title="逐步优化之前的代码"></a>逐步优化之前的代码</h2><p>之前「快速创建实例」部分为演示最终效果，现在先恢复到原有状态</p>
<h3 id="创建序列化"><a href="#创建序列化" class="headerlink" title="创建序列化"></a>创建序列化</h3><p>创建<code>projects/serializer.py</code></p>
<p><strong>需要输出哪些字段，那么在序列化器中就定义哪些字段</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.继承Serializer类或者子类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProjectSerializer</span>(<span class="params">serializers.Serializer</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    创建项目序列化器类</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># label选项相当于verbose_name</span></span><br><span class="line">    <span class="comment"># help_text相当于帮助信息</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="built_in">id</span> = serializers.IntegerField(label=<span class="string">&#x27;ID&#x27;</span>)</span><br><span class="line">    name = serializers.CharField(label=<span class="string">&#x27;项目名称&#x27;</span>, max_length=<span class="number">200</span>, help_text=<span class="string">&#x27;项目名称&#x27;</span>)</span><br><span class="line">    tester = serializers.CharField(label=<span class="string">&#x27;测试人员&#x27;</span>, max_length=<span class="number">50</span>, help_text=<span class="string">&#x27;测试人员&#x27;</span>)</span><br><span class="line">    programer = serializers.CharField(label=<span class="string">&#x27;开发人员&#x27;</span>, max_length=<span class="number">50</span>, help_text=<span class="string">&#x27;开发人员&#x27;</span>)</span><br><span class="line">    publish_app = serializers.CharField(label=<span class="string">&#x27;发布应用&#x27;</span>, max_length=<span class="number">50</span>, help_text=<span class="string">&#x27;发布应用&#x27;</span>)</span><br><span class="line">    <span class="comment"># allow_null相当于模型类中的null</span></span><br><span class="line">    <span class="comment"># allow_blank相当于模型类中的blank</span></span><br><span class="line">    desc = serializers.CharField(label=<span class="string">&#x27;简要描述&#x27;</span>, help_text=<span class="string">&#x27;简要描述&#x27;</span>, allow_blank=<span class="literal">True</span>, default=<span class="string">&#x27;&#x27;</span>, allow_null=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<h3 id="查询单个内容"><a href="#查询单个内容" class="headerlink" title="查询单个内容"></a>查询单个内容</h3><p>修改<code>projects.views.ProjectDetail#get</code></p>
<blockquote>
<h4 id="1-通过模型类对象-或者查询集-传给instance-就可以进行序列化操作"><a href="#1-通过模型类对象-或者查询集-传给instance-就可以进行序列化操作" class="headerlink" title="1.通过模型类对象(或者查询集),传给instance 就可以进行序列化操作"></a>1.通过模型类对象(或者查询集),传给instance 就可以进行序列化操作</h4><h4 id="2-通过序列化器ProjectSerializer对象的data属性，就可以获取转化后的字典"><a href="#2-通过序列化器ProjectSerializer对象的data属性，就可以获取转化后的字典" class="headerlink" title="2.通过序列化器ProjectSerializer对象的data属性，就可以获取转化后的字典"></a>2.通过序列化器ProjectSerializer对象的data属性，就可以获取转化后的字典</h4></blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> projects.serializer <span class="keyword">import</span> ProjectSerializer</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProjectDetail</span>(<span class="params">View</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request, pk</span>):</span></span><br><span class="line">        project = Projects.objects.get(<span class="built_in">id</span>=pk)</span><br><span class="line">        serializer = ProjectSerializer(instance=project)</span><br><span class="line">        <span class="keyword">return</span> JsonResponse(serializer.data)</span><br></pre></td></tr></table></figure>

<h4 id="测试1"><a href="#测试1" class="headerlink" title="测试1"></a>测试1</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> http :8000/project/1/</span></span><br><span class="line">zhongxindeMacBook-Pro:~ zhongxin$ http :8000/project/1/</span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Length: 135</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Date: Mon, 14 Oct 2019 16:06:10 GMT</span><br><span class="line">Server: WSGIServer/0.2 CPython/3.7.1</span><br><span class="line">Vary: Origin</span><br><span class="line">X-Frame-Options: SAMEORIGIN</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;desc&quot;: &quot;666&quot;,</span><br><span class="line">    &quot;id&quot;: 1,</span><br><span class="line">    &quot;name&quot;: &quot;测试游记&quot;,</span><br><span class="line">    &quot;programer&quot;: &quot;zhong&quot;,</span><br><span class="line">    &quot;publish_app&quot;: &quot;公众号&quot;,</span><br><span class="line">    &quot;tester&quot;: &quot;zx&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7y6i19nyqj316y0u0k2c.jpg" alt="测试1"></p>
<h3 id="查询多个内容"><a href="#查询多个内容" class="headerlink" title="查询多个内容"></a>查询多个内容</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProjectsList</span>(<span class="params">View</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, reuqest</span>):</span></span><br><span class="line">        project_qs = Projects.objects.<span class="built_in">all</span>()</span><br><span class="line">        serializer = ProjectSerializer(instance=project_qs, many=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> JsonResponse(serializer.data, safe=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>

<p>设置<code>many</code>为<code>True</code>可以获取多个内容</p>
<h4 id="测试2"><a href="#测试2" class="headerlink" title="测试2"></a>测试2</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> http :8000/project/</span></span><br><span class="line">zhongxindeMacBook-Pro:~ zhongxin$ http :8000/project/</span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Length: 438</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Date: Mon, 14 Oct 2019 16:15:58 GMT</span><br><span class="line">Server: WSGIServer/0.2 CPython/3.7.1</span><br><span class="line">Vary: Origin</span><br><span class="line">X-Frame-Options: SAMEORIGIN</span><br><span class="line"></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;desc&quot;: &quot;666&quot;,</span><br><span class="line">        &quot;id&quot;: 1,</span><br><span class="line">        &quot;name&quot;: &quot;测试游记&quot;,</span><br><span class="line">        &quot;programer&quot;: &quot;zhong&quot;,</span><br><span class="line">        &quot;publish_app&quot;: &quot;公众号&quot;,</span><br><span class="line">        &quot;tester&quot;: &quot;zx&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;desc&quot;: &quot;6666&quot;,</span><br><span class="line">        &quot;id&quot;: 2,</span><br><span class="line">        &quot;name&quot;: &quot;测试游记1&quot;,</span><br><span class="line">        &quot;programer&quot;: &quot;zhong1&quot;,</span><br><span class="line">        &quot;publish_app&quot;: &quot;公众号1&quot;,</span><br><span class="line">        &quot;tester&quot;: &quot;zx1&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;desc&quot;: &quot;666&quot;,</span><br><span class="line">        &quot;id&quot;: 3,</span><br><span class="line">        &quot;name&quot;: &quot;「测试游记」-创建&quot;,</span><br><span class="line">        &quot;programer&quot;: &quot;zx&quot;,</span><br><span class="line">        &quot;publish_app&quot;: &quot;公众号&quot;,</span><br><span class="line">        &quot;tester&quot;: &quot;zx&quot;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7y6pwd84sj31bi0u0dyj.jpg" alt="测试2"></p>
<h3 id="反序列化部分优化"><a href="#反序列化部分优化" class="headerlink" title="反序列化部分优化"></a>反序列化部分优化</h3><p><strong>调用序列化器对象的is_valid方法，开始校验前端参数</strong></p>
<ul>
<li>校验成功返回True</li>
<li>校验失败返回False</li>
</ul>
<blockquote>
<p><code>serializer.is_valid(raise_exception=True)</code> raise_exception=True校验失败会抛出异常 </p>
<p>当调用<code>is_valid</code>方法后，才可以调用<code>errors</code>属性，获取校验的错误提示「字典格式」</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProjectsList</span>(<span class="params">View</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        新建项目</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        json_data = request.body.decode(<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">        python_data = json.loads(json_data, encoding=<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">        serializer = ProjectSerializer(data=python_data)</span><br><span class="line">        <span class="comment"># 校验前端输入的数据</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            serializer.is_valid(raise_exception=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> JsonResponse(serializer.errors)</span><br><span class="line">        project = Projects.objects.create(**serializer.validated_data)</span><br><span class="line">        serializer = ProjectSerializer(instance=project)</span><br><span class="line">        <span class="keyword">return</span> JsonResponse(serializer.data, status=<span class="number">201</span>)</span><br></pre></td></tr></table></figure>
<h4 id="测试3"><a href="#测试3" class="headerlink" title="测试3"></a>测试3</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> http :8000/project/ name=1015项目 tester=zx programer=zhong2  publish_app=公众号2 desc=「测试游记」</span></span><br><span class="line">zhongxindeMacBook-Pro:~ zhongxin$ http :8000/project/ name=1015项目 tester=zx programer=zhong2  publish_app=公众号2 desc=「测试游记」</span><br><span class="line">HTTP/1.1 201 Created</span><br><span class="line">Content-Length: 162</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Date: Mon, 14 Oct 2019 16:26:19 GMT</span><br><span class="line">Server: WSGIServer/0.2 CPython/3.7.1</span><br><span class="line">Vary: Origin</span><br><span class="line">X-Frame-Options: SAMEORIGIN</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;desc&quot;: &quot;「测试游记」&quot;,</span><br><span class="line">    &quot;id&quot;: 7,</span><br><span class="line">    &quot;name&quot;: &quot;1015项目&quot;,</span><br><span class="line">    &quot;programer&quot;: &quot;zhong2&quot;,</span><br><span class="line">    &quot;publish_app&quot;: &quot;公众号2&quot;,</span><br><span class="line">    &quot;tester&quot;: &quot;zx&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7y71q1pr6j316y0u07h6.jpg" alt="测试3"></p>
<h4 id="测试4"><a href="#测试4" class="headerlink" title="测试4"></a>测试4</h4><p>再次发送相同内容</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> http :8000/project/ name=1015项目 tester=zx programer=zhong2  publish_app=公众号2 desc=「测试游记」</span></span><br></pre></td></tr></table></figure>



<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7y768aeykj316y0u0ako.jpg" alt="测试4"></p>
<p>上面这个错误有些不合理。</p>
<p>修改<code>projects.serializer.ProjectSerializer</code>中的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">id</span> = serializers.IntegerField(label=<span class="string">&#x27;ID&#x27;</span>, read_only=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>增加<code>read_only=True</code>，指定该字段只能进行序列化输出「只读」，不进行反序列化。其他字段默认即可以进行序列化输出，也可以反序列化输出</p>
<p><code>write_only=True</code>和<code>read_only=True</code>相反，只支持反序列化，不支持序列化。</p>
<h2 id="第二次优化的完整代码"><a href="#第二次优化的完整代码" class="headerlink" title="第二次优化的完整代码"></a>第二次优化的完整代码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> JsonResponse, Http404</span><br><span class="line"><span class="keyword">from</span> projects.models <span class="keyword">import</span> Projects</span><br><span class="line"><span class="keyword">from</span> django.views <span class="keyword">import</span> View</span><br><span class="line"><span class="keyword">from</span> projects.serializer <span class="keyword">import</span> ProjectSerializer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProjectsList</span>(<span class="params">View</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, reuqest</span>):</span></span><br><span class="line">        project_qs = Projects.objects.<span class="built_in">all</span>()</span><br><span class="line">        serializer = ProjectSerializer(instance=project_qs, many=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> JsonResponse(serializer.data, safe=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        新建项目</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        json_data = request.body.decode(<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">        python_data = json.loads(json_data, encoding=<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">        serializer = ProjectSerializer(data=python_data)</span><br><span class="line">        <span class="comment"># 校验前端输入的数据</span></span><br><span class="line">        <span class="comment"># 调用序列化器对象的is_valid方法，开始校验前端参数</span></span><br><span class="line">        <span class="comment"># serializer.is_valid(raise_exception=True) raise_exception=True校验失败会抛出异常</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            serializer.is_valid(raise_exception=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> JsonResponse(serializer.errors)</span><br><span class="line">        project = Projects.objects.create(**serializer.validated_data)</span><br><span class="line">        serializer = ProjectSerializer(instance=project)</span><br><span class="line">        <span class="keyword">return</span> JsonResponse(serializer.data, status=<span class="number">201</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProjectDetail</span>(<span class="params">View</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_object</span>(<span class="params">self, pk</span>):</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> Projects.objects.get(<span class="built_in">id</span>=pk)</span><br><span class="line">        <span class="keyword">except</span> Projects.DoesNotExist:</span><br><span class="line">            <span class="keyword">raise</span> Http404</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request, pk</span>):</span></span><br><span class="line">        project = self.get_object(pk)</span><br><span class="line">        serializer = ProjectSerializer(instance=project)</span><br><span class="line">        <span class="keyword">return</span> JsonResponse(serializer.data)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put</span>(<span class="params">self, request, pk</span>):</span></span><br><span class="line">        project = self.get_object(pk)</span><br><span class="line">        json_data = request.body.decode(<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">        python_data = json.loads(json_data, encoding=<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">        serializer = ProjectSerializer(data=python_data)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            serializer.is_valid(raise_exception=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> JsonResponse(serializer.errors)</span><br><span class="line">        project.name = serializer.validated_data[<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">        project.leader = serializer.validated_data[<span class="string">&#x27;leader&#x27;</span>]</span><br><span class="line">        project.tester = serializer.validated_data[<span class="string">&#x27;tester&#x27;</span>]</span><br><span class="line">        project.programer = serializer.validated_data[<span class="string">&#x27;programer&#x27;</span>]</span><br><span class="line">        project.publish_app = serializer.validated_data[<span class="string">&#x27;publish_app&#x27;</span>]</span><br><span class="line">        project.desc = serializer.validated_data[<span class="string">&#x27;desc&#x27;</span>]</span><br><span class="line">        project.save()</span><br><span class="line"></span><br><span class="line">        serializer = ProjectSerializer(instance=project)</span><br><span class="line">        <span class="keyword">return</span> JsonResponse(serializer.data, status=<span class="number">201</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">self, request, pk</span>):</span></span><br><span class="line">        project = self.get_object(pk)</span><br><span class="line">        project.delete()</span><br><span class="line">        <span class="keyword">return</span> JsonResponse(&#123;&#125;, safe=<span class="literal">True</span>, status=<span class="number">204</span>)</span><br></pre></td></tr></table></figure>




          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E4%BA%8C%E5%8D%81%E5%85%AB)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="测试游记">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E4%BA%8C%E5%8D%81%E5%85%AB)/" itemprop="url">测试开发进阶(二十八)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-03-03T20:10:33+08:00">
                2021-03-03
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E4%BA%8C%E5%8D%81%E5%85%AB)/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2021/03/03/测试开发进阶(二十八)/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="测试开发进阶-二十八"><a href="#测试开发进阶-二十八" class="headerlink" title="测试开发进阶(二十八)"></a>测试开发进阶(二十八)</h1><p><strong>欢迎关注我的公众号「测试游记」</strong></p>
<blockquote>
<p>如果前端请求头中没有指定Accept 默认返回json格式的数据</p>
</blockquote>
<h3 id="text-html"><a href="#text-html" class="headerlink" title="text/html"></a>text/html</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> http -v :8000/project/1/ Accept:text/html</span></span><br></pre></td></tr></table></figure>



<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g87b8dlvmuj316y0u0ami.jpg" alt="返回页面"></p>
<h3 id="application-json"><a href="#application-json" class="headerlink" title="application/json"></a>application/json</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> http -v :8000/project/1/ Accept:application/json</span></span><br></pre></td></tr></table></figure>



<p>![返回json](../../../Library/Application Support/typora-user-images/image-20191022214337309.png)</p>
<h2 id="使用GenericAPIView重写ProjectDetail"><a href="#使用GenericAPIView重写ProjectDetail" class="headerlink" title="使用GenericAPIView重写ProjectDetail"></a>使用GenericAPIView重写ProjectDetail</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProjectDetail</span>(<span class="params">GenericAPIView</span>):</span></span><br><span class="line">    queryset = Projects.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = ProjectModelSerializer</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request, pk</span>):</span></span><br><span class="line">        project = self.get_object()</span><br><span class="line">        serializer = self.get_serializer(instance=project)</span><br><span class="line">        <span class="keyword">return</span> Response(serializer.data, status=status.HTTP_200_OK)</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g87bnhnr92j30g00t6gpd.jpg" alt="GenericAPIView"></p>
<p>从源码中可以看到<code>GenericAPIView</code>中实现了<code>get_object</code>方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_object</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Returns the object the view is displaying.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    You may want to override this if you need to provide non-standard</span></span><br><span class="line"><span class="string">    queryset lookups.  Eg if objects are referenced using multiple</span></span><br><span class="line"><span class="string">    keyword arguments in the url conf.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    queryset = self.filter_queryset(self.get_queryset())</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Perform the lookup filtering.</span></span><br><span class="line">    lookup_url_kwarg = self.lookup_url_kwarg <span class="keyword">or</span> self.lookup_field</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assert</span> lookup_url_kwarg <span class="keyword">in</span> self.kwargs, (</span><br><span class="line">        <span class="string">&#x27;Expected view %s to be called with a URL keyword argument &#x27;</span></span><br><span class="line">        <span class="string">&#x27;named &quot;%s&quot;. Fix your URL conf, or set the `.lookup_field` &#x27;</span></span><br><span class="line">        <span class="string">&#x27;attribute on the view correctly.&#x27;</span> %</span><br><span class="line">        (self.__class__.__name__, lookup_url_kwarg)</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    filter_kwargs = &#123;self.lookup_field: self.kwargs[lookup_url_kwarg]&#125;</span><br><span class="line">    obj = get_object_or_404(queryset, **filter_kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># May raise a permission denied</span></span><br><span class="line">    self.check_object_permissions(self.request, obj)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> obj</span><br></pre></td></tr></table></figure>

<p>查看<code>self.lookup_field</code>可以找到</p>
<p><code>lookup_field = &#39;pk&#39;</code></p>
<p>进入<code>get_object_or_404</code>可以看到一个解包，这样就拿到了查询集中<code>id=1</code>的内容</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g87bqwvg1wj30u00y0akf.jpg" alt="解包"></p>
<p>所以使用<code>lookup_field</code>类属性，可以修改传入的内容命名</p>
<ul>
<li>使用<code>get_serializer</code>获取序列化器</li>
</ul>
<h2 id="全局指定排序"><a href="#全局指定排序" class="headerlink" title="全局指定排序"></a>全局指定排序</h2><p>在<code>LearnDjango/settings.py</code>中添加</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    <span class="string">&quot;DEFAULT_RENDERER_CLASSES&quot;</span>: (</span><br><span class="line">        <span class="comment"># json渲染器为第一优先级</span></span><br><span class="line">        <span class="string">&quot;rest_framework.renderers.JSONRenderer&quot;</span>,</span><br><span class="line">        <span class="comment"># 可浏览的API渲染为第二优先级</span></span><br><span class="line">        <span class="string">&quot;rest_framework.renderers.BrowsableAPIRenderer&quot;</span>,</span><br><span class="line">    ),</span><br><span class="line">    <span class="string">&#x27;DEFAULT_FILTER_BACKENDS&#x27;</span>: [<span class="string">&#x27;rest_framework.filters.OrderingFilter&#x27;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="过滤"><a href="#过滤" class="headerlink" title="过滤"></a>过滤</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> pip install django-filter</span></span><br></pre></td></tr></table></figure>

<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>添加<code>django_filters</code>APP</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">&#x27;django.contrib.admin&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.auth&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.contenttypes&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.sessions&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.messages&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.staticfiles&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;rest_framework&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django_filters&#x27;</span>,</span><br><span class="line">    <span class="comment"># 注册子应用</span></span><br><span class="line">    <span class="comment"># 子应用名.apps.子应用名首字母大写Config</span></span><br><span class="line">    <span class="string">&#x27;projects.apps.ProjectsConfig&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;interfaces.apps.InterfacesConfig&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;corsheaders&#x27;</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>在<code>projects/views.py</code>导入</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django_filters.rest_framework <span class="keyword">import</span> DjangoFilterBackend</span><br></pre></td></tr></table></figure>
<p>在<code>projects.views.ProjectsList</code>添加    </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 5.在类视图中指定过滤引擎</span></span><br><span class="line">filter_backends = [DjangoFilterBackend]</span><br><span class="line"><span class="comment"># 6.指定过滤的字段</span></span><br><span class="line">filterset_fields = [<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;leader&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p>查询</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> http :8000/project/ name==<span class="string">&#x27;测试游记1&#x27;</span></span></span><br><span class="line">zhongxindeMacBook-Pro:~ zhongxin$ http :8000/project/ name==&#x27;测试游记1&#x27;</span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Allow: GET, POST, HEAD, OPTIONS</span><br><span class="line">Content-Length: 130</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Date: Tue, 22 Oct 2019 14:19:31 GMT</span><br><span class="line">Server: WSGIServer/0.2 CPython/3.7.1</span><br><span class="line">Vary: Accept, Origin, Cookie</span><br><span class="line">X-Frame-Options: SAMEORIGIN</span><br><span class="line"></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;desc&quot;: &quot;6666&quot;,</span><br><span class="line">        &quot;id&quot;: 2,</span><br><span class="line">        &quot;interfaces_set&quot;: [],</span><br><span class="line">        &quot;name&quot;: &quot;测试游记1&quot;,</span><br><span class="line">        &quot;programer&quot;: &quot;zhong1&quot;,</span><br><span class="line">        &quot;publish_app&quot;: &quot;公众号1&quot;,</span><br><span class="line">        &quot;tester&quot;: &quot;zx1&quot;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g87cb7puzej316y0u0qex.jpg" alt="过滤"></p>
<h3 id="在全局指定"><a href="#在全局指定" class="headerlink" title="在全局指定"></a>在全局指定</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    <span class="string">&quot;DEFAULT_RENDERER_CLASSES&quot;</span>: (</span><br><span class="line">        <span class="comment"># json渲染器为第一优先级</span></span><br><span class="line">        <span class="string">&quot;rest_framework.renderers.JSONRenderer&quot;</span>,</span><br><span class="line">        <span class="comment"># 可浏览的API渲染为第二优先级</span></span><br><span class="line">        <span class="string">&quot;rest_framework.renderers.BrowsableAPIRenderer&quot;</span>,</span><br><span class="line">    ),</span><br><span class="line">    <span class="string">&#x27;DEFAULT_FILTER_BACKENDS&#x27;</span>: [<span class="string">&#x27;rest_framework.filters.OrderingFilter&#x27;</span>,</span><br><span class="line">                                <span class="string">&#x27;django_filters.rest_framework.DjangoFilterBackend&#x27;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="分页"><a href="#分页" class="headerlink" title="分页"></a>分页</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    <span class="string">&quot;DEFAULT_RENDERER_CLASSES&quot;</span>: (</span><br><span class="line">        <span class="comment"># json渲染器为第一优先级</span></span><br><span class="line">        <span class="string">&quot;rest_framework.renderers.JSONRenderer&quot;</span>,</span><br><span class="line">        <span class="comment"># 可浏览的API渲染为第二优先级</span></span><br><span class="line">        <span class="string">&quot;rest_framework.renderers.BrowsableAPIRenderer&quot;</span>,</span><br><span class="line">    ),</span><br><span class="line">    <span class="string">&#x27;DEFAULT_FILTER_BACKENDS&#x27;</span>: [<span class="string">&#x27;rest_framework.filters.OrderingFilter&#x27;</span>,</span><br><span class="line">                                <span class="string">&#x27;django_filters.rest_framework.DjangoFilterBackend&#x27;</span>],</span><br><span class="line">    <span class="comment"># 在全局指定分页的引擎</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_PAGINATION_CLASS&#x27;</span>: <span class="string">&#x27;rest_framework.pagination.PageNumberPagination&#x27;</span>,</span><br><span class="line">    <span class="comment"># 同时必须指定每页显示的条数</span></span><br><span class="line">    <span class="string">&#x27;PAGE_SIZE&#x27;</span>: <span class="number">3</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改<code>projects.views.ProjectsList#get</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, reuqest</span>):</span></span><br><span class="line">   <span class="comment"># 使用get_queryset获取查询集</span></span><br><span class="line">    project_qs = self.get_queryset() </span><br><span class="line">    <span class="comment"># 使用filter_queryset方法过滤查询</span></span><br><span class="line">    project_qs = self.filter_queryset(project_qs)  </span><br><span class="line">    <span class="comment"># 使用paginate_queryset进行分页，然后返回分页之后的查询集</span></span><br><span class="line">    page = self.paginate_queryset(project_qs)  </span><br><span class="line">    <span class="keyword">if</span> page <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        serializer = self.get_serializer(instance=page, many=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> self.get_paginated_response(serializer.data)</span><br><span class="line">    serializer = self.get_serializer(instance=project_qs, many=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">return</span> Response(serializer.data, status=status.HTTP_200_OK)</span><br></pre></td></tr></table></figure>

<p>分页后</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">zhongxindeMacBook-Pro:~ zhongxin$ http :8000/project/</span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Allow: GET, POST, HEAD, OPTIONS</span><br><span class="line">Content-Length: 520</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Date: Tue, 22 Oct 2019 14:41:54 GMT</span><br><span class="line">Server: WSGIServer/0.2 CPython/3.7.1</span><br><span class="line">Vary: Accept, Origin, Cookie</span><br><span class="line">X-Frame-Options: SAMEORIGIN</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;count&quot;: 5,</span><br><span class="line">    &quot;next&quot;: &quot;http://localhost:8000/project/?page=2&quot;,</span><br><span class="line">    &quot;previous&quot;: null,</span><br><span class="line">    &quot;results&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;desc&quot;: &quot;666&quot;,</span><br><span class="line">            &quot;id&quot;: 1,</span><br><span class="line">            &quot;interfaces_set&quot;: [</span><br><span class="line">                &quot;Interfaces object (1)&quot;,</span><br><span class="line">                &quot;Interfaces object (2)&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;name&quot;: &quot;测试游记&quot;,</span><br><span class="line">            &quot;programer&quot;: &quot;zhong&quot;,</span><br><span class="line">            &quot;publish_app&quot;: &quot;公众号&quot;,</span><br><span class="line">            &quot;tester&quot;: &quot;zx&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;desc&quot;: &quot;6666&quot;,</span><br><span class="line">            &quot;id&quot;: 2,</span><br><span class="line">            &quot;interfaces_set&quot;: [],</span><br><span class="line">            &quot;name&quot;: &quot;测试游记1&quot;,</span><br><span class="line">            &quot;programer&quot;: &quot;zhong1&quot;,</span><br><span class="line">            &quot;publish_app&quot;: &quot;公众号1&quot;,</span><br><span class="line">            &quot;tester&quot;: &quot;zx1&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;desc&quot;: &quot;666&quot;,</span><br><span class="line">            &quot;id&quot;: 3,</span><br><span class="line">            &quot;interfaces_set&quot;: [],</span><br><span class="line">            &quot;name&quot;: &quot;「测试游记」-创建&quot;,</span><br><span class="line">            &quot;programer&quot;: &quot;zx&quot;,</span><br><span class="line">            &quot;publish_app&quot;: &quot;公众号&quot;,</span><br><span class="line">            &quot;tester&quot;: &quot;zx&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">zhongxindeMacBook-Pro:~ zhongxin$ </span><br></pre></td></tr></table></figure>



<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g87cy6ohwjj31bi0u04gw.jpg" alt="分页后"></p>
<h2 id="自定义分页"><a href="#自定义分页" class="headerlink" title="自定义分页"></a>自定义分页</h2><p>在<code>utils.pagination.PageNumberPaginationManual</code>新写一个类继承于<code>PageNumberPagination</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.pagination <span class="keyword">import</span> PageNumberPagination</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PageNumberPaginationManual</span>(<span class="params">PageNumberPagination</span>):</span></span><br><span class="line">    page_query_param = <span class="string">&#x27;p&#x27;</span>  <span class="comment"># url中查询关键字从page修改为p</span></span><br><span class="line">    page_size = <span class="number">2</span>  <span class="comment"># 每页显示的条数为2</span></span><br><span class="line">    max_page_size = <span class="number">50</span>  <span class="comment"># 分页的最大的page_size</span></span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g87d1z9ia0j31bi0u04i7.jpg" alt="image-20191022224552266"></p>
<h2 id="在某个类中指定分页"><a href="#在某个类中指定分页" class="headerlink" title="在某个类中指定分页"></a>在某个类中指定分页</h2><p>添加</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pagination_class = PageNumberPaginationManual</span><br></pre></td></tr></table></figure>

<h2 id="再次优化"><a href="#再次优化" class="headerlink" title="再次优化"></a>再次优化</h2><p>借鉴<code>python3.7/site-packages/rest_framework/mixins.py</code></p>
<p>查看<code>rest_framework.mixins.ListModelMixin</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ListModelMixin</span>:</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    List a queryset.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">list</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        queryset = self.filter_queryset(self.get_queryset())</span><br><span class="line"></span><br><span class="line">        page = self.paginate_queryset(queryset)</span><br><span class="line">        <span class="keyword">if</span> page <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            serializer = self.get_serializer(page, many=<span class="literal">True</span>)</span><br><span class="line">            <span class="keyword">return</span> self.get_paginated_response(serializer.data)</span><br><span class="line"></span><br><span class="line">        serializer = self.get_serializer(queryset, many=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> Response(serializer.data)</span><br></pre></td></tr></table></figure>

<p>发现和<code>projects.views.ProjectsList#get</code>一样</p>
<p>修改<code>get</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> mixins</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProjectsList</span>(<span class="params">mixins.ListModelMixin, GenericAPIView</span>):</span></span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.<span class="built_in">list</span>(request, *args, **kwargs)</span><br></pre></td></tr></table></figure>

<p>全部优化后：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> projects.models <span class="keyword">import</span> Projects</span><br><span class="line"><span class="keyword">from</span> projects.serializer <span class="keyword">import</span> ProjectModelSerializer</span><br><span class="line"><span class="keyword">from</span> rest_framework.generics <span class="keyword">import</span> GenericAPIView</span><br><span class="line"><span class="keyword">from</span> django_filters.rest_framework <span class="keyword">import</span> DjangoFilterBackend</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> mixins</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProjectsList</span>(<span class="params">mixins.ListModelMixin,</span></span></span><br><span class="line"><span class="class"><span class="params">                   mixins.CreateModelMixin,</span></span></span><br><span class="line"><span class="class"><span class="params">                   GenericAPIView</span>):</span></span><br><span class="line">    ordering_fields = [<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;leader&#x27;</span>]</span><br><span class="line">    queryset = Projects.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = ProjectModelSerializer</span><br><span class="line">    filter_backends = [DjangoFilterBackend]</span><br><span class="line">    filterset_fields = [<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;leader&#x27;</span>, <span class="string">&#x27;tester&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.<span class="built_in">list</span>(request, *args, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.create(request, *args, **kwargs)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProjectDetail</span>(<span class="params">mixins.RetrieveModelMixin,</span></span></span><br><span class="line"><span class="class"><span class="params">                    mixins.UpdateModelMixin,</span></span></span><br><span class="line"><span class="class"><span class="params">                    mixins.DestroyModelMixin,</span></span></span><br><span class="line"><span class="class"><span class="params">                    GenericAPIView</span>):</span></span><br><span class="line">    queryset = Projects.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = ProjectModelSerializer</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.retrieve(request, *args, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.update(request, *args, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.destroy(request, *args, **kwargs)</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E4%BA%8C%E5%8D%81%E5%85%AD)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="测试游记">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E4%BA%8C%E5%8D%81%E5%85%AD)/" itemprop="url">测试开发进阶(二十六)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-03-03T20:10:33+08:00">
                2021-03-03
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E4%BA%8C%E5%8D%81%E5%85%AD)/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2021/03/03/测试开发进阶(二十六)/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="测试开发进阶-二十六"><a href="#测试开发进阶-二十六" class="headerlink" title="测试开发进阶(二十六)"></a>测试开发进阶(二十六)</h1><p>欢迎关注我的公众号「测试游记」</p>
<h2 id="序列化器"><a href="#序列化器" class="headerlink" title="序列化器"></a>序列化器</h2><ol>
<li>序列化器中定义的类属性字段，往往与模型类字段一一对应</li>
<li>label选项相当于<code>verbose_name</code>;</li>
<li>定义的序列化器字段，默认既可以进行序列化输出，也可以进行反序列化输入</li>
</ol>
<h3 id="通用参数"><a href="#通用参数" class="headerlink" title="通用参数"></a>通用参数</h3><ul>
<li><code>read_only = True</code> 指定该字段只能进行序列化输出</li>
<li><code>write_only = True</code> 指定该字段只进行反序列化输入，但不进行序列化输出</li>
<li><code>required</code>该字段在反序列化时必须传入，默认为True</li>
<li><code>default</code>反序列化时使用的默认值</li>
<li><code>allow_null</code>该字段是否允许传入None，默认False</li>
<li><code>validators</code>该字段使用的校验器</li>
<li><code>error_messages</code>包含错误key与错误信息的字典（下面有例子）</li>
<li><code>label</code>用于HTML展示API页面时，显示的字段名称</li>
</ul>
<h3 id="选项参数"><a href="#选项参数" class="headerlink" title="选项参数"></a>选项参数</h3><ul>
<li><code>max_length</code>最大长度</li>
<li><code>min_length</code>最小长度</li>
<li><code>allow_blank</code>是否允许为空</li>
<li><code>trim_whitespace</code>是否截断空白字符</li>
<li><code>max_value</code>最小值</li>
<li><code>min_value</code>最大值</li>
</ul>
<h2 id="校验"><a href="#校验" class="headerlink" title="校验"></a>校验</h2><ol>
<li>调用序列化器对象的<code>is_valid</code>方法，才开始校验前端参数</li>
<li>如果校验成功，则返回<code>True</code>，校验失败返回<code>False</code></li>
<li><code>raise_exception=True</code>，校验失败后会抛出异常</li>
<li>当调用<code>is_valid</code>方法之后，才可以调用<code>errors</code>属性「校验的错误提示(字典)」</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    serializer.is_valid(raise_exception=<span class="literal">True</span>)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="keyword">return</span> JsonResponse(serializer.errors)</span><br></pre></td></tr></table></figure>

<p>在序列化器中增加<code>validators</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.validators <span class="keyword">import</span> UniqueValidator</span><br><span class="line"><span class="keyword">from</span> projects.models <span class="keyword">import</span> Projects</span><br><span class="line"></span><br><span class="line">name = serializers.CharField(</span><br><span class="line">        label=<span class="string">&#x27;项目名称&#x27;</span>,</span><br><span class="line">        max_length=<span class="number">200</span>,</span><br><span class="line">        help_text=<span class="string">&#x27;项目名称&#x27;</span>,</span><br><span class="line">        validators=[</span><br><span class="line">            UniqueValidator(</span><br><span class="line">                queryset=Projects.objects.<span class="built_in">all</span>(),</span><br><span class="line">                message=<span class="string">&#x27;项目名不能重复&#x27;</span></span><br><span class="line">            )</span><br><span class="line">        ]</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>
<p>编写一份创建项目的json<br><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g80binslxij30ks0cutaf.jpg" alt="创建项目json"></p>
<p>发送一个创建请求</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> http POST :8000/project/ &lt; projects.json</span> </span><br><span class="line">zhongxindeMacBook-Pro:apitest zhongxin$ http POST :8000/project/ &lt; projects.json </span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Length: 56</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Date: Wed, 16 Oct 2019 12:34:16 GMT</span><br><span class="line">Server: WSGIServer/0.2 CPython/3.7.1</span><br><span class="line">Vary: Origin</span><br><span class="line">X-Frame-Options: SAMEORIGIN</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;name&quot;: [</span><br><span class="line">        &quot;项目名不能重复&quot;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g80bjfd1opj316y0u048p.jpg" alt="请求结果"></p>
<h3 id="自定义校验"><a href="#自定义校验" class="headerlink" title="自定义校验"></a>自定义校验</h3><p>自己编写一个校验器</p>
<p>需求：项目名称中必须包含<code>项目</code>关键字</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_unique_project_name</span>(<span class="params">name</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    项目名称中需要包含「项目」关键字</span></span><br><span class="line"><span class="string">    :param name:前端传递给我的项目名称</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;项目&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> name:</span><br><span class="line">        <span class="keyword">raise</span> serializers.ValidationError(detail=<span class="string">&#x27;项目名称中必须包含「项目」&#x27;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">name = serializers.CharField(</span><br><span class="line">    label=<span class="string">&#x27;项目名称&#x27;</span>,</span><br><span class="line">    max_length=<span class="number">200</span>,</span><br><span class="line">    help_text=<span class="string">&#x27;项目名称&#x27;</span>,</span><br><span class="line">    validators=[</span><br><span class="line">        UniqueValidator(</span><br><span class="line">            queryset=Projects.objects.<span class="built_in">all</span>(),</span><br><span class="line">            message=<span class="string">&#x27;项目名不能重复&#x27;</span></span><br><span class="line">        ), is_unique_project_name</span><br><span class="line">    ]</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g80bk2c8jsj316y0u0wp4.jpg" alt="请求结果"></p>
<h3 id="单字段校验"><a href="#单字段校验" class="headerlink" title="单字段校验"></a>单字段校验</h3><p>在序列化器内部增加<code>def validate_name(self, value):</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 单字段的校验</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">validate_name</span>(<span class="params">self, value</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> value.endswith(<span class="string">&#x27;项目&#x27;</span>):</span><br><span class="line">        <span class="keyword">raise</span> serializers.ValidationError(<span class="string">&#x27;项目名称必须以「项目」结尾&#x27;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># projects.json</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;测试游记1&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;leader&quot;</span>: <span class="string">&quot;zhongxin&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;tester&quot;</span>: <span class="string">&quot;zhongxin&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;programer&quot;</span>: <span class="string">&quot;zhong3&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;publish_app&quot;</span>: <span class="string">&quot;公众号&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;desc&quot;</span>: <span class="string">&quot;无&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g80bs2zwkuj316y0u07eu.jpg" alt="校验"></p>
<p>修改<code>projects.json</code></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># projects.json</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;测试游记项目1&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;leader&quot;</span>: <span class="string">&quot;zhongxin&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;tester&quot;</span>: <span class="string">&quot;zhongxin&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;programer&quot;</span>: <span class="string">&quot;zhong3&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;publish_app&quot;</span>: <span class="string">&quot;公众号&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;desc&quot;</span>: <span class="string">&quot;无&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g80btfshr0j316y0u0n7f.jpg" alt="测试2"></p>
<h3 id="多字段校验"><a href="#多字段校验" class="headerlink" title="多字段校验"></a>多字段校验</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">validate</span>(<span class="params">self, attrs</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g80bz0ljxtj31e60u07bk.jpg" alt="多字段"></p>
<p>这里<code>name</code>为<code>None</code>是因为上面单字段校验没有返回value</p>
<p>修改后再次测试</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">validate_name</span>(<span class="params">self, value</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> value.endswith(<span class="string">&#x27;项目&#x27;</span>):</span><br><span class="line">        <span class="keyword">raise</span> serializers.ValidationError(<span class="string">&#x27;项目名称必须以「项目」结尾&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> value</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g80c0s6uasj311i0myq9z.jpg" alt="测试2"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">validate</span>(<span class="params">self, attrs</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    多字段联合校验</span></span><br><span class="line"><span class="string">    需求：tester和leader中有「icon」</span></span><br><span class="line"><span class="string">    :param attrs:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;icon&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> attrs[<span class="string">&#x27;tester&#x27;</span>] <span class="keyword">and</span> <span class="string">&#x27;icon&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> attrs[<span class="string">&#x27;leader&#x27;</span>]:</span><br><span class="line">        <span class="keyword">raise</span> serializers.ValidationError(<span class="string">&#x27;「icon」必须是项目负责人或者在项目的测试人员&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> attrs</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g80c3u7csrj316y0u0tj9.jpg" alt="测试"></p>
<p>修改<code>projects.json</code></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># projects.json</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;测试游记项目&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;leader&quot;</span>: <span class="string">&quot;icon&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;tester&quot;</span>: <span class="string">&quot;zhongxin&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;programer&quot;</span>: <span class="string">&quot;zhong3&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;publish_app&quot;</span>: <span class="string">&quot;公众号&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;desc&quot;</span>: <span class="string">&quot;无&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g80c6ctdebj316y0u04a3.jpg" alt="正确测试"></p>
<h3 id="校验器的顺序"><a href="#校验器的顺序" class="headerlink" title="校验器的顺序"></a>校验器的顺序</h3><ol>
<li>字段定义时的限制，包含<code>validators</code>列表条目从左到右进行校验</li>
<li>单字段「<code>validate_字段名</code>」的校验</li>
<li>多字段联合校验「<code>validate</code>方法」</li>
</ol>
<h2 id="优化视图内代码"><a href="#优化视图内代码" class="headerlink" title="优化视图内代码"></a>优化视图内代码</h2><blockquote>
<ul>
<li><p>如果在创建序列化器对象时候，只给data传参，那么调用save()方法实际调用的就是序列化器对象的<code>create()</code>方法</p>
</li>
<li><p>在创建序列化器对象时，同时给instance和data传参,那么调用save()方法实际调用的就是序列化器对象的<code>update()</code>方法</p>
</li>
</ul>
</blockquote>
<p>序列化器类<code>ProjectSerializer</code>中增加<code>create</code>和<code>update</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create</span>(<span class="params">self, validated_data</span>):</span></span><br><span class="line">    <span class="keyword">return</span> Projects.objects.create(**validated_data)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">update</span>(<span class="params">self, instance, validated_data</span>):</span></span><br><span class="line">    instance.name = validated_data[<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">    instance.leader = validated_data[<span class="string">&#x27;leader&#x27;</span>]</span><br><span class="line">    instance.tester = validated_data[<span class="string">&#x27;tester&#x27;</span>]</span><br><span class="line">    instance.programer = validated_data[<span class="string">&#x27;programer&#x27;</span>]</span><br><span class="line">    instance.publish_app = validated_data[<span class="string">&#x27;publish_app&#x27;</span>]</span><br><span class="line">    instance.desc = validated_data[<span class="string">&#x27;desc&#x27;</span>]</span><br><span class="line">    instance.save()</span><br><span class="line">    <span class="keyword">return</span> instance</span><br></pre></td></tr></table></figure>

<h3 id="修改post请求"><a href="#修改post请求" class="headerlink" title="修改post请求"></a>修改post请求</h3><p>从</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self, request</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    新建项目</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    json_data = request.body.decode(<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">    python_data = json.loads(json_data, encoding=<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">    serializer = ProjectSerializer(data=python_data)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        serializer.is_valid(raise_exception=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> JsonResponse(serializer.errors)</span><br><span class="line">    project = Projects.objects.create(**serializer.validated_data)</span><br><span class="line">    serializer = ProjectSerializer(instance=project)</span><br><span class="line">    <span class="keyword">return</span> JsonResponse(serializer.data, status=<span class="number">201</span>)</span><br></pre></td></tr></table></figure>

<p>改为</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self, request</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    新建项目</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    json_data = request.body.decode(<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">    python_data = json.loads(json_data, encoding=<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">    serializer = ProjectSerializer(data=python_data)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        serializer.is_valid(raise_exception=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> JsonResponse(serializer.errors)</span><br><span class="line">    serializer.save()</span><br><span class="line">    <span class="keyword">return</span> JsonResponse(serializer.data, status=<span class="number">201</span>)</span><br></pre></td></tr></table></figure>

<h3 id="修改put请求"><a href="#修改put请求" class="headerlink" title="修改put请求"></a>修改put请求</h3><p>从</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">put</span>(<span class="params">self, request, pk</span>):</span></span><br><span class="line">    project = self.get_object(pk)</span><br><span class="line">    json_data = request.body.decode(<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">    python_data = json.loads(json_data, encoding=<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">    serializer = ProjectSerializer(data=python_data)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        serializer.is_valid(raise_exception=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> JsonResponse(serializer.errors)</span><br><span class="line">    project.name = serializer.validated_data[<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">    project.leader = serializer.validated_data[<span class="string">&#x27;leader&#x27;</span>]</span><br><span class="line">    project.tester = serializer.validated_data[<span class="string">&#x27;tester&#x27;</span>]</span><br><span class="line">    project.programer = serializer.validated_data[<span class="string">&#x27;programer&#x27;</span>]</span><br><span class="line">    project.publish_app = serializer.validated_data[<span class="string">&#x27;publish_app&#x27;</span>]</span><br><span class="line">    project.desc = serializer.validated_data[<span class="string">&#x27;desc&#x27;</span>]</span><br><span class="line">    project.save()</span><br><span class="line"></span><br><span class="line">    serializer = ProjectSerializer(instance=project)</span><br><span class="line">    <span class="keyword">return</span> JsonResponse(serializer.data, status=<span class="number">201</span>)</span><br></pre></td></tr></table></figure>

<p>改为</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">put</span>(<span class="params">self, request, pk</span>):</span></span><br><span class="line">    project = self.get_object(pk)</span><br><span class="line">    json_data = request.body.decode(<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">    python_data = json.loads(json_data, encoding=<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">    serializer = ProjectSerializer(instance=project, data=python_data)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        serializer.is_valid(raise_exception=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> JsonResponse(serializer.errors)</span><br><span class="line">    serializer.save()</span><br><span class="line">    <span class="keyword">return</span> JsonResponse(serializer.data, status=<span class="number">201</span>)</span><br></pre></td></tr></table></figure>

<h2 id="优化序列化器"><a href="#优化序列化器" class="headerlink" title="优化序列化器"></a>优化序列化器</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProjectModelSerializer</span>(<span class="params">serializers.ModelSerializer</span>):</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        <span class="comment"># 指定参考哪一个模型类来创建</span></span><br><span class="line">        model = Projects</span><br><span class="line">        <span class="comment"># 指定为模型类的哪些字段，来生成序列化器</span></span><br><span class="line">        fields = <span class="string">&#x27;__all__&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">In[2]:from projects import serializer</span><br><span class="line">In[3]:serializer.ProjectModelSerializer()</span><br><span class="line">Out[3]: </span><br><span class="line">ProjectModelSerializer():</span><br><span class="line">    id = IntegerField(label=&#x27;ID&#x27;, read_only=True)</span><br><span class="line">    name = CharField(help_text=&#x27;项目名称&#x27;, label=&#x27;项目名称&#x27;, max_length=200, validators=[&lt;UniqueValidator(queryset=Projects.objects.all())&gt;])</span><br><span class="line">    leader = CharField(help_text=&#x27;负责人&#x27;, label=&#x27;负责人&#x27;, max_length=50)</span><br><span class="line">    tester = CharField(help_text=&#x27;测试人员&#x27;, label=&#x27;测试人员&#x27;, max_length=50)</span><br><span class="line">    programer = CharField(help_text=&#x27;开发人员&#x27;, label=&#x27;开发人员&#x27;, max_length=50)</span><br><span class="line">    publish_app = CharField(help_text=&#x27;发布应用&#x27;, label=&#x27;发布应用&#x27;, max_length=50)</span><br><span class="line">    desc = CharField(allow_blank=True, allow_null=True, help_text=&#x27;简要描述&#x27;, label=&#x27;简要描述&#x27;, required=False, style=&#123;&#x27;base_template&#x27;: &#x27;textarea.html&#x27;&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g80df362lzj31r60p8gs5.jpg" alt="简化序列化器"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fields = (<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;leader&#x27;</span>, <span class="string">&#x27;tester&#x27;</span>, <span class="string">&#x27;programer&#x27;</span>, <span class="string">&#x27;publish_app&#x27;</span>)</span><br><span class="line">exclude = (<span class="string">&#x27;publish_app&#x27;</span>)</span><br><span class="line">read_only_fields = (<span class="string">&#x27;leader&#x27;</span>,<span class="string">&#x27;tester&#x27;</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>fields</code>:指定显示哪些</p>
</li>
<li><p><code>exclude</code>:指定排除哪些</p>
</li>
<li><p><code>read_only_fields</code>:指定<code>read_only=True</code>的字段</p>
</li>
</ul>
<p>如果需要修改<code>name</code>的校验，自定义一个<code>name</code>字段</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProjectModelSerializer</span>(<span class="params">serializers.ModelSerializer</span>):</span></span><br><span class="line">    name = serializers.CharField(</span><br><span class="line">        label=<span class="string">&#x27;项目名称&#x27;</span>,</span><br><span class="line">        max_length=<span class="number">200</span>,</span><br><span class="line">        help_text=<span class="string">&#x27;项目名称&#x27;</span>,</span><br><span class="line">        validators=[</span><br><span class="line">            UniqueValidator(</span><br><span class="line">                queryset=Projects.objects.<span class="built_in">all</span>(),</span><br><span class="line">                message=<span class="string">&#x27;项目名不能重复&#x27;</span></span><br><span class="line">            ), is_unique_project_name</span><br><span class="line">        ],</span><br><span class="line">        error_messages=&#123;<span class="string">&#x27;max_length&#x27;</span>: <span class="string">&#x27;长度不能超过200个字节&#x27;</span>&#125;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = Projects</span><br><span class="line">        fields = <span class="string">&#x27;__all__&#x27;</span></span><br><span class="line">        read_only_fields = (<span class="string">&#x27;leader&#x27;</span>, <span class="string">&#x27;tester&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>也可以增加<code>extra_kwargs</code>增加其他内容</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">    <span class="comment"># 指定参考哪一个模型类来创建</span></span><br><span class="line">    model = Projects</span><br><span class="line">    <span class="comment"># 指定为模型类的哪些字段，来生成序列化器</span></span><br><span class="line">    fields = <span class="string">&#x27;__all__&#x27;</span></span><br><span class="line">    extra_kwargs = &#123;</span><br><span class="line">        <span class="string">&#x27;leader&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;write_only&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">            <span class="string">&#x27;error_messages&#x27;</span>: &#123;<span class="string">&#x27;max_length&#x27;</span>: <span class="string">&#x27;长度不能超过50个字节&#x27;</span>&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>测试一下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Out[3]: </span><br><span class="line">ProjectModelSerializer():</span><br><span class="line">    id = IntegerField(label=&#x27;ID&#x27;, read_only=True)</span><br><span class="line">    name = CharField(error_messages=&#123;&#x27;max_length&#x27;: &#x27;长度不能超过200个字节&#x27;&#125;, help_text=&#x27;项目名称&#x27;, label=&#x27;项目名称&#x27;, max_length=200, validators=[&lt;UniqueValidator(queryset=&lt;QuerySet [&lt;Projects: 测试游记&gt;, &lt;Projects: 测试游记1&gt;, &lt;Projects: 「测试游记」-创建&gt;, &lt;Projects: 1015项目&gt;, &lt;Projects: 测试游记项目&gt;]&gt;)&gt;, &lt;function is_unique_project_name&gt;])</span><br><span class="line">    leader = CharField(error_messages=&#123;&#x27;max_length&#x27;: &#x27;长度不能超过50个字节&#x27;&#125;, help_text=&#x27;负责人&#x27;, label=&#x27;负责人&#x27;, max_length=50, write_only=True)</span><br><span class="line">    tester = CharField(help_text=&#x27;测试人员&#x27;, label=&#x27;测试人员&#x27;, max_length=50)</span><br><span class="line">    programer = CharField(help_text=&#x27;开发人员&#x27;, label=&#x27;开发人员&#x27;, max_length=50)</span><br><span class="line">    publish_app = CharField(help_text=&#x27;发布应用&#x27;, label=&#x27;发布应用&#x27;, max_length=50)</span><br><span class="line">    desc = CharField(allow_blank=True, allow_null=True, help_text=&#x27;简要描述&#x27;, label=&#x27;简要描述&#x27;, required=False, style=&#123;&#x27;base_template&#x27;: &#x27;textarea.html&#x27;&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E4%BA%94)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="测试游记">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E4%BA%94)/" itemprop="url">测试开发进阶(五)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-03-03T20:10:33+08:00">
                2021-03-03
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E4%BA%94)/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2021/03/03/测试开发进阶(五)/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="测试开发进阶-五"><a href="#测试开发进阶-五" class="headerlink" title="测试开发进阶(五)"></a>测试开发进阶(五)</h1><h2 id="面向对象"><a href="#面向对象" class="headerlink" title="面向对象"></a>面向对象</h2><h3 id="魔术方法（魔法方法，特殊方法）"><a href="#魔术方法（魔法方法，特殊方法）" class="headerlink" title="魔术方法（魔法方法，特殊方法）"></a>魔术方法（魔法方法，特殊方法）</h3><h4 id="new-方法和单例模式"><a href="#new-方法和单例模式" class="headerlink" title="__new__方法和单例模式"></a><code>__new__</code>方法和单例模式</h4><blockquote>
<p><code>__init__</code>：在创建对象的时候，自动调用对 创建的对象 进行初始化设置的</p>
<p>魔术方法：以双下划线开头，双下划线结尾的方法</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@staticmethod </span><span class="comment"># known case of __new__</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__new__</span>(<span class="params">cls, *more</span>):</span> <span class="comment"># known special case of object.__new__</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; Create and return a new object.  See help(type) for accurate signature. &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p>从源码可以看出，<code>__new__</code>方法的作用是创建然后返回一个对象</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hero</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name</span>):</span></span><br><span class="line">        print(<span class="string">&#x27;这个是init方法&#x27;</span>)</span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span>(<span class="params">cls, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="comment"># 创建对象时第一步做的就是__new__方法</span></span><br><span class="line">        print(<span class="string">&#x27;这个是new方法&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>().__new__(cls)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">h1 = Hero(<span class="string">&#x27;zx&#x27;</span>)</span><br><span class="line">print(h1)</span><br><span class="line">print(h1.name)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">这个是new方法</span></span><br><span class="line"><span class="string">这个是init方法</span></span><br><span class="line"><span class="string">&lt;__main__.Hero object at 0x1033b1f60&gt;</span></span><br><span class="line"><span class="string">zx</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h5 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h5><blockquote>
<p>类每次实例化的时候都会创建一个新的对象，如果要求类只能被实例化一次该怎么做？</p>
</blockquote>
<p>普通模式：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hero</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">&#x27;这个是init方法&#x27;</span>)</span><br><span class="line"></span><br><span class="line">h1 = Hero()</span><br><span class="line">h2 = Hero()</span><br><span class="line">print(<span class="built_in">id</span>(h1), <span class="built_in">id</span>(h2))  <span class="comment"># 4328290400 4340056528</span></span><br></pre></td></tr></table></figure>

<p>单例模式：</p>
<p>第一次创建对象存起来，之后创建对象的时候直接返回第一次创建的对象</p>
<p>实现思路：</p>
<ul>
<li>定义一个类属性，来记录该类是否创建过对象</li>
<li>在<code>__new__</code>方法中</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    instance = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span>(<span class="params">cls, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">if</span> cls.count == <span class="number">0</span>:</span><br><span class="line">            <span class="comment"># 调用父类的__new__方法创建一个对象</span></span><br><span class="line">            cls.instance = <span class="built_in">object</span>.__new__(cls)</span><br><span class="line">            cls.count += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> cls.instance</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">h = MyClass()</span><br><span class="line">h1 = MyClass()</span><br><span class="line">h2 = MyClass()</span><br><span class="line">h3 = MyClass()</span><br><span class="line">print(<span class="built_in">id</span>(h), <span class="built_in">id</span>(h1), <span class="built_in">id</span>(h2), <span class="built_in">id</span>(h3)) <span class="comment"># 4349229152 4349229152 4349229152 4349229152</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 精简</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    instance = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span>(<span class="params">cls, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> cls.instance:</span><br><span class="line">            <span class="comment"># 调用父类的__new__方法创建一个对象</span></span><br><span class="line">            cls.instance = <span class="built_in">object</span>.__new__(cls)</span><br><span class="line">        <span class="keyword">return</span> cls.instance</span><br></pre></td></tr></table></figure>

<h4 id="上下文管理器"><a href="#上下文管理器" class="headerlink" title="上下文管理器"></a>上下文管理器</h4><blockquote>
<p>上下文管理器：上下文管理器是一个python对象，为操作提供额外的上下文信息。这种额外的信息，使用with语句初始化上下文，以及完成with块中的所有代码时，采用可调用的形式</p>
<p>with关键字：启动对象的上下文管理器</p>
</blockquote>
<ul>
<li><code>object.__enter__(self)</code></li>
</ul>
<p>输入与次对象相关的运行时上下文。如果存在的话，with语句将绑定该方法的返回值到该语句的as子语句中指定的目标</p>
<ul>
<li><code>object.__exit__(self, exc_type, exc_val, exc_tb)</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;0814.py&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    content = f.read()</span><br><span class="line">    print(content)</span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyOpen</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__enter__</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">&#x27;enter&#x27;</span>) <span class="comment"># 1⃣️</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__exit__</span>(<span class="params">self, exc_type, exc_val, exc_tb</span>):</span></span><br><span class="line">        print(<span class="string">&#x27;exit&#x27;</span>) <span class="comment"># 3⃣️</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> MyOpen() <span class="keyword">as</span> f:</span><br><span class="line">    print(f) <span class="comment"># 2⃣️</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">enter 1⃣️</span></span><br><span class="line"><span class="string">None  2⃣️</span></span><br><span class="line"><span class="string">exit  3⃣️</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyOpen</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__enter__</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">&#x27;enter&#x27;</span>) <span class="comment"># 1⃣️</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">999</span> <span class="comment"># 2⃣️</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__exit__</span>(<span class="params">self, exc_type, exc_val, exc_tb</span>):</span></span><br><span class="line">        print(<span class="string">&#x27;exit&#x27;</span>) <span class="comment"># 3⃣️</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> MyOpen() <span class="keyword">as</span> f:</span><br><span class="line">    print(f) <span class="comment"># 2⃣️</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">enter 1⃣️</span></span><br><span class="line"><span class="string">999   2⃣️</span></span><br><span class="line"><span class="string">exit  3⃣️</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p>自己实现的文件操作上下文管理器</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyOpen</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, file_name, method, encoding</span>):</span></span><br><span class="line">        self.file_name = file_name</span><br><span class="line">        self.method = method</span><br><span class="line">        self.encoding = encoding</span><br><span class="line">        self.f = <span class="built_in">open</span>(self.file_name, self.method, encoding=self.encoding)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__enter__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.f</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__exit__</span>(<span class="params">self, exc_type, exc_val, exc_tb</span>):</span></span><br><span class="line">        self.f.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> MyOpen(<span class="string">&#x27;0814.py&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    print(f.read())</span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">exc_type <span class="comment"># 异常类型</span></span><br><span class="line">exc_val <span class="comment"># 异常值</span></span><br><span class="line">exc_tb <span class="comment"># 异常回溯追踪</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyOpen</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, file_name, method, encoding</span>):</span></span><br><span class="line">        self.file_name = file_name</span><br><span class="line">        self.method = method</span><br><span class="line">        self.encoding = encoding</span><br><span class="line">        self.f = <span class="built_in">open</span>(self.file_name, self.method, encoding=self.encoding)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__enter__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.f</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__exit__</span>(<span class="params">self, exc_type, exc_val, exc_tb</span>):</span></span><br><span class="line">        self.f.close()</span><br><span class="line">        print(exc_type) <span class="comment"># &lt;class &#x27;NameError&#x27;&gt;</span></span><br><span class="line">        time.sleep(<span class="number">0.5</span>)</span><br><span class="line">        print(exc_val) <span class="comment"># name &#x27;a&#x27; is not defined</span></span><br><span class="line">        time.sleep(<span class="number">0.5</span>)</span><br><span class="line">        print(exc_tb)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Traceback (most recent call last):</span></span><br><span class="line"><span class="string">  File &quot;/Users/zhongxin/Desktop/py/zx/05/0814_2.py&quot;, line 34, in &lt;module&gt;</span></span><br><span class="line"><span class="string">    print(a)</span></span><br><span class="line"><span class="string">NameError: name &#x27;a&#x27; is not defined</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> MyOpen(<span class="string">&#x27;0814.py&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    print(a)</span><br></pre></td></tr></table></figure>

<p>执行顺序：实例化(<code>__init__</code>)—-&gt; 执行<code>__enter__</code>—-&gt;执行with中的代码—–&gt;执行<code> __exit__</code></p>
<h4 id="str-repr-方法"><a href="#str-repr-方法" class="headerlink" title="__str__,__repr__方法"></a><code>__str__</code>,<code>__repr__</code>方法</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; a = <span class="string">&#x27;abc&#x27;</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; <span class="built_in">print</span>(a)</span></span><br><span class="line">abc</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; a</span></span><br><span class="line">&#x27;abc&#x27;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>当我们使用print()这个内置函数之后，给他传入一个对象，实际上是触发了它的<code>__str__</code>方法，将方法返回的内容输出到控制台</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hero</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">h = Hero(<span class="string">&#x27;zx&#x27;</span>)</span><br><span class="line">print(h) <span class="comment"># &lt;__main__.Hero object at 0x103295908&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hero</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">&#x27;STR&#x27;</span>) <span class="comment"># 1⃣️</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;666&#x27;</span> <span class="comment"># 2⃣️</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">h = Hero(<span class="string">&#x27;zx&#x27;</span>)</span><br><span class="line">print(h)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">STR  1⃣️</span></span><br><span class="line"><span class="string">666  2⃣️</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>在交互环境中，输入对象，返回的是<code>__repr__</code>方法中所返回的内容</p>
</blockquote>
<ul>
<li>内置函数str转化一个对象时候，触发<code>__str__</code>方法</li>
<li>内置函数format处理对象时，触发<code>__str__</code>方法</li>
<li>内置函数repr函数，触发<code>__repr__</code>方法</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hero</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">h = Hero(<span class="string">&#x27;zx&#x27;</span>)</span><br><span class="line">print(h) <span class="comment"># zx</span></span><br><span class="line">print(<span class="built_in">str</span>(h)) <span class="comment"># zx</span></span><br><span class="line">print(<span class="built_in">repr</span>(h)) <span class="comment"># &lt;__main__.Hero object at 0x1031c7860&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>__repr__</code>是<code>__str__</code>的备胎，当没有<code>__str__</code>的时候调用<code>__repr__</code>，反过来不会</p>
<h4 id="算数运算相关的魔术方法"><a href="#算数运算相关的魔术方法" class="headerlink" title="算数运算相关的魔术方法"></a>算数运算相关的魔术方法</h4><ul>
<li><p><code> __add__</code>：相加</p>
</li>
<li><p><code>__sub__</code>：减法</p>
</li>
<li><p><code>__mul__</code>：乘法</p>
</li>
<li><p><code>__stuediv__</code>：除法</p>
</li>
<li><p><code>__floordiv__</code>：整除</p>
</li>
<li><p><code>__mod__</code>：取余</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyStr</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, value</span>):</span></span><br><span class="line">        self.value = value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__add__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&#x27;<span class="subst">&#123;self&#125;</span><span class="subst">&#123;other&#125;</span>&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__sub__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&#x27;<span class="subst">&#123;self&#125;</span>-<span class="subst">&#123;other&#125;</span>&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">v1 = MyStr(<span class="string">&#x27;aaa&#x27;</span>)</span><br><span class="line">v2 = MyStr(<span class="string">&#x27;bbb&#x27;</span>)</span><br><span class="line">print(v1 + v2)  <span class="comment"># aaabbb</span></span><br><span class="line">print(v1 - v2)  <span class="comment"># aaa-bbb</span></span><br></pre></td></tr></table></figure>

<p>多个连续相加</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyStr</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, value</span>):</span></span><br><span class="line">        self.value = value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__add__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">        <span class="keyword">return</span> MyStr(<span class="string">f&#x27;<span class="subst">&#123;self&#125;</span><span class="subst">&#123;other&#125;</span>&#x27;</span>)<span class="comment">#⚠️</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">v1 = MyStr(<span class="string">&#x27;aaa&#x27;</span>)</span><br><span class="line">v2 = MyStr(<span class="string">&#x27;bbb&#x27;</span>)</span><br><span class="line">v3 = MyStr(<span class="string">&#x27;ccc&#x27;</span>)</span><br><span class="line">print(v1 + v2 + v3) <span class="comment"># aaabbbccc</span></span><br></pre></td></tr></table></figure>

<p>一个没啥用的减法实现</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyStr</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, value</span>):</span></span><br><span class="line">        self.value = value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__add__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">        <span class="keyword">return</span> MyStr(<span class="string">f&#x27;<span class="subst">&#123;self&#125;</span><span class="subst">&#123;other&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__sub__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">        <span class="keyword">return</span> MyStr(self.value.replace(other.value, <span class="string">&#x27;&#x27;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">v1 = MyStr(<span class="string">&#x27;aaa&#x27;</span>)</span><br><span class="line">v2 = MyStr(<span class="string">&#x27;bbb&#x27;</span>)</span><br><span class="line">v12 = v1 + v2</span><br><span class="line">print(v12)</span><br><span class="line">print(v12 - v1)</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E4%BA%8C%E5%8D%81%E5%9B%9B)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="测试游记">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E4%BA%8C%E5%8D%81%E5%9B%9B)/" itemprop="url">测试开发进阶(二十四)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-03-03T20:10:33+08:00">
                2021-03-03
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E4%BA%8C%E5%8D%81%E5%9B%9B)/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2021/03/03/测试开发进阶(二十四)/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="测试开发进阶-二十四"><a href="#测试开发进阶-二十四" class="headerlink" title="测试开发进阶(二十四)"></a>测试开发进阶(二十四)</h1><p>欢迎关注我的公众号「测试游记」</p>
<h2 id="REST-API"><a href="#REST-API" class="headerlink" title="REST API"></a>REST API</h2><p>官方文档：<a target="_blank" rel="noopener" href="https://restfulapi.net/">https://restfulapi.net/</a></p>
<p>一种开发理念「是设计风格 而不是标准」</p>
<blockquote>
<p>REST is acronym for <strong>RE</strong>presentational <strong>S</strong>tate <strong>T</strong>ransfer.</p>
</blockquote>
<p>每一个URL代表一种「<strong>资源</strong>」</p>
<p>具体要对资源做什么操作，要体现在请求方式上，而不是URL上</p>
<ul>
<li>json格式数据</li>
<li>text文本</li>
<li>图片，视频等</li>
</ul>
<p>客户端和服务器之间，传递这种资源的某种表现形式</p>
<ul>
<li>通过请求头中的<code>Content-Type</code>来指明传给服务端的参数类型</li>
</ul>
<blockquote>
<p>text/plain</p>
<p>application/xml</p>
<p>text/html</p>
<p>application/json</p>
<p>image/gif</p>
<p>image/jpeg</p>
<p>Application/x-www-form-urlencoded</p>
</blockquote>
<ul>
<li>通过请求头中<code>Accept</code>来指明希望接受服务端的数据类型</li>
</ul>
<blockquote>
<p><code>Accept:application/json,application/xml;q=0.9,*/*;q=0.8</code></p>
</blockquote>
<ul>
<li>POST：创建「create」</li>
<li>GET：获取「read」</li>
<li>PUT：更新，替换「update/replace」</li>
<li>PATCH：部分更新「Partial update/modify」</li>
<li>DELETE：删除「delete」</li>
</ul>
<h3 id="设计规则"><a href="#设计规则" class="headerlink" title="设计规则"></a>设计规则</h3><h4 id="命名"><a href="#命名" class="headerlink" title="命名"></a>命名</h4><ul>
<li>尽量使用名词复数形式</li>
<li>往往与数据库的表名对应</li>
</ul>
<h4 id="过滤条件"><a href="#过滤条件" class="headerlink" title="过滤条件"></a>过滤条件</h4><p>一般记录数量较多，服务器不可能将所有数据都返回给前端</p>
<p>例如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?page=2&amp;size=10 指定页数，条数</span><br><span class="line">?sort=name		 指定排序</span><br></pre></td></tr></table></figure>

<h4 id="域名"><a href="#域名" class="headerlink" title="域名"></a>域名</h4><p>尽量使用专用域名</p>
<p>前后端分离之后，前后端都有一个域名</p>
<p>例如<code>http://api.xxx.xxx</code></p>
<h4 id="版本"><a href="#版本" class="headerlink" title="版本"></a>版本</h4><ul>
<li>在url中呈现版本号</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://api.xxx.xxx/app/0.1</span><br></pre></td></tr></table></figure>

<ul>
<li>在请求头中呈现</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Accept: application/vnd.example.v0.2+json</span><br><span class="line">Accept: application/vnd.example+json;version=1.1</span><br></pre></td></tr></table></figure>

<h4 id="常见请求含义"><a href="#常见请求含义" class="headerlink" title="常见请求含义"></a>常见请求含义</h4><ul>
<li>GET(SELECT):从服务器获取资源(一项或多项)</li>
<li>POST(CREATE):从服务器新建一个资源</li>
<li>PUT(UPDATE):从服务器更新资源(客户端提供改变后的完整资源)</li>
<li>DELETE(DELETE):从服务器删除资源</li>
<li>PATCH(UPDATE WHERE):在服务器部分更新资源(客户端提供改变的属性)</li>
<li>HEAD:获取资源的元数据</li>
<li>OPTIONS:获取关于资源的哪些属性是客户端可以改变的信息</li>
</ul>
<h4 id="状态码"><a href="#状态码" class="headerlink" title="状态码"></a>状态码</h4><ul>
<li>200:OK</li>
</ul>
<p>「GET」服务器成功返回用户请求的数据</p>
<ul>
<li>201:CREATED</li>
</ul>
<p>「POST/PUT/PATCH」用户新建或修改数据成功</p>
<ul>
<li>204:NO CONTENT</li>
</ul>
<p>「DELETE」用户删除数据成功</p>
<ul>
<li>400:INVALID REQUEST</li>
</ul>
<p>「POST/PUT/PATCH」用户请求有误（请求参数有误）</p>
<ul>
<li>401:Unauthorized</li>
</ul>
<p>「*」用户没有权限（令牌，用户名，密码错误）</p>
<ul>
<li>403:Forbidden</li>
</ul>
<p>「*」表示用户得到授权（与401错误相对），但是访问是被禁止的</p>
<ul>
<li>404:NOT FOUND</li>
</ul>
<p>「*」用户请求路径不存在</p>
<ul>
<li>500:INTERNAL SERVER ERROR</li>
</ul>
<p>「*」服务器发生错误</p>
<h2 id="接口设计"><a href="#接口设计" class="headerlink" title="接口设计"></a>接口设计</h2><h3 id="最原始设计"><a href="#最原始设计" class="headerlink" title="最原始设计"></a>最原始设计</h3><h4 id="GET"><a href="#GET" class="headerlink" title="GET"></a>GET</h4><ol>
<li>从数据库中获取所有的项目信息</li>
<li>将数据库模型实例转化为字典类型「Json数组」「嵌套字典的列表」</li>
<li><strong>注意</strong>：JsonResponse第一个参数默认只能为dict字典，如果要设为其他类型，需要将safe设为False</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># LearnDjango/projects/views.py</span></span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> JsonResponse</span><br><span class="line"><span class="keyword">from</span> projects.models <span class="keyword">import</span> Projects</span><br><span class="line"><span class="keyword">from</span> django.views <span class="keyword">import</span> View</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProjectsList</span>(<span class="params">View</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, reuqest</span>):</span></span><br><span class="line">        <span class="comment"># 1.从数据库中获取所有的项目信息</span></span><br><span class="line">        project_qs = Projects.objects.<span class="built_in">all</span>()</span><br><span class="line">        <span class="comment"># 2.将数据库模型实例转化为字典类型「Json数组」「嵌套字典的列表」</span></span><br><span class="line">        project_list = []</span><br><span class="line">        <span class="keyword">for</span> project <span class="keyword">in</span> project_qs:</span><br><span class="line">            project_list.append(</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">&#x27;name&#x27;</span>: project.name,</span><br><span class="line">                    <span class="string">&#x27;leader&#x27;</span>: project.leader,</span><br><span class="line">                    <span class="string">&#x27;tester&#x27;</span>: project.tester,</span><br><span class="line">                    <span class="string">&#x27;programer&#x27;</span>: project.programer,</span><br><span class="line">                    <span class="string">&#x27;publish_app&#x27;</span>: project.publish_app,</span><br><span class="line">                    <span class="string">&#x27;desc&#x27;</span>: project.desc</span><br><span class="line">                &#125;</span><br><span class="line">            )</span><br><span class="line">        <span class="comment"># JsonResponse第一个参数默认只能为dict字典，如果要设为其他类型，需要将safe设为False</span></span><br><span class="line">        <span class="keyword">return</span> JsonResponse(project_list, safe=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># LearnDjango/projects/urls.py</span></span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> projects <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;project/&#x27;</span>, views.ProjectsList.as_view()),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># LearnDjango/urls.py</span></span><br><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path, include, re_path</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;admin/&#x27;</span>, admin.site.urls),</span><br><span class="line">    path(<span class="string">&#x27;&#x27;</span>, include(<span class="string">&#x27;projects.urls&#x27;</span>))</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> http http://127.0.0.1:8000/project/</span></span><br><span class="line">zhongxindeMacBook-Pro:~ zhongxin$ http http://127.0.0.1:8000/project/</span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Length: 650</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Date: Fri, 11 Oct 2019 13:02:56 GMT</span><br><span class="line">Server: WSGIServer/0.2 CPython/3.7.1</span><br><span class="line">Vary: Origin</span><br><span class="line">X-Frame-Options: SAMEORIGIN</span><br><span class="line"></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;desc&quot;: &quot;666&quot;,</span><br><span class="line">        &quot;leader&quot;: &quot;zx_94&quot;,</span><br><span class="line">        &quot;name&quot;: &quot;测试游记&quot;,</span><br><span class="line">        &quot;programer&quot;: &quot;zhong&quot;,</span><br><span class="line">        &quot;publish_app&quot;: &quot;公众号&quot;,</span><br><span class="line">        &quot;tester&quot;: &quot;zx&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;desc&quot;: &quot;6666&quot;,</span><br><span class="line">        &quot;leader&quot;: &quot;zx_94_1&quot;,</span><br><span class="line">        &quot;name&quot;: &quot;测试游记1&quot;,</span><br><span class="line">        &quot;programer&quot;: &quot;zhong1&quot;,</span><br><span class="line">        &quot;publish_app&quot;: &quot;公众号1&quot;,</span><br><span class="line">        &quot;tester&quot;: &quot;zx1&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;desc&quot;: &quot;666&quot;,</span><br><span class="line">        &quot;leader&quot;: &quot;zx_94&quot;,</span><br><span class="line">        &quot;name&quot;: &quot;「测试游记」-创建&quot;,</span><br><span class="line">        &quot;programer&quot;: &quot;zx&quot;,</span><br><span class="line">        &quot;publish_app&quot;: &quot;公众号&quot;,</span><br><span class="line">        &quot;tester&quot;: &quot;zx&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;desc&quot;: &quot;666&quot;,</span><br><span class="line">        &quot;leader&quot;: &quot;钟鑫&quot;,</span><br><span class="line">        &quot;name&quot;: &quot;10月1日作业&quot;,</span><br><span class="line">        &quot;programer&quot;: &quot;钟鑫&quot;,</span><br><span class="line">        &quot;publish_app&quot;: &quot;国庆作业&quot;,</span><br><span class="line">        &quot;tester&quot;: &quot;钟鑫&quot;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7ukbsl2w4j31bi0u0tta.jpg" alt="GET"></p>
<h4 id="POST"><a href="#POST" class="headerlink" title="POST"></a>POST</h4><ol>
<li>从前端获取json格式的数据，转化为Python中的类型</li>
</ol>
<blockquote>
<p>为了严谨性，这里需要做各种复杂的校验</p>
<p>比如：是否为json,传递的项目数据是否符合要求,有些必传参数是否携带</p>
</blockquote>
<ol start="2">
<li>向数据库中新增项目</li>
<li>将模型类转化为字典，然后返回</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self, request</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    新建项目</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 1.从前端获取json格式的数据，转化为Python中的类型</span></span><br><span class="line">    <span class="comment"># 为了严谨性，这里需要做各种复杂的校验</span></span><br><span class="line">    <span class="comment"># 比如：是否为json,传递的项目数据是否符合要求,有些必传参数是否携带</span></span><br><span class="line">    json_data = request.body.decode(<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">    python_data = json.loads(json_data, encoding=<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">    <span class="comment"># 2.向数据库中新增项目</span></span><br><span class="line">    project = Projects.objects.create(**python_data)</span><br><span class="line">    <span class="comment"># 3.将模型类转化为字典，然后返回</span></span><br><span class="line">    one_dict = &#123;</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span>: project.name,</span><br><span class="line">        <span class="string">&#x27;leader&#x27;</span>: project.leader,</span><br><span class="line">        <span class="string">&#x27;tester&#x27;</span>: project.tester,</span><br><span class="line">        <span class="string">&#x27;programer&#x27;</span>: project.programer,</span><br><span class="line">        <span class="string">&#x27;publish_app&#x27;</span>: project.publish_app,</span><br><span class="line">        <span class="string">&#x27;desc&#x27;</span>: project.desc</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> JsonResponse(one_dict)</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> http POST http://127.0.0.1:8000/project/ name=10月11日「测试游记」 leader=zx tester=zx programer=zx publish_app=10月11日内容 desc=测试post请求</span></span><br><span class="line">zhongxindeMacBook-Pro:~ zhongxin$ http POST http://127.0.0.1:8000/project/ name=10月11日「测试游记」 leader=zx tester=zx programer=zx publish_app=10月11日内容 desc=测试post请求</span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Length: 202</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Date: Fri, 11 Oct 2019 13:31:46 GMT</span><br><span class="line">Server: WSGIServer/0.2 CPython/3.7.1</span><br><span class="line">Vary: Origin</span><br><span class="line">X-Frame-Options: SAMEORIGIN</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;desc&quot;: &quot;测试post请求&quot;,</span><br><span class="line">    &quot;leader&quot;: &quot;zx&quot;,</span><br><span class="line">    &quot;name&quot;: &quot;10月11日「测试游记」&quot;,</span><br><span class="line">    &quot;programer&quot;: &quot;zx&quot;,</span><br><span class="line">    &quot;publish_app&quot;: &quot;10月11日内容&quot;,</span><br><span class="line">    &quot;tester&quot;: &quot;zx&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7ul4ap73uj316y0u0wru.jpg" alt="POST"></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7ul5344iqj31b30u0twb.jpg" alt="查看数据库"></p>
<h4 id="GET具体内容"><a href="#GET具体内容" class="headerlink" title="GET具体内容"></a>GET具体内容</h4><ol>
<li>校验前端传递的pk(项目ID)值,类型是否正确(正整数),在数据库中是否存在等「先省略」</li>
<li>获取指定pk值的项目</li>
<li>将模型类转化为字典，然后返回</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># projects/views.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProjectDetail</span>(<span class="params">View</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request, pk</span>):</span></span><br><span class="line">        <span class="comment"># 1.校验前端传递的pk(项目ID)值,类型是否正确(正整数),在数据库中是否存在等「先省略」</span></span><br><span class="line">        <span class="comment"># 2.获取指定pk值的项目</span></span><br><span class="line">        project = Projects.objects.get(<span class="built_in">id</span>=pk)</span><br><span class="line">        <span class="comment"># 3.将模型类转化为字典，然后返回</span></span><br><span class="line">        one_dict = &#123;</span><br><span class="line">            <span class="string">&#x27;name&#x27;</span>: project.name,</span><br><span class="line">            <span class="string">&#x27;leader&#x27;</span>: project.leader,</span><br><span class="line">            <span class="string">&#x27;tester&#x27;</span>: project.tester,</span><br><span class="line">            <span class="string">&#x27;programer&#x27;</span>: project.programer,</span><br><span class="line">            <span class="string">&#x27;publish_app&#x27;</span>: project.publish_app,</span><br><span class="line">            <span class="string">&#x27;desc&#x27;</span>: project.desc</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> JsonResponse(one_dict)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># projects/urls.py</span></span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> projects <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;project/&#x27;</span>, views.ProjectsList.as_view()),</span><br><span class="line">    path(<span class="string">&#x27;project/&lt;int:pk&gt;/&#x27;</span>, views.ProjectDetail.as_view()),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> http :8000/project/1/</span></span><br><span class="line">zhongxindeMacBook-Pro:~ zhongxin$ http :8000/project/1/</span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Length: 145</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Date: Fri, 11 Oct 2019 13:42:44 GMT</span><br><span class="line">Server: WSGIServer/0.2 CPython/3.7.1</span><br><span class="line">Vary: Origin</span><br><span class="line">X-Frame-Options: SAMEORIGIN</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;desc&quot;: &quot;666&quot;,</span><br><span class="line">    &quot;leader&quot;: &quot;zx_94&quot;,</span><br><span class="line">    &quot;name&quot;: &quot;测试游记&quot;,</span><br><span class="line">    &quot;programer&quot;: &quot;zhong&quot;,</span><br><span class="line">    &quot;publish_app&quot;: &quot;公众号&quot;,</span><br><span class="line">    &quot;tester&quot;: &quot;zx&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7ulfci6qvj316y0u0gws.jpg" alt="GET具体内容"></p>
<h4 id="PUT具体内容"><a href="#PUT具体内容" class="headerlink" title="PUT具体内容"></a>PUT具体内容</h4><ol>
<li>校验前端传递的pk(项目ID)值,类型是否正确(正整数),在数据库中是否存在等「先省略」</li>
<li>获取指定pk值的项目</li>
<li>从前端获取json格式的数据，转化为Python中的类型</li>
</ol>
<blockquote>
<p>为了严谨性，这里需要做各种复杂的校验</p>
<p>比如：是否为json,传递的项目数据是否符合要求,有些必传参数是否携带</p>
</blockquote>
<ol start="4">
<li>更新项目</li>
<li>将模型类转化为字典，然后返回</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">put</span>(<span class="params">self, request, pk</span>):</span></span><br><span class="line">    <span class="comment"># 1.校验前端传递的pk(项目ID)值,类型是否正确(正整数),在数据库中是否存在等「先省略」</span></span><br><span class="line">    <span class="comment"># 2.获取指定pk值的项目</span></span><br><span class="line">    project = Projects.objects.get(<span class="built_in">id</span>=pk)</span><br><span class="line">    <span class="comment"># 3.从前端获取json格式的数据，转化为Python中的类型</span></span><br><span class="line">    <span class="comment"># 为了严谨性，这里需要做各种复杂的校验</span></span><br><span class="line">    <span class="comment"># 比如：是否为json,传递的项目数据是否符合要求,有些必传参数是否携带</span></span><br><span class="line">    json_data = request.body.decode(<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">    python_data = json.loads(json_data, encoding=<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">    <span class="comment"># 4.更新项目</span></span><br><span class="line">    project.name = python_data[<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">    project.leader = python_data[<span class="string">&#x27;leader&#x27;</span>]</span><br><span class="line">    project.tester = python_data[<span class="string">&#x27;tester&#x27;</span>]</span><br><span class="line">    project.programer = python_data[<span class="string">&#x27;programer&#x27;</span>]</span><br><span class="line">    project.publish_app = python_data[<span class="string">&#x27;publish_app&#x27;</span>]</span><br><span class="line">    project.desc = python_data[<span class="string">&#x27;desc&#x27;</span>]</span><br><span class="line">    project.save()</span><br><span class="line">    <span class="comment"># 5.将模型类转化为字典，然后返回</span></span><br><span class="line">    one_dict = &#123;</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span>: project.name,</span><br><span class="line">        <span class="string">&#x27;leader&#x27;</span>: project.leader,</span><br><span class="line">        <span class="string">&#x27;tester&#x27;</span>: project.tester,</span><br><span class="line">        <span class="string">&#x27;programer&#x27;</span>: project.programer,</span><br><span class="line">        <span class="string">&#x27;publish_app&#x27;</span>: project.publish_app,</span><br><span class="line">        <span class="string">&#x27;desc&#x27;</span>: project.desc</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> JsonResponse(one_dict, status=<span class="number">201</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> http PUT :8000/project/5/ name=10月11日「测试游记」 leader=zhongxin tester=zx programer=zx publish_app=10月11日内容 desc=测试post请求</span></span><br><span class="line">zhongxindeMacBook-Pro:~ zhongxin$ http PUT :8000/project/5/ name=10月11日「测试游记」 leader=zhongxin tester=zx programer=zx publish_app=10月11日内容 desc=测试post请求</span><br><span class="line">HTTP/1.1 201 Created</span><br><span class="line">Content-Length: 208</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Date: Fri, 11 Oct 2019 13:53:49 GMT</span><br><span class="line">Server: WSGIServer/0.2 CPython/3.7.1</span><br><span class="line">Vary: Origin</span><br><span class="line">X-Frame-Options: SAMEORIGIN</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;desc&quot;: &quot;测试post请求&quot;,</span><br><span class="line">    &quot;leader&quot;: &quot;zhongxin&quot;,</span><br><span class="line">    &quot;name&quot;: &quot;10月11日「测试游记」&quot;,</span><br><span class="line">    &quot;programer&quot;: &quot;zx&quot;,</span><br><span class="line">    &quot;publish_app&quot;: &quot;10月11日内容&quot;,</span><br><span class="line">    &quot;tester&quot;: &quot;zx&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7ulqyc5pqj316y0u07gt.jpg" alt="PUT"></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7ulrh5hzfj31b30u0h9v.jpg" alt="修改后"></p>
<h4 id="DELETE"><a href="#DELETE" class="headerlink" title="DELETE"></a>DELETE</h4><ol>
<li>校验前端传递的pk(项目ID)值,类型是否正确(正整数),在数据库中是否存在等「先省略」</li>
<li>获取指定pk值的项目</li>
<li>删除</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">self, request, pk</span>):</span></span><br><span class="line">    <span class="comment"># 1.校验前端传递的pk(项目ID)值,类型是否正确(正整数),在数据库中是否存在等「先省略」</span></span><br><span class="line">    <span class="comment"># 2.获取指定pk值的项目</span></span><br><span class="line">    project = Projects.objects.get(<span class="built_in">id</span>=pk)</span><br><span class="line">    project.delete()</span><br><span class="line">    <span class="keyword">return</span> JsonResponse(&#123;&#125;, safe=<span class="literal">True</span>, status=<span class="number">204</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> http DELETE :8000/project/6/</span></span><br><span class="line">zhongxindeMacBook-Pro:~ zhongxin$ http DELETE :8000/project/6/</span><br><span class="line">HTTP/1.1 204 No Content</span><br><span class="line">Content-Length: 2</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Date: Fri, 11 Oct 2019 14:03:45 GMT</span><br><span class="line">Server: WSGIServer/0.2 CPython/3.7.1</span><br><span class="line">Vary: Origin</span><br><span class="line">X-Frame-Options: SAMEORIGIN</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7um1bvffwj316y0u0gxr.jpg" alt="DELETE"></p>
<h3 id="原始设计小结"><a href="#原始设计小结" class="headerlink" title="原始设计小结"></a>原始设计小结</h3><p><strong>创建接口的任务</strong></p>
<ol>
<li>校验用户数据</li>
<li>将请求的数据(如json格式)转换为模型类对象</li>
</ol>
<blockquote>
<h1 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h1><ul>
<li>将其他格式（json,xml等）转换为程序中的数据类型</li>
<li>将json格式的字符串转换为Django中的模型类对象</li>
</ul>
</blockquote>
<ol start="3">
<li>操作数据库</li>
<li>将模型类对象转换为响应的数据（如json格式）</li>
</ol>
<blockquote>
<h1 id="序列化"><a href="#序列化" class="headerlink" title="序列化"></a>序列化</h1><ul>
<li>将程序中的数据类型转换为其他格式（json，xml等）</li>
<li>例如将Django中的模型类对象转换为json字符串</li>
</ul>
</blockquote>
<h3 id="数据增删改查流程"><a href="#数据增删改查流程" class="headerlink" title="数据增删改查流程"></a>数据增删改查流程</h3><ul>
<li>增</li>
</ul>
<blockquote>
<p>校验请求参数 -&gt; 反序列化 -&gt; 保存数据 -&gt; 将保存的对象序列化并返回</p>
</blockquote>
<ul>
<li>删</li>
</ul>
<blockquote>
<p>判断要删除的数据是否存在 -&gt; 执行数据删除</p>
</blockquote>
<ul>
<li>改</li>
</ul>
<blockquote>
<p>判断要修改的数据是否存在 -&gt; 校验请求参数 -&gt; 反序列化 -&gt; 保存数据 -&gt; 将保存的数据序列号并返回</p>
</blockquote>
<ul>
<li>查</li>
</ul>
<blockquote>
<p>查询数据库 -&gt; 将数据序列化并返回</p>
</blockquote>
<h3 id="原始设计代码"><a href="#原始设计代码" class="headerlink" title="原始设计代码"></a>原始设计代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> JsonResponse</span><br><span class="line"><span class="keyword">from</span> projects.models <span class="keyword">import</span> Projects</span><br><span class="line"><span class="keyword">from</span> django.views <span class="keyword">import</span> View</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProjectsList</span>(<span class="params">View</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, reuqest</span>):</span></span><br><span class="line">        <span class="comment"># 1.从数据库中获取所有的项目信息</span></span><br><span class="line">        project_qs = Projects.objects.<span class="built_in">all</span>()</span><br><span class="line">        <span class="comment"># 2.将数据库模型实例转化为字典类型「Json数组」「嵌套字典的列表」</span></span><br><span class="line">        project_list = []</span><br><span class="line">        <span class="keyword">for</span> project <span class="keyword">in</span> project_qs:</span><br><span class="line">            project_list.append(</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">&#x27;name&#x27;</span>: project.name,</span><br><span class="line">                    <span class="string">&#x27;leader&#x27;</span>: project.leader,</span><br><span class="line">                    <span class="string">&#x27;tester&#x27;</span>: project.tester,</span><br><span class="line">                    <span class="string">&#x27;programer&#x27;</span>: project.programer,</span><br><span class="line">                    <span class="string">&#x27;publish_app&#x27;</span>: project.publish_app,</span><br><span class="line">                    <span class="string">&#x27;desc&#x27;</span>: project.desc</span><br><span class="line">                &#125;</span><br><span class="line">            )</span><br><span class="line">        <span class="comment"># JsonResponse第一个参数默认只能为dict字典，如果要设为其他类型，需要将safe设为False</span></span><br><span class="line">        <span class="keyword">return</span> JsonResponse(project_list, safe=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        新建项目</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># 1.从前端获取json格式的数据，转化为Python中的类型</span></span><br><span class="line">        <span class="comment"># 为了严谨性，这里需要做各种复杂的校验</span></span><br><span class="line">        <span class="comment"># 比如：是否为json,传递的项目数据是否符合要求,有些必传参数是否携带</span></span><br><span class="line">        json_data = request.body.decode(<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">        python_data = json.loads(json_data, encoding=<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">        <span class="comment"># 2.向数据库中新增项目</span></span><br><span class="line">        project = Projects.objects.create(**python_data)</span><br><span class="line">        <span class="comment"># 3.将模型类转化为字典，然后返回</span></span><br><span class="line">        one_dict = &#123;</span><br><span class="line">            <span class="string">&#x27;name&#x27;</span>: project.name,</span><br><span class="line">            <span class="string">&#x27;leader&#x27;</span>: project.leader,</span><br><span class="line">            <span class="string">&#x27;tester&#x27;</span>: project.tester,</span><br><span class="line">            <span class="string">&#x27;programer&#x27;</span>: project.programer,</span><br><span class="line">            <span class="string">&#x27;publish_app&#x27;</span>: project.publish_app,</span><br><span class="line">            <span class="string">&#x27;desc&#x27;</span>: project.desc</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> JsonResponse(one_dict)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProjectDetail</span>(<span class="params">View</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request, pk</span>):</span></span><br><span class="line">        <span class="comment"># 1.校验前端传递的pk(项目ID)值,类型是否正确(正整数),在数据库中是否存在等「先省略」</span></span><br><span class="line">        <span class="comment"># 2.获取指定pk值的项目</span></span><br><span class="line">        project = Projects.objects.get(<span class="built_in">id</span>=pk)</span><br><span class="line">        <span class="comment"># 3.将模型类转化为字典，然后返回</span></span><br><span class="line">        one_dict = &#123;</span><br><span class="line">            <span class="string">&#x27;name&#x27;</span>: project.name,</span><br><span class="line">            <span class="string">&#x27;leader&#x27;</span>: project.leader,</span><br><span class="line">            <span class="string">&#x27;tester&#x27;</span>: project.tester,</span><br><span class="line">            <span class="string">&#x27;programer&#x27;</span>: project.programer,</span><br><span class="line">            <span class="string">&#x27;publish_app&#x27;</span>: project.publish_app,</span><br><span class="line">            <span class="string">&#x27;desc&#x27;</span>: project.desc</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> JsonResponse(one_dict)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put</span>(<span class="params">self, request, pk</span>):</span></span><br><span class="line">        <span class="comment"># 1.校验前端传递的pk(项目ID)值,类型是否正确(正整数),在数据库中是否存在等「先省略」</span></span><br><span class="line">        <span class="comment"># 2.获取指定pk值的项目</span></span><br><span class="line">        project = Projects.objects.get(<span class="built_in">id</span>=pk)</span><br><span class="line">        <span class="comment"># 3.从前端获取json格式的数据，转化为Python中的类型</span></span><br><span class="line">        <span class="comment"># 为了严谨性，这里需要做各种复杂的校验</span></span><br><span class="line">        <span class="comment"># 比如：是否为json,传递的项目数据是否符合要求,有些必传参数是否携带</span></span><br><span class="line">        json_data = request.body.decode(<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">        python_data = json.loads(json_data, encoding=<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">        <span class="comment"># 4.更新项目</span></span><br><span class="line">        project.name = python_data[<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">        project.leader = python_data[<span class="string">&#x27;leader&#x27;</span>]</span><br><span class="line">        project.tester = python_data[<span class="string">&#x27;tester&#x27;</span>]</span><br><span class="line">        project.programer = python_data[<span class="string">&#x27;programer&#x27;</span>]</span><br><span class="line">        project.publish_app = python_data[<span class="string">&#x27;publish_app&#x27;</span>]</span><br><span class="line">        project.desc = python_data[<span class="string">&#x27;desc&#x27;</span>]</span><br><span class="line">        project.save()</span><br><span class="line">        <span class="comment"># 5.将模型类转化为字典，然后返回</span></span><br><span class="line">        one_dict = &#123;</span><br><span class="line">            <span class="string">&#x27;name&#x27;</span>: project.name,</span><br><span class="line">            <span class="string">&#x27;leader&#x27;</span>: project.leader,</span><br><span class="line">            <span class="string">&#x27;tester&#x27;</span>: project.tester,</span><br><span class="line">            <span class="string">&#x27;programer&#x27;</span>: project.programer,</span><br><span class="line">            <span class="string">&#x27;publish_app&#x27;</span>: project.publish_app,</span><br><span class="line">            <span class="string">&#x27;desc&#x27;</span>: project.desc</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> JsonResponse(one_dict, status=<span class="number">201</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">self, request, pk</span>):</span></span><br><span class="line">        <span class="comment"># 1.校验前端传递的pk(项目ID)值,类型是否正确(正整数),在数据库中是否存在等「先省略」</span></span><br><span class="line">        <span class="comment"># 2.获取指定pk值的项目</span></span><br><span class="line">        project = Projects.objects.get(<span class="built_in">id</span>=pk)</span><br><span class="line">        project.delete()</span><br><span class="line">        <span class="keyword">return</span> JsonResponse(&#123;&#125;, safe=<span class="literal">True</span>, status=<span class="number">204</span>)</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E5%85%AB)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="测试游记">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E5%85%AB)/" itemprop="url">测试开发进阶(八)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-03-03T20:10:33+08:00">
                2021-03-03
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E5%85%AB)/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2021/03/03/测试开发进阶(八)/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="测试开发进阶-八"><a href="#测试开发进阶-八" class="headerlink" title="测试开发进阶(八)"></a>测试开发进阶(八)</h1><h2 id="并发和并行"><a href="#并发和并行" class="headerlink" title="并发和并行"></a>并发和并行</h2><blockquote>
<p>多任务：操作系统可以同时运行多个任务。</p>
</blockquote>
<ul>
<li><p>并发：任务数&gt;cpu核数，每个cpu快速切换任务</p>
</li>
<li><p>并行：任务数&lt;cpu核数，每个cpu执行一个任务</p>
</li>
</ul>
<p>多线程模块：<code>threading</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading </span><br></pre></td></tr></table></figure>

<p>异步处理：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">use_time</span>(<span class="params">func</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span>(<span class="params">*args, **kwargs</span>):</span></span><br><span class="line">        begin = time.time()</span><br><span class="line">        func(*args, **kwargs)</span><br><span class="line">        end = time.time()</span><br><span class="line">        print(<span class="string">f&#x27;耗时：<span class="subst">&#123;end - begin&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">work1</span>():</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">        print(<span class="string">&#x27;执行浇花任务中...&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">work2</span>():</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">        print(<span class="string">&#x27;执行打墙任务中...&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@use_time</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    work1()</span><br><span class="line">    work2()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@use_time</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main1</span>():</span></span><br><span class="line">    t1 = Thread(target=work2)</span><br><span class="line">    t1.start()</span><br><span class="line">    print(<span class="string">&#x27;打墙的任务交给线程异步去处理&#x27;</span>)</span><br><span class="line">    work1()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()  <span class="comment"># 耗时：11.038895845413208</span></span><br><span class="line">    main1()  <span class="comment"># 耗时：6.021285057067871</span></span><br></pre></td></tr></table></figure>

<h2 id="threading模块"><a href="#threading模块" class="headerlink" title="threading模块"></a>threading模块</h2><p>Thread类：</p>
<ul>
<li>run()：用以表示线程活动的方法</li>
<li>start()：启动线程活动</li>
<li>join([time])：设置主线程会等待time秒后再往下执行，time默认为子线程结束，多个子线程之间设置的值会增加</li>
<li>isAlive()：返回线程是否活动的</li>
<li>getName()：返回线程名</li>
<li>setName()：设置线程名</li>
</ul>
<h2 id="定义自己的Thread类"><a href="#定义自己的Thread类" class="headerlink" title="定义自己的Thread类"></a>定义自己的Thread类</h2><p>重写run方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Method representing the thread&#x27;s activity.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    You may override this method in a subclass. The standard run() method</span></span><br><span class="line"><span class="string">    invokes the callable object passed to the object&#x27;s constructor as the</span></span><br><span class="line"><span class="string">    target argument, if any, with sequential and keyword arguments taken</span></span><br><span class="line"><span class="string">    from the args and kwargs arguments, respectively.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> self._target:</span><br><span class="line">            self._target(*self._args, **self._kwargs)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="comment"># Avoid a refcycle if the thread is running a function with</span></span><br><span class="line">        <span class="comment"># an argument that has a member that points to the thread.</span></span><br><span class="line">        <span class="keyword">del</span> self._target, self._args, self._kwargs</span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">@Describe: 0821_2</span></span><br><span class="line"><span class="string">@Author: zhongxin</span></span><br><span class="line"><span class="string">@Time: 2019-08-21 20:40</span></span><br><span class="line"><span class="string">@Email: 490336534@qq.com</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">use_time</span>(<span class="params">func</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span>(<span class="params">*args, **kwargs</span>):</span></span><br><span class="line">        begin = time.time()</span><br><span class="line">        func(*args, **kwargs)</span><br><span class="line">        end = time.time()</span><br><span class="line">        print(<span class="string">f&#x27;耗时：<span class="subst">&#123;end - begin&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义线程类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span>(<span class="params">Thread</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>):</span></span><br><span class="line">        headers = &#123;</span><br><span class="line">            <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">            requests.get(url=<span class="string">&#x27;https://www.baidu.com&#x27;</span>, headers=headers)</span><br><span class="line">            print(<span class="string">f&#x27;第<span class="subst">&#123;i + <span class="number">1</span>&#125;</span>次发送请求&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@use_time</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main0</span>():</span></span><br><span class="line">    t = MyThread()</span><br><span class="line">    t.start()</span><br><span class="line">    t.join()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@use_time</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    t_list = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        t = MyThread()  <span class="comment"># 创建线程对象</span></span><br><span class="line">        t.start()  <span class="comment"># 开启该线程</span></span><br><span class="line">        t_list.append(t)</span><br><span class="line">    <span class="comment"># 遍历所有线程对象,设置主线程等待子线程执行完</span></span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> t_list:</span><br><span class="line">        t.join()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main0()  <span class="comment"># 耗时：1.2900490760803223</span></span><br><span class="line">    main()  <span class="comment"># 耗时：2.2023119926452637</span></span><br></pre></td></tr></table></figure>

<h2 id="传参"><a href="#传参" class="headerlink" title="传参"></a>传参</h2><p>在run方法中：</p>
<p><code>self._target(*self._args, **self._kwargs)</code></p>
<p>从Thread的init方法中可以看到</p>
<p><code>self._args = args</code><br><code>self._kwargs = kwargs</code></p>
<p>所以传递方式为修改args和kwargs的内容</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, group=<span class="literal">None</span>, target=<span class="literal">None</span>, name=<span class="literal">None</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">             args=(<span class="params"></span>), kwargs=<span class="literal">None</span>, *, daemon=<span class="literal">None</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;This constructor should always be called with keyword arguments. Arguments are:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    *group* should be None; reserved for future extension when a ThreadGroup</span></span><br><span class="line"><span class="string">    class is implemented.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    *target* is the callable object to be invoked by the run()</span></span><br><span class="line"><span class="string">    method. Defaults to None, meaning nothing is called.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    *name* is the thread name. By default, a unique name is constructed of</span></span><br><span class="line"><span class="string">    the form &quot;Thread-N&quot; where N is a small decimal number.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    *args* is the argument tuple for the target invocation. Defaults to ().</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    *kwargs* is a dictionary of keyword arguments for the target</span></span><br><span class="line"><span class="string">    invocation. Defaults to &#123;&#125;.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    If a subclass overrides the constructor, it must make sure to invoke</span></span><br><span class="line"><span class="string">    the base class constructor (Thread.__init__()) before doing anything</span></span><br><span class="line"><span class="string">    else to the thread.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">assert</span> group <span class="keyword">is</span> <span class="literal">None</span>, <span class="string">&quot;group argument must be None for now&quot;</span></span><br><span class="line">    <span class="keyword">if</span> kwargs <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        kwargs = &#123;&#125;</span><br><span class="line">    self._target = target</span><br><span class="line">    self._name = <span class="built_in">str</span>(name <span class="keyword">or</span> _newname())</span><br><span class="line">    self._args = args</span><br><span class="line">    self._kwargs = kwargs</span><br><span class="line">    <span class="keyword">if</span> daemon <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        self._daemonic = daemon</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        self._daemonic = current_thread().daemon</span><br><span class="line">    self._ident = <span class="literal">None</span></span><br><span class="line">    self._tstate_lock = <span class="literal">None</span></span><br><span class="line">    self._started = Event()</span><br><span class="line">    self._is_stopped = <span class="literal">False</span></span><br><span class="line">    self._initialized = <span class="literal">True</span></span><br><span class="line">    <span class="comment"># sys.stderr is not stored in the class like</span></span><br><span class="line">    <span class="comment"># sys.exc_info since it can be changed between instances</span></span><br><span class="line">    self._stderr = _sys.stderr</span><br><span class="line">    <span class="comment"># For debugging and _after_fork()</span></span><br><span class="line">    _dangling.add(self)</span><br></pre></td></tr></table></figure>

<p>普通方式传参</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">work1</span>(<span class="params">name</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">        print(<span class="string">f&#x27;<span class="subst">&#123;name&#125;</span>执行浇花任务中...&#x27;</span>)</span><br><span class="line">         </span><br><span class="line"><span class="meta">@use_time</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    t1 = Thread(target=work1, args=(<span class="string">&#x27;zx&#x27;</span>,))</span><br><span class="line">    t1.start()</span><br><span class="line">    t1.join()</span><br></pre></td></tr></table></figure>

<p>自定义类方式传参</p>
<p>重写init方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, url</span>):</span></span><br><span class="line">    <span class="built_in">super</span>().__init__()</span><br><span class="line">    self.url = url</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span>(<span class="params">Thread</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, url</span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.url = url</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>):</span></span><br><span class="line">        headers = &#123;</span><br><span class="line">            <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">            requests.get(url=self.url, headers=headers)</span><br><span class="line">            print(<span class="string">f&#x27;第<span class="subst">&#123;i + <span class="number">1</span>&#125;</span>次发送请求&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@use_time</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    t_list = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        t = MyThread(url=<span class="string">&#x27;https://www.baidu.com&#x27;</span>)  <span class="comment"># 创建线程对象</span></span><br><span class="line">        t.start()  <span class="comment"># 开启该线程</span></span><br><span class="line">        t_list.append(t)</span><br><span class="line">    <span class="comment"># 遍历所有线程对象,设置主线程等待子线程执行完</span></span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> t_list:</span><br><span class="line">        t.join()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()  <span class="comment"># 耗时：2.2023119926452637</span></span><br></pre></td></tr></table></figure>

<h2 id="全局变量修改"><a href="#全局变量修改" class="headerlink" title="全局变量修改"></a>全局变量修改</h2><p>多线程可以共用全局变量：使用的是同一块内存</p>
<p>会出现<code>资源竞争</code></p>
<p>python中的线程是没办法进行并行执行，只能并发</p>
<p>线程之间什么时候会进行切换</p>
<ul>
<li>IO耗时操作：网络，文件，输入等耗时的IO操作，会自动切换</li>
<li>线程的执行时间到达一定的阈值，会自动切换</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">@Describe: 0821_3</span></span><br><span class="line"><span class="string">@Author: zhongxin</span></span><br><span class="line"><span class="string">@Time: 2019-08-21 21:20</span></span><br><span class="line"><span class="string">@Email: 490336534@qq.com</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"></span><br><span class="line">num = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">work1</span>():</span></span><br><span class="line">    <span class="keyword">global</span> num</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000000</span>):</span><br><span class="line">        num += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">work2</span>():</span></span><br><span class="line">    <span class="keyword">global</span> num</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000000</span>):</span><br><span class="line">        num += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    t1 = Thread(target=work1)</span><br><span class="line">    t2 = Thread(target=work2)</span><br><span class="line">    t1.start()</span><br><span class="line">    t2.start()</span><br><span class="line">    t1.join()</span><br><span class="line">    t2.join()</span><br><span class="line">    print(num)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main() <span class="comment"># 1380941</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>解决方案：</p>
</blockquote>
<ul>
<li>通过加锁来处理</li>
<li>通过队列来处理</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread, Lock</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一把锁</span></span><br><span class="line">meta = Lock()</span><br><span class="line">num = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">work1</span>():</span></span><br><span class="line">    <span class="keyword">global</span> num</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000000</span>):</span><br><span class="line">        meta.acquire()  <span class="comment"># 上锁</span></span><br><span class="line">        num += <span class="number">1</span></span><br><span class="line">        meta.release()  <span class="comment"># 解锁</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">work2</span>():</span></span><br><span class="line">    <span class="keyword">global</span> num</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000000</span>):</span><br><span class="line">        meta.acquire()</span><br><span class="line">        num += <span class="number">1</span></span><br><span class="line">        meta.release()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    t1 = Thread(target=work1)</span><br><span class="line">    t2 = Thread(target=work2)</span><br><span class="line">    t1.start()</span><br><span class="line">    t2.start()</span><br><span class="line">    t1.join()</span><br><span class="line">    t2.join()</span><br><span class="line">    print(num)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<h2 id="GIL"><a href="#GIL" class="headerlink" title="GIL"></a>GIL</h2><ol>
<li>python语言和GIL没有关系，仅仅由于历史原因在于Cpython虚拟机（解释器），难以移出GIL</li>
<li>GIL：全局解释器锁，每个线程在执行的过程中都需要获取GIL，保证同一时刻只有一个线程可以执行代码</li>
<li>线程释放GIL的情况，在IO操作等会引起阻塞的system call之前，可以暂时释放GIL，但在执行完毕后，必须重新获取GIL，python3+使用计时器（执行时间达到阈值后，当前线程释放GIL），python2+，tickets计数达到100</li>
<li>python使用多进程可以利用多核CPU资源</li>
</ol>
<h2 id="死锁"><a href="#死锁" class="headerlink" title="死锁"></a>死锁</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread, Lock</span><br><span class="line"></span><br><span class="line">metaA = Lock()</span><br><span class="line">metaB = Lock()</span><br><span class="line">num = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">work1</span>():</span></span><br><span class="line">    <span class="keyword">global</span> num</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100000</span>):</span><br><span class="line">        metaA.acquire()  </span><br><span class="line">        metaB.acquire()</span><br><span class="line">        num += <span class="number">1</span></span><br><span class="line">        metaB.release()</span><br><span class="line">        metaA.release()  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">work2</span>():</span></span><br><span class="line">    <span class="keyword">global</span> num</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100000</span>):</span><br><span class="line">        metaB.acquire()</span><br><span class="line">        metaA.acquire()</span><br><span class="line">        num += <span class="number">1</span></span><br><span class="line">        metaA.release()</span><br><span class="line">        metaB.release()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    t1 = Thread(target=work1)</span><br><span class="line">    t2 = Thread(target=work2)</span><br><span class="line">    t1.start()</span><br><span class="line">    t2.start()</span><br><span class="line">    t1.join()</span><br><span class="line">    t2.join()</span><br><span class="line">    print(num)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E5%85%AD)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="测试游记">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E5%85%AD)/" itemprop="url">测试开发进阶(六)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-03-03T20:10:33+08:00">
                2021-03-03
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E5%85%AD)/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2021/03/03/测试开发进阶(六)/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="测试开发进阶-六"><a href="#测试开发进阶-六" class="headerlink" title="测试开发进阶(六)"></a>测试开发进阶(六)</h1><blockquote>
<p>面向对象编程的三大特征：封装,集成,多态</p>
<p>封装：将数据和方法放在一个类中</p>
<p>继承：python中的一个类可以继承于一个或多个类，被继承的叫父类（基类，base class），继承的类叫子类</p>
<p>多态：一类事物拥有多种形态，一个抽象类有多个子类，（多态的概念依赖于继承），不同的子类对象调用相同的方法，产生不同的执行结果，多态可以增加代码的灵活性</p>
</blockquote>
<h2 id="多态"><a href="#多态" class="headerlink" title="多态"></a>多态</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">@Describe: 0816</span></span><br><span class="line"><span class="string">@Author: zhongxin</span></span><br><span class="line"><span class="string">@Time: 2019-08-16 20:31</span></span><br><span class="line"><span class="string">@Email: 490336534@qq.com</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;动物类&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">&#x27;动物类的func&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cat</span>(<span class="params">Animal</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;猫类&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">&#x27;喵 喵 喵&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span>(<span class="params">Animal</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;狗类&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">&#x27;汪 汪 汪&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hero</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">&#x27;这是Hero类&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span>(<span class="params">ani_obj</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param ani_obj: 动物类的对象</span></span><br><span class="line"><span class="string">    :type: Animal object</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    ani_obj.func()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    a = Animal()</span><br><span class="line">    b = Dog()</span><br><span class="line">    c = Cat()</span><br><span class="line">    h = Hero()</span><br><span class="line">    print(<span class="built_in">isinstance</span>(a, Animal))  <span class="comment"># True</span></span><br><span class="line">    print(<span class="built_in">isinstance</span>(b, Animal))  <span class="comment"># True</span></span><br><span class="line">    print(<span class="built_in">isinstance</span>(c, Animal))  <span class="comment"># True</span></span><br><span class="line">    print(<span class="built_in">isinstance</span>(h, Animal))  <span class="comment"># False</span></span><br><span class="line">    func(a)  <span class="comment"># 动物类的func</span></span><br><span class="line">    func(b)  <span class="comment"># 汪 汪 汪</span></span><br><span class="line">    func(c)  <span class="comment"># 喵 喵 喵</span></span><br><span class="line">    func(h)  <span class="comment"># 这是Hero类</span></span><br></pre></td></tr></table></figure>

<p>鸭子类型的体现：</p>
<ul>
<li>静态语言：上面传入的对象必须是Base类型或者它的子类，否则无法调用run()方法</li>
<li>动态语言：传入的不一定是Base类型，也可以是其他类型，只要内部实现了run()方法</li>
</ul>
<p>多态的意义：开放封闭原则</p>
<ul>
<li>对于一个变量，只需要知道它是Base类型，无需确切地知道它的子类型，就可以调用run()方法（调用方只管调用，不管细节）</li>
<li>当需要新增功能，只需要新增一个Base的子类实现run()，就可以在原来的基础上进行扩展，这就是著名的<code>开放封闭</code>原则</li>
<li>对扩展开放：允许新增Base子类</li>
<li>对修改封闭：不需要修改依赖Base类的run()等函数</li>
</ul>
<h2 id="数据和自省"><a href="#数据和自省" class="headerlink" title="数据和自省"></a>数据和自省</h2><p>类里面的属性：类属性</p>
<ul>
<li>私有属性:以单下划线或者双下划线开头的属性</li>
<li>公有属性:普通的属性</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    attr1 = <span class="number">100</span>  <span class="comment"># 公有属性</span></span><br><span class="line">    _attr1 = <span class="number">2000</span>  <span class="comment"># 私有属性</span></span><br><span class="line">    __attr2 = <span class="number">3000</span>  <span class="comment"># 私有属性</span></span><br><span class="line">      </span><br><span class="line">print(MyClass.__dict__)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&#123;&#x27;__module__&#x27;: &#x27;__main__&#x27;, </span></span><br><span class="line"><span class="string">&#x27;attr1&#x27;: 100, </span></span><br><span class="line"><span class="string">&#x27;_attr1&#x27;: 2000, </span></span><br><span class="line"><span class="string">&#x27;_MyClass__attr2&#x27;: 3000, </span></span><br><span class="line"><span class="string">&#x27;__dict__&#x27;: &lt;attribute &#x27;__dict__&#x27; of &#x27;MyClass&#x27; objects&gt;, </span></span><br><span class="line"><span class="string">&#x27;__weakref__&#x27;: &lt;attribute &#x27;__weakref__&#x27; of &#x27;MyClass&#x27; objects&gt;, </span></span><br><span class="line"><span class="string">&#x27;__doc__&#x27;: None&#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">print(MyClass.attr1) <span class="comment"># 100</span></span><br><span class="line">print(MyClass._attr1) <span class="comment"># 2000</span></span><br><span class="line">print(MyClass._MyClass__attr2) <span class="comment"># 3000</span></span><br></pre></td></tr></table></figure>

<p>使用私有属性优化单例模式 更安全</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    MyClass文档注释</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    attr1 = <span class="number">100</span></span><br><span class="line">    _attr1 = <span class="number">2000</span></span><br><span class="line">    __attr2 = <span class="number">3000</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func</span>(<span class="params">self, name</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        func方法</span></span><br><span class="line"><span class="string">        :param name:</span></span><br><span class="line"><span class="string">        :type str</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">print(MyClass.__doc__)</span><br><span class="line">m = MyClass()</span><br><span class="line">print(m.func.__doc__)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    MyClass文档注释</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        func方法</span></span><br><span class="line"><span class="string">        :param name:</span></span><br><span class="line"><span class="string">        :type str</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="slots限制类拥有的属性"><a href="#slots限制类拥有的属性" class="headerlink" title="slots限制类拥有的属性"></a>slots限制类拥有的属性</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hero</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    __slots__ = []</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">h = Hero()</span><br><span class="line">print(h.__slots__)  <span class="comment"># []</span></span><br><span class="line">print(h.__dict__) </span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Traceback (most recent call last):</span></span><br><span class="line"><span class="string">  File &quot;/Users/zhongxin/Desktop/py/zx/06/0816_3.py&quot;, line 18, in &lt;module&gt;</span></span><br><span class="line"><span class="string">    print(h.__dict__)  # &#123;&#x27;name&#x27;: &#x27;zx&#x27;, &#x27;age&#x27;: 18&#125;</span></span><br><span class="line"><span class="string">AttributeError: &#x27;Hero&#x27; object has no attribute &#x27;__dict__&#x27;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hero</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    __slots__ = [<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">h = Hero()</span><br><span class="line">h.name = <span class="string">&#x27;zx&#x27;</span></span><br><span class="line">print(h.name) <span class="comment"># zx	</span></span><br><span class="line">print(h.__slots__)  <span class="comment"># [&#x27;name&#x27;]</span></span><br></pre></td></tr></table></figure>

<p>作用：不再生成<code>__dict__</code>节约内存</p>
<h3 id="自定义属性访问"><a href="#自定义属性访问" class="headerlink" title="自定义属性访问"></a>自定义属性访问</h3><p>内置函数：</p>
<ul>
<li>getattr() 获取对象属性</li>
<li>setattr() 给对象设置属性</li>
<li>delattr() 删除对象属性</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hero</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">h = Hero(<span class="string">&#x27;zx&#x27;</span>)</span><br><span class="line">print(h.name) <span class="comment"># zx</span></span><br><span class="line"><span class="built_in">setattr</span>(h, <span class="string">&#x27;age&#x27;</span>, <span class="number">18</span>)</span><br><span class="line">print(h.age)  <span class="comment"># 18</span></span><br><span class="line">print(<span class="built_in">getattr</span>(h, <span class="string">&#x27;name&#x27;</span>))  <span class="comment"># zx</span></span><br><span class="line"><span class="built_in">delattr</span>(h,<span class="string">&#x27;name&#x27;</span>) <span class="comment"># &lt;=&gt; del h.name</span></span><br><span class="line">print(h.name)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Traceback (most recent call last):</span></span><br><span class="line"><span class="string">  File &quot;/Users/zhongxin/Desktop/py/zx/06/0816_4.py&quot;, line 23, in &lt;module&gt;</span></span><br><span class="line"><span class="string">    print(h.name)</span></span><br><span class="line"><span class="string">AttributeError: &#x27;Hero&#x27; object has no attribute &#x27;name&#x27;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>__setattr__</code>方法</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hero</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name</span>):</span></span><br><span class="line">        print(<span class="string">&#x27;-----init-----&#x27;</span>)</span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__setattr__</span>(<span class="params">self, key, value</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        给对象设置属性的时候会调用该方法</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        print(self)  <span class="comment"># &lt;__main__.Hero object at 0x1031c7550&gt;</span></span><br><span class="line">        print(key)  <span class="comment"># name</span></span><br><span class="line">        print(value)  <span class="comment"># zx</span></span><br><span class="line">        print(<span class="string">&#x27;-----setattr-----&#x27;</span>)</span><br><span class="line">        <span class="built_in">object</span>.__setattr__(self, key, value)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">h = Hero(<span class="string">&#x27;zx&#x27;</span>)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">-----init-----</span></span><br><span class="line"><span class="string">&lt;__main__.Hero object at 0x1031c7550&gt;</span></span><br><span class="line"><span class="string">name</span></span><br><span class="line"><span class="string">zx</span></span><br><span class="line"><span class="string">-----setattr-----</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">print(h.name) <span class="comment"># zx</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>__delattr__</code>方法</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hero</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name</span>):</span></span><br><span class="line">        print(<span class="string">&#x27;-----init-----&#x27;</span>)</span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delattr__</span>(<span class="params">self, item</span>):</span></span><br><span class="line">        print(<span class="string">f&#x27;这个是item:<span class="subst">&#123;item&#125;</span>&#x27;</span>) <span class="comment"># 这个是item:name</span></span><br><span class="line">        <span class="built_in">object</span>.__delattr__(self, item)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">h = Hero(<span class="string">&#x27;zx&#x27;</span>)</span><br><span class="line">print(h.__dict__)  <span class="comment"># &#123;&#x27;name&#x27;: &#x27;zx&#x27;&#125;</span></span><br><span class="line"><span class="built_in">delattr</span>(h, <span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">print(h.__dict__)  <span class="comment"># &#123;&#125;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>__getattribute__</code>方法:查找属性，直接调用该方法进行查找</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hero</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name</span>):</span></span><br><span class="line">        print(<span class="string">&#x27;-----init-----&#x27;</span>)</span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getattribute__</span>(<span class="params">self, item</span>):</span></span><br><span class="line">        print(<span class="string">f&#x27;这个是item:<span class="subst">&#123;item&#125;</span>&#x27;</span>) <span class="comment"># 这个是item:name</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">object</span>.__getattribute__(self, item)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">h = Hero(<span class="string">&#x27;zx&#x27;</span>)</span><br><span class="line">print(h.name) <span class="comment"># zx</span></span><br><span class="line">print(h.name1)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Traceback (most recent call last):</span></span><br><span class="line"><span class="string">  File &quot;/Users/zhongxin/Desktop/py/zx/06/0816_7.py&quot;, line 26, in &lt;module&gt;</span></span><br><span class="line"><span class="string">    print(h.name1)  # zx</span></span><br><span class="line"><span class="string">  File &quot;/Users/zhongxin/Desktop/py/zx/06/0816_7.py&quot;, line 18, in __getattribute__</span></span><br><span class="line"><span class="string">    return object.__getattribute__(self, item)</span></span><br><span class="line"><span class="string">AttributeError: &#x27;Hero&#x27; object has no attribute &#x27;name1&#x27;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>__getattr__</code>:如果属性不存在，getattribute报AttributeError错误，该方法会主动捕获异常</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hero</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name</span>):</span></span><br><span class="line">        print(<span class="string">&#x27;-----init-----&#x27;</span>)</span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getattribute__</span>(<span class="params">self, item</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;查找属性，直接调用该方法进行查找&quot;&quot;&quot;</span></span><br><span class="line">        print(<span class="string">f&#x27;这个是item:<span class="subst">&#123;item&#125;</span>&#x27;</span>)  <span class="comment"># 这个是item:name</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">object</span>.__getattribute__(self, item)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span>(<span class="params">self, item</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;如果属性不存在，getattribute报AttributeError错误，该方法会主动捕获异常&quot;&quot;&quot;</span></span><br><span class="line">        print(<span class="string">f&#x27;这是__getattr__的item:<span class="subst">&#123;item&#125;</span>&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">999</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">h = Hero(<span class="string">&#x27;zx&#x27;</span>)</span><br><span class="line">print(h.name1)  </span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">-----init-----</span></span><br><span class="line"><span class="string">这个是item:name1</span></span><br><span class="line"><span class="string">这是__getattr__的item:name1</span></span><br><span class="line"><span class="string">999</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E5%8D%81)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="测试游记">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E5%8D%81)/" itemprop="url">测试开发进阶(十)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-03-03T20:10:33+08:00">
                2021-03-03
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E5%8D%81)/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2021/03/03/测试开发进阶(十)/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="测试开发进阶-十"><a href="#测试开发进阶-十" class="headerlink" title="测试开发进阶(十)"></a>测试开发进阶(十)</h1><h2 id="进程之间通信"><a href="#进程之间通信" class="headerlink" title="进程之间通信"></a>进程之间通信</h2><p>进程之间通信：<code>使用队列</code></p>
<p>queue模块中的队列，只能用于一个进程中，各个线程之间进行通信</p>
<p>进程模块中的Queue:可以用于多个进程之间进行通信</p>
<p>⚠️注意点：使用的时候要使用参数传递到各个进程任务中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Queue</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process, Queue</span><br><span class="line"></span><br><span class="line">q = Queue()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    q.put(i)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">work1</span>(<span class="params">q</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> q.empty():</span><br><span class="line">        print(<span class="string">f&#x27;work1获取数据<span class="subst">&#123;q.get()&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">work2</span>(<span class="params">q</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> q.empty():</span><br><span class="line">        print(<span class="string">f&#x27;work2获取数据<span class="subst">&#123;q.get()&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    p1 = Process(target=work1, args=(q,))</span><br><span class="line">    p2 = Process(target=work2, args=(q,))</span><br><span class="line">    p1.start()</span><br><span class="line">    p2.start()</span><br></pre></td></tr></table></figure>

<blockquote>
<p>work1获取数据0<br>work1获取数据1<br>work1获取数据2<br>work1获取数据3<br>work1获取数据4</p>
</blockquote>
<h2 id="协程"><a href="#协程" class="headerlink" title="协程"></a>协程</h2><ul>
<li>协程，又称微线程</li>
<li>协程是python中另外一种实现多任务的方式，只不过比线程更小，占用更小执行单元（理解为需要的资源）</li>
<li>它自带CPU上下文，这样只要在合适的时间，我们就可以把一个协程切换到另一个协程，只要这个过程保存或恢复CPU上下文那么程序还是可以运行的</li>
</ul>
<p><code>通俗的理解</code></p>
<blockquote>
<p>在一个线程中的某个函数，可以在任何地方保存当前函数的一些临时变量等信息，然后切换到另外一个函数中执行，注意不是通过调用函数的方式做到的，并且切换的次数以及什么时候再切换到原来的函数都由开发者自己决定</p>
</blockquote>
<p><code>协程和线程差异</code></p>
<blockquote>
<p>在实现多任务时，线程切换从系统层面远不止保存和恢复CPU上下文这么简单，操作系统为了程序的高效性每个线程都有自己缓存Cache等等数据，操作系统还会帮你做这些数据的恢复操作。所以线程的切换比较耗性能。但是协程的切换之间单纯的操作CPU的上下文，所以一秒钟切换个上百万次性能都扛得住。</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">g1 = (i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen</span>():</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        <span class="keyword">yield</span> i</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">g2 = gen()</span><br><span class="line">print(g1)</span><br><span class="line">print(g2)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>&lt;generator object <genexpr> at 0x114203138&gt;<br>&lt;generator object gen at 0x1142031b0&gt;</p>
</blockquote>
<h3 id="协程的实现"><a href="#协程的实现" class="headerlink" title="协程的实现"></a>协程的实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">work1</span>():</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        <span class="keyword">yield</span> i</span><br><span class="line">        print(<span class="string">f&#x27;work1:<span class="subst">&#123;i&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">work2</span>():</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        <span class="keyword">yield</span> i</span><br><span class="line">        print(<span class="string">f&#x27;work2:<span class="subst">&#123;i&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">work3</span>():</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        <span class="keyword">yield</span> i</span><br><span class="line">        print(<span class="string">f&#x27;work3:<span class="subst">&#123;i&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">g1 = work1()</span><br><span class="line">g2 = work2()</span><br><span class="line">g3 = work3()</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">next</span>(g1)</span><br><span class="line">        <span class="built_in">next</span>(g2)</span><br><span class="line">        <span class="built_in">next</span>(g3)</span><br><span class="line">    <span class="keyword">except</span> StopIteration:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>work1:0<br>work2:0<br>work3:0<br>work1:1<br>work2:1<br>work3:1<br>work1:2<br>work2:2<br>work3:2<br>work1:3<br>work2:3<br>work3:3<br>work1:4</p>
</blockquote>
<h3 id="greenlet"><a href="#greenlet" class="headerlink" title="greenlet"></a>greenlet</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> pip install greenlet</span></span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> greenlet <span class="keyword">import</span> greenlet</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test1</span>():</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        print(i)</span><br><span class="line">        g2.switch()</span><br><span class="line">        time.sleep(<span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test2</span>():</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        print(i)</span><br><span class="line">        g1.switch()</span><br><span class="line">        time.sleep(<span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">g1 = greenlet(test1)</span><br><span class="line">g2 = greenlet(test2)</span><br><span class="line">g1.switch()</span><br></pre></td></tr></table></figure>

<blockquote>
<p>0<br>0<br>1<br>1<br>2<br>2<br>3<br>3<br>4<br>4</p>
</blockquote>
<h3 id="gevent"><a href="#gevent" class="headerlink" title="gevent"></a>gevent</h3><blockquote>
<p>gevent其原理就是当一个greenlet遇到IO（input output输入输出，比如网络，文件操作等）操作时，比如访问网络，就自动切换到其他greenlet，等到IO操作完成，再在适当的时候切换回来继续执行。由于IO操作非常耗时，经常使程序处于等待状态，有了gevent自动切换协程，保证总有greenlet在运行，而不是等待IO</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> pip install gevent</span></span><br></pre></td></tr></table></figure>

<p>等待需要使用<code>gevent.sleep(0.1)</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gevent</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">work1</span>():</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        print(<span class="string">f&#x27;work1:<span class="subst">&#123;i&#125;</span>&#x27;</span>)</span><br><span class="line">        gevent.sleep(<span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">work2</span>():</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        print(<span class="string">f&#x27;work2:<span class="subst">&#123;i&#125;</span>&#x27;</span>)</span><br><span class="line">        gevent.sleep(<span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">g1 = gevent.spawn(work1)</span><br><span class="line">g2 = gevent.spawn(work2)</span><br><span class="line"></span><br><span class="line">g1.join()  <span class="comment"># 设置主线程等待子协程执行完之后 往下执行</span></span><br><span class="line">g2.join()</span><br></pre></td></tr></table></figure>

<blockquote>
<p>work1:0<br>work2:0<br>work1:1<br>work2:1<br>work1:2<br>work2:2<br>work1:3<br>work2:3<br>work1:4<br>work2:4</p>
</blockquote>
<p><code>修改work2的等待时间为0.4秒</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gevent</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">work1</span>():</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        print(<span class="string">f&#x27;work1:<span class="subst">&#123;i&#125;</span>&#x27;</span>)</span><br><span class="line">        gevent.sleep(<span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">work2</span>():</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        print(<span class="string">f&#x27;work2:<span class="subst">&#123;i&#125;</span>&#x27;</span>)</span><br><span class="line">        gevent.sleep(<span class="number">0.4</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">g1 = gevent.spawn(work1)</span><br><span class="line">g2 = gevent.spawn(work2)</span><br><span class="line"></span><br><span class="line">g1.join()  <span class="comment"># 设置主线程等待子协程执行完之后 往下执行</span></span><br><span class="line">g2.join()</span><br></pre></td></tr></table></figure>

<blockquote>
<p>work1:0<br>work2:0<br>work1:1<br>work1:2<br>work1:3<br>work2:1<br>work1:4<br>work2:2<br>work2:3<br>work2:4</p>
</blockquote>
<p>如果需要使用<code>time.sleep</code>但是要完成切换需要使用猴子补丁</p>
<p>注意：猴子补丁在多线程任务时会出现异常！！！！！</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gevent <span class="keyword">import</span> monkey</span><br><span class="line">monkey.patch_all()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> gevent</span><br><span class="line"><span class="keyword">from</span> gevent <span class="keyword">import</span> monkey</span><br><span class="line"></span><br><span class="line">monkey.patch_all()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">work1</span>():</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        print(<span class="string">f&#x27;work1:<span class="subst">&#123;i&#125;</span>&#x27;</span>)</span><br><span class="line">        time.sleep(<span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">work2</span>():</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        print(<span class="string">f&#x27;work2:<span class="subst">&#123;i&#125;</span>&#x27;</span>)</span><br><span class="line">        time.sleep(<span class="number">0.4</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">g1 = gevent.spawn(work1)</span><br><span class="line">g2 = gevent.spawn(work2)</span><br><span class="line"></span><br><span class="line">g1.join()</span><br><span class="line">g2.join()</span><br></pre></td></tr></table></figure>

<h3 id="发送IO"><a href="#发送IO" class="headerlink" title="发送IO"></a>发送IO</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> gevent</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">usetime</span>(<span class="params">func</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span>(<span class="params">*args, **kwargs</span>):</span></span><br><span class="line">        start_time = time.time()</span><br><span class="line">        func(*args, **kwargs)</span><br><span class="line">        end_time = time.time()</span><br><span class="line">        print(<span class="string">f&#x27;耗时<span class="subst">&#123;end_time - start_time&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">work1</span>(<span class="params">url</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">        requests.get(url)</span><br><span class="line">        gevent.sleep(<span class="number">0.01</span>)</span><br><span class="line">        print(<span class="string">f&#x27;work1发送第<span class="subst">&#123;i&#125;</span>次请求&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">work2</span>(<span class="params">url</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">        requests.get(url)</span><br><span class="line">        gevent.sleep(<span class="number">0.01</span>)</span><br><span class="line">        print(<span class="string">f&#x27;work2发送第<span class="subst">&#123;i&#125;</span>次请求&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@usetime</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    <span class="comment"># def spawn(cls, *args, **kwargs):</span></span><br><span class="line">    g1 = gevent.spawn(work1, url=<span class="string">&#x27;https://www.baidu.com&#x27;</span>)</span><br><span class="line">    g2 = gevent.spawn(work2, <span class="string">&#x27;https://www.baidu.com&#x27;</span>)</span><br><span class="line">    g1.join()</span><br><span class="line">    g2.join()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()  <span class="comment"># 耗时32.37710213661194</span></span><br></pre></td></tr></table></figure>

<h2 id="进程池"><a href="#进程池" class="headerlink" title="进程池"></a>进程池</h2><ul>
<li><code>close</code>：关闭进程池，该进程池不再接收新的任务</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">work1</span>():</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        print(<span class="string">f&#x27;进程ID:<span class="subst">&#123;os.getpid()&#125;</span>,work1:<span class="subst">&#123;i&#125;</span>&#x27;</span>)</span><br><span class="line">        time.sleep(<span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># 创建一个进程池，进程池中有五个进程</span></span><br><span class="line">    po = Pool(<span class="number">5</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        po.apply_async(work1)</span><br><span class="line">    po.close()  <span class="comment"># 进程池不再接收任务</span></span><br><span class="line">    po.join()</span><br></pre></td></tr></table></figure>

<blockquote>
<p>进程ID:64232,work1:0<br>进程ID:64233,work1:0<br>进程ID:64234,work1:0<br>进程ID:64232,work1:1<br>进程ID:64233,work1:1<br>进程ID:64234,work1:1<br>进程ID:64232,work1:2<br>进程ID:64234,work1:2进程ID:64233,work1:2</p>
<p>进程ID:64232,work1:3<br>进程ID:64234,work1:3<br>进程ID:64233,work1:3<br>进程ID:64232,work1:4<br>进程ID:64234,work1:4进程ID:64233,work1:4</p>
</blockquote>
<h4 id="进程池之间的队列："><a href="#进程池之间的队列：" class="headerlink" title="进程池之间的队列："></a>进程池之间的队列：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Manager</span><br><span class="line">q1 = Manager().Queue()</span><br></pre></td></tr></table></figure>

<h2 id="线程池"><a href="#线程池" class="headerlink" title="线程池"></a>线程池</h2><ul>
<li>内置模块</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor, ProcessPoolExecutor</span><br></pre></td></tr></table></figure>

<ul>
<li>第三方模块</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threadpool</span><br></pre></td></tr></table></figure>

<h3 id="进程线程协程比较"><a href="#进程线程协程比较" class="headerlink" title="进程线程协程比较"></a>进程线程协程比较</h3><ul>
<li>进程是资源分配的单位</li>
<li>线程是操作系统调度的单位</li>
<li>进程切换需要的资源最大，效率很低</li>
<li>线程切换需要的资源一般，效率一般（在不考虑GIL的情况下）</li>
<li>协程切换任务资源很小，效率高</li>
<li>多进程，多线程根据cpu核数不同可能是并行的，但是协程是在一个线程中的，所以是并发</li>
<li>python中的线程由于GIL锁的存在，不能实现并行</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E5%8D%81%E4%B8%83)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="测试游记">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E5%8D%81%E4%B8%83)/" itemprop="url">测试开发进阶(十七)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-03-03T20:10:33+08:00">
                2021-03-03
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2021/03/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6(%E5%8D%81%E4%B8%83)/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2021/03/03/测试开发进阶(十七)/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="测试开发进阶-十七"><a href="#测试开发进阶-十七" class="headerlink" title="测试开发进阶(十七)"></a>测试开发进阶(十七)</h1><p><strong>欢迎关注我的公众号：「测试游记」</strong></p>
<h2 id="插件推荐"><a href="#插件推荐" class="headerlink" title="插件推荐"></a>插件推荐</h2><p>推荐Vue插件：<code>Vue.js devtools</code></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g71tgx0zz8j30mq0bwta7.jpg" alt="image-20190917002005926"></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g71tfww1zlj31b30u0wwf.jpg" alt="Vue.js devtools"></p>
<h2 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h2><h3 id="v-bind"><a href="#v-bind" class="headerlink" title="v-bind"></a>v-bind</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">title</span>=<span class="string">&quot;dream&quot;</span>&gt;</span>学好Vue<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g71td2c362j306g03e74j.jpg" alt="title"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">v-bind:title</span>=<span class="string">&quot;dream&quot;</span>&gt;</span>学好Vue<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        message: <span class="string">&#x27;Hello Python&#x27;</span>,</span><br><span class="line">        name: <span class="string">&#x27;zhongxin&#x27;</span>,</span><br><span class="line">        dream: <span class="string">&#x27;小目标&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g71tdnqyoaj306803ajri.jpg" alt="v-bind绑定属性"></p>
<p>可以使用插件进行修改绑定的内容</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g71thf7972j30og0hc0ud.jpg" alt="使用插件修改"></p>
<h3 id="v-if和v-show"><a href="#v-if和v-show" class="headerlink" title="v-if和v-show"></a>v-if和v-show</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">v-if</span>=<span class="string">&quot;isNotFlag&quot;</span>&gt;</span>嘟嘟嘟<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        message: <span class="string">&#x27;Hello Python&#x27;</span>,</span><br><span class="line">        name: <span class="string">&#x27;zhongxin&#x27;</span>,</span><br><span class="line">        dream: <span class="string">&#x27;小目标&#x27;</span>,</span><br><span class="line">        isNotFlag: <span class="literal">false</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当<code>isNotFlag</code>是<code>false</code>的时候不显示，当<code>isNotFlag</code>是<code>true</code>的时候显示</p>
<img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g71tkwato7j30ms0lgmz5.jpg" alt="不现实" style="zoom:50%;" />

<img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g71tlek0ejj30mu0quwgw.jpg" alt="显示" style="zoom:50%;" />

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">v-show</span>=<span class="string">&quot;isNotFlag&quot;</span>&gt;</span>嘟嘟嘟2<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>v-show</code>也可以实现类似<code>v-if</code>的效果，但是两者还是有区别的</p>
<ul>
<li><code>v-if</code>每次都会重新删除或创建元素</li>
<li><code>v-show</code>每次不会重新进行dom的删除和创建操作，只是切换了元素的<code>display</code>样式</li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g71tpp0qw7j30s205wwg3.jpg" alt="false时"></p>
<img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g71tqj7h3yj31920gi0wa.jpg" alt="显示时" style="zoom:50%;" />

<p><code>v-if</code></p>
<p><code>v-else-if</code></p>
<p><code>v-else</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>有一天，&#123;&#123;username&#125;&#125;想去上网<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">v-if</span>=<span class="string">&quot;age&gt;=70&quot;</span>&gt;</span>&#123;&#123;username&#125;&#125;爷爷，您还是回去锻炼身体吧<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">v-else-if</span>=<span class="string">&quot;age&gt;=18&quot;</span>&gt;</span>&#123;&#123;username&#125;&#125;，欢迎光临<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">v-else</span>&gt;</span>&#123;&#123;username&#125;&#125;，小朋友作业写完了吗？<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        message: <span class="string">&#x27;Hello Python&#x27;</span>,</span><br><span class="line">        name: <span class="string">&#x27;zhongxin&#x27;</span>,</span><br><span class="line">        dream: <span class="string">&#x27;小目标&#x27;</span>,</span><br><span class="line">        isNotFlag: <span class="literal">false</span>,</span><br><span class="line">        username: <span class="string">&#x27;马仔&#x27;</span>,</span><br><span class="line">        age: <span class="number">19</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g71tvi8v5hj30e604et8t.jpg" alt="页面展示"></p>
<p>修改<code>age</code></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g71twucjbqj30qq0hkgnq.jpg" alt="修改age"></p>
<h3 id="v-for"><a href="#v-for" class="headerlink" title="v-for"></a>v-for</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;table&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;th v-for&#x3D;&quot;project in project_headers&quot;&gt;&#123;&#123;project&#125;&#125;&lt;&#x2F;th&gt;</span><br><span class="line">        &lt;&#x2F;tr&gt;</span><br><span class="line">    &lt;&#x2F;table&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    export default &#123;</span><br><span class="line">        name: &quot;ProjectsList&quot;,</span><br><span class="line">        data() &#123;</span><br><span class="line">            return &#123;</span><br><span class="line">                project_headers: [&#39;项目名称&#39;, &#39;项目负责人&#39;, &#39;应用名称&#39;],</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">    table &#123;</span><br><span class="line">        margin: 50px auto;</span><br><span class="line">        border-collapse: collapse;</span><br><span class="line">        width: 40%;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    td, th &#123;</span><br><span class="line">        border: 1px solid #ddd;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g71u5o81moj30zn0u0alo.jpg" alt="v-for"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tr</span> <span class="attr">v-for</span>=<span class="string">&quot;item in projects&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>&#123;&#123;item.name&#125;&#125;<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>&#123;&#123;item.leader&#125;&#125;<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>&#123;&#123;item.app_name&#125;&#125;<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        project_headers: [<span class="string">&#x27;项目名称&#x27;</span>, <span class="string">&#x27;项目负责人&#x27;</span>, <span class="string">&#x27;应用名称&#x27;</span>],</span><br><span class="line">        projects: [</span><br><span class="line">            &#123;<span class="attr">name</span>: <span class="string">&#x27;前程贷&#x27;</span>, <span class="attr">leader</span>: <span class="string">&#x27;笨笨&#x27;</span>, <span class="attr">app_name</span>: <span class="string">&#x27;P2P&#x27;</span>&#125;,</span><br><span class="line">            &#123;<span class="attr">name</span>: <span class="string">&#x27;111&#x27;</span>, <span class="attr">leader</span>: <span class="string">&#x27;222&#x27;</span>, <span class="attr">app_name</span>: <span class="string">&#x27;333&#x27;</span>&#125;,</span><br><span class="line">            &#123;<span class="attr">name</span>: <span class="string">&#x27;444&#x27;</span>, <span class="attr">leader</span>: <span class="string">&#x27;555&#x27;</span>, <span class="attr">app_name</span>: <span class="string">&#x27;666&#x27;</span>&#125;,</span><br><span class="line">            &#123;<span class="attr">name</span>: <span class="string">&#x27;666&#x27;</span>, <span class="attr">leader</span>: <span class="string">&#x27;777&#x27;</span>, <span class="attr">app_name</span>: <span class="string">&#x27;888&#x27;</span>&#125;,</span><br><span class="line">        ]</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g71u84fuaoj30zn0u0am8.jpg" alt="增加项目"></p>
<h2 id="使用Element-UI"><a href="#使用Element-UI" class="headerlink" title="使用Element UI"></a>使用Element UI</h2><p><a target="_blank" rel="noopener" href="https://element.eleme.cn/#/zh-CN/component/installation">https://element.eleme.cn/#/zh-CN/component/installation</a></p>
<p>在项目路径下安装：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> cnpm i element-ui -S</span></span><br></pre></td></tr></table></figure>

<p>导入：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入Vue.js</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="comment">// 导入App.vue根组件</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"><span class="comment">// 导入element-ui</span></span><br><span class="line"><span class="keyword">import</span> ElementUI <span class="keyword">from</span> <span class="string">&#x27;element-ui&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;element-ui/lib/theme-chalk/index.css&#x27;</span>;</span><br><span class="line"><span class="comment">//在创建Vue实例前，要将element-ui插件加入到Vue中</span></span><br><span class="line">Vue.use(ElementUI);<span class="comment">// 加载插件</span></span><br><span class="line"></span><br><span class="line">Vue.config.productionTip = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    render: <span class="function"><span class="params">h</span> =&gt;</span> h(App), <span class="comment">//渲染App根组件</span></span><br><span class="line">&#125;).$mount(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>选择适合的：</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g71uy3j5suj318v0u0wju.jpg" alt="选择"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;el-table</span><br><span class="line">            ref&#x3D;&quot;multipleTable&quot;</span><br><span class="line">            :data&#x3D;&quot;tableData&quot;</span><br><span class="line">            tooltip-effect&#x3D;&quot;dark&quot;</span><br><span class="line">            style&#x3D;&quot;width: 100%&quot;</span><br><span class="line">            class&#x3D;&quot;project_list_new&quot;</span><br><span class="line">            @selection-change&#x3D;&quot;handleSelectionChange&quot;&gt;</span><br><span class="line">        &lt;el-table-column</span><br><span class="line">                type&#x3D;&quot;selection&quot;</span><br><span class="line">                width&#x3D;&quot;55&quot;&gt;</span><br><span class="line">        &lt;&#x2F;el-table-column&gt;</span><br><span class="line">        &lt;el-table-column</span><br><span class="line">                prop&#x3D;&quot;name&quot;</span><br><span class="line">                label&#x3D;&quot;项目名称&quot;</span><br><span class="line">                width&#x3D;&quot;120&quot;&gt;</span><br><span class="line">        &lt;&#x2F;el-table-column&gt;</span><br><span class="line">        &lt;el-table-column</span><br><span class="line">                prop&#x3D;&quot;leader&quot;</span><br><span class="line">                label&#x3D;&quot;项目负责人&quot;</span><br><span class="line">                width&#x3D;&quot;120&quot;&gt;</span><br><span class="line">        &lt;&#x2F;el-table-column&gt;</span><br><span class="line">        &lt;el-table-column</span><br><span class="line">                prop&#x3D;&quot;app_name&quot;</span><br><span class="line">                label&#x3D;&quot;应用名称&quot;</span><br><span class="line">                show-overflow-tooltip&gt;</span><br><span class="line">        &lt;&#x2F;el-table-column&gt;</span><br><span class="line">    &lt;&#x2F;el-table&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    export default &#123;</span><br><span class="line">        name: &quot;ProjectsList&quot;,</span><br><span class="line">        data() &#123;</span><br><span class="line">            return &#123;</span><br><span class="line">                project_headers: [&#39;项目名称&#39;, &#39;项目负责人&#39;, &#39;应用名称&#39;],</span><br><span class="line">                tableData: [</span><br><span class="line">                    &#123;name: &#39;前程贷&#39;, leader: &#39;笨笨&#39;, app_name: &#39;P2P&#39;&#125;,</span><br><span class="line">                    &#123;name: &#39;111&#39;, leader: &#39;222&#39;, app_name: &#39;333&#39;&#125;,</span><br><span class="line">                    &#123;name: &#39;444&#39;, leader: &#39;555&#39;, app_name: &#39;666&#39;&#125;,</span><br><span class="line">                    &#123;name: &#39;666&#39;, leader: &#39;777&#39;, app_name: &#39;888&#39;&#125;,</span><br><span class="line">                ]</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">    table &#123;</span><br><span class="line">        margin: 50px auto;</span><br><span class="line">        border-collapse: collapse;</span><br><span class="line">        width: 40%;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    td, th &#123;</span><br><span class="line">        border: 1px solid #ddd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .project_list_new &#123;</span><br><span class="line">        margin: 50px 500px;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g71ux8ln0xj31b30u018u.jpg" alt="结果"></p>
<h3 id="v-on"><a href="#v-on" class="headerlink" title="v-on"></a>v-on</h3><p>v-on为vue中指令，用于绑定事件，事件触发之后可以执行js操作</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">v-on:click</span>=<span class="string">&quot;username=&#x27;路人&#x27;&quot;</span>&gt;</span>有一天，&#123;&#123;username&#125;&#125;想去上网<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">v-if</span>=<span class="string">&quot;age&gt;=70&quot;</span>&gt;</span>&#123;&#123;username&#125;&#125;爷爷，您还是回去锻炼身体吧<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">v-else-if</span>=<span class="string">&quot;age&gt;=18&quot;</span>&gt;</span>&#123;&#123;username&#125;&#125;，欢迎光临<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">v-else</span>&gt;</span>&#123;&#123;username&#125;&#125;，小朋友作业写完了吗？<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g725ba7sc6j30cq05e3ym.jpg" alt="点击前" style="zoom:50%;" />

<p>点击「有一天」后</p>
<img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g725bkk8wwj30am04iaa6.jpg" alt="点击后" style="zoom:50%;" />

<p>v-on可以缩写为<code>@</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> @<span class="attr">click</span>=<span class="string">&quot;changeUsername&quot;</span>&gt;</span>有一天，&#123;&#123;username&#125;&#125;想去上网<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">    changeUsername: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// this 就相当于self</span></span><br><span class="line">        <span class="built_in">this</span>.username = <span class="string">&#x27;一个没有感情的杀手&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g725f7mfonj30hk04gaag.jpg" alt="点击后" style="zoom:50%;" />
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/">&lt;i class&#x3D;&quot;fa fa-angle-left&quot;&gt;&lt;&#x2F;i&gt;</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/4/">&lt;i class&#x3D;&quot;fa fa-angle-right&quot;&gt;&lt;&#x2F;i&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpeg"
                alt="" />
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives%7C%7C%20archive">
              
                  <span class="site-state-item-count">51</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/zx490336534" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">测试游记</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  

    
      <script id="dsq-count-scr" src="https://.disqus.com/count.js" async></script>
    

    

  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
